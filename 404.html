<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ø³Ø¹Ø§Ø± Ø®Ø¯Ù…Ø§Øª Ø¨ÙˆØ±ØªØ±Ø§Ø¬</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
    
    * {
      font-family: 'Cairo', sans-serif;
      font-size: 18px;
    }
    
    /* Datalist and Select Styling â€” Black Ã— Gold luxury theme */
    input[list]::-webkit-calendar-picker-indicator {
      filter: invert(1);
      cursor: pointer;
    }

    datalist {
      background: #050505; /* very dark */
      color: #FFD700; /* gold */
      border: 1px solid #FFD700;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(255,215,0,0.06);
      padding: 6px;
    }

    option {
      background: #0a0a0a;
      color: #FFD700;
      padding: 10px 12px;
      font-size: 13px;
      transition: all 0.18s ease;
      border-radius: 8px;
    }

    option:hover {
      background: #B8860B; /* dark gold */
      color: #000;
      box-shadow: 0 8px 20px rgba(255,215,0,0.12), 0 0 12px rgba(255,215,0,0.06) inset;
    }

    select {
      background: #070707;
      border: 1px solid #FFD700;
      color: #FFD700;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 14px;
      box-shadow: 0 8px 24px rgba(255,215,0,0.04);
    }

    select option {
      background: #0a0a0a;
      color: #FFD700;
      padding: 8px;
      border-radius: 6px;
    }

    select option:hover,
    select option:checked {
      background: #B8860B;
      color: #000;
      box-shadow: 0 8px 20px rgba(255,215,0,0.12);
    }

    /* Firefox specific */
    @-moz-document url-prefix() {
      option {
        background: #0a0a0a;
        color: #FFD700;
      }

      option:hover {
        background: #B8860B;
        color: #000;
      }
    }
    
    html, body {
      height: 100%;
      overflow: hidden;
      margin: 0;
      padding: 0;
    }
    
    .dashboard-wrapper {
      height: 100%;
      width: 100%;
      display: none;
      grid-template-columns: 220px 1fr;
      background: #0a0a0a;
      overflow: hidden;
      position: relative;
      gap: 0;
    }
    
    /* Sidebar */
    .sidebar {
      background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
      border-left: 2px solid #F2BC1B;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      padding: 10px;
      gap: 6px;
      position: relative;
      z-index: 100;
    }
    
    .sidebar::-webkit-scrollbar {
      width: 6px;
    }
    
    .sidebar::-webkit-scrollbar-track {
      background: #1a1a1a;
    }
    
    .sidebar::-webkit-scrollbar-thumb {
      background: #F2BC1B;
      border-radius: 3px;
    }
    
    .logo-section {
      text-align: center;
      padding: 10px 0 12px 0;
      border-bottom: 1px solid #333;
      margin-bottom: 8px;
    }
    
    .logo-section img {
      max-width: 100px;
      height: auto;
      margin: 0 auto 6px;
    }
    
    .logo-section h1 {
      font-size: 16px;
      font-weight: 700;
      color: #F2BC1B;
      margin: 0;
    }
    
    .service-item {
      background: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 5px;
      padding: 8px 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .service-item:hover {
      background: #353535;
      border-color: #F2BC1B;
      transform: translateX(-2px);
    }
    
    .service-item.active {
      background: #F2BC1B;
      border-color: #F2BC1B;
      color: #000;
      font-weight: 700;
    }
    
    .service-item .icon {
      font-size: 18px;
      width: 22px;
      text-align: center;
      color: #F2BC1B;
    }
    
    .service-item.active .icon {
      color: #000;
    }
    
    .service-item .label {
      flex: 1;
      font-size: 14px;
      color: #F2BC1B;
      font-weight: 600;
    }
    
    .service-item.active .label {
      color: #000;
    }
    
    /* Submenu styling */
    .service-submenu {
      display: none;
      flex-direction: column;
      gap: 4px;
      margin-top: 4px;
      margin-right: 20px;
      padding-right: 8px;
      border-right: 2px solid #404040;
    }
    
    .service-submenu.show {
      display: flex;
    }
    
    .service-item.has-submenu .arrow {
      margin-right: auto;
      font-size: 12px;
      transition: transform 0.2s ease;
    }
    
    .service-item.has-submenu.expanded .arrow {
      transform: rotate(180deg);
    }
    
    .service-item.submenu-item {
      padding: 6px 8px;
      font-size: 13px;
    }
    
    /* Main Content */
    .main-content {
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: #0a0a0a;
      height: 100%;
    }
    
    /* Header Bar */
    .header-bar {
      background: #1a1a1a;
      border-bottom: 2px solid #F2BC1B;
      padding: 8px 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }
    
    .header-bar h2 {
      font-size: 18px;
      font-weight: 700;
      color: #F2BC1B;
      margin: 0;
    }
    
    .header-bar .status {
      font-size: 13px;
      color: #10b981;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .status-dot {
      width: 7px;
      height: 7px;
      background: #10b981;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    /* Content Area */
    .content-area {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 12px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      grid-auto-rows: max-content;
      gap: 10px;
      align-content: start;
    }
    
    .content-area::-webkit-scrollbar {
      width: 8px;
    }
    
    .content-area::-webkit-scrollbar-track {
      background: #1a1a1a;
    }
    
    .content-area::-webkit-scrollbar-thumb {
      background: #F2BC1B;
      border-radius: 4px;
    }
    
    /* Form Sections */
    .form-section {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 5px;
      padding: 10px;
      height: fit-content;
    }
    
    .form-section.full-width {
      grid-column: 1 / -1;
    }

    /* Ensure insurance results span full page width (only results, not the search input) */
    #insuranceResults {
      grid-column: 1 / -1;
      width: 100%;
      box-sizing: border-box;
      padding: 0;
      margin-top: 8px;
    }

    #insuranceResults .data-table-container {
      grid-column: 1 / -1;
      width: 100%;
      margin: 0 0 15px 0;
    }

    #insuranceResults .table-scroll,
    #insuranceResults > div > .table-scroll {
      overflow-x: auto;
      width: 100%;
    }

    #insuranceResults .data-table {
      width: 100%;
      table-layout: auto;
    }
    
    .section-title {
      font-size: 14px;
      font-weight: 700;
      color: #F2BC1B;
      margin: 0 0 8px 0;
      padding-bottom: 5px;
      border-bottom: 1px solid #333;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
    }
    
    .form-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .form-field label {
      font-size: 13px;
      color: #999;
      font-weight: 600;
    }
    
    .form-control {
      background: #262626;
      border: 1px solid #404040;
      border-radius: 4px;
      padding: 8px 12px;
      color: #fff;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    .form-control:focus {
      outline: none;
      border-color: #F2BC1B;
      background: #2d2d2d;
    }
    
    .form-control::placeholder {
      color: #666;
    }

    /* Custom datetime input to match theme */
    .datetime-control {
      background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
      border: 1px solid #F2BC1B;
      color: #F2BC1B;
      box-shadow: 0 6px 16px rgba(242, 188, 27, 0.1);
      cursor: pointer;
    }

    .datetime-control::-webkit-calendar-picker-indicator {
      filter: invert(67%) sepia(76%) saturate(580%) hue-rotate(4deg) brightness(102%) contrast(101%);
      cursor: pointer;
    }

    .datetime-control::-webkit-datetime-edit-fields-wrapper,
    .datetime-control::-webkit-datetime-edit-year-field,
    .datetime-control::-webkit-datetime-edit-month-field,
    .datetime-control::-webkit-datetime-edit-day-field,
    .datetime-control::-webkit-datetime-edit-hour-field,
    .datetime-control::-webkit-datetime-edit-minute-field {
      color: #F2BC1B;
      padding: 0 2px;
    }

    .datetime-control::-webkit-datetime-edit-text {
      color: #888;
    }

    /* Modal styles (shared for carwash & mechanical booking) */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 16px;
    }

    .modal-overlay.hidden { display: none; }

    .modal {
      background: #0f0f0f;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 16px;
      width: min(520px, 100%);
      position: relative;
      box-shadow: 0 14px 40px rgba(0,0,0,0.4), 0 0 0 1px rgba(242,188,27,0.1);
    }

    .modal h3 {
      margin: 0 0 10px 0;
      color: #F2BC1B;
      font-size: 16px;
      font-weight: 800;
    }

    .modal .modal-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-start;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .modal .modal-actions .btn-primary { min-width: 140px; }

    .modal .modal-actions .btn-secondary {
      background: #2a2a2a;
      color: #fff;
      border: 1px solid #444;
      padding: 10px 14px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .modal .modal-actions .btn-secondary:hover {
      background: #333;
      border-color: #555;
    }

    .modal .modal-message {
      margin-top: 10px;
      padding: 10px;
      border-radius: 6px;
      font-size: 13px;
      line-height: 1.5;
    }

    .modal .modal-message.success {
      background: #0f3f2b;
      border: 1px solid #10b981;
      color: #10b981;
    }

    .modal .modal-message.error {
      background: #3f1a1a;
      border: 1px solid #ef4444;
      color: #ef4444;
    }

    .modal-close {
      position: absolute;
      top: 12px;
      left: 12px;
      background: transparent;
      border: none;
      color: #777;
      font-size: 18px;
      cursor: pointer;
    }
    
    /* Buttons */
    .btn-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 6px;
      margin-top: 6px;
    }
    
    .btn-option {
      background: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 4px;
      padding: 10px 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
      font-size: 13px;
      color: #ccc;
      font-weight: 600;
    }
    
    .btn-option:hover {
      background: #353535;
      border-color: #F2BC1B;
    }
    
    .btn-option.active {
      background: #F2BC1B;
      border-color: #F2BC1B;
      color: #000;
      font-weight: 700;
    }
    
    .btn-primary {
      background: #F2BC1B;
      color: #000;
      border: none;
      padding: 12px 20px;
      border-radius: 5px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
      margin-top: 10px;
    }
    
    .btn-primary:hover {
      background: #d9a616;
      transform: translateY(-2px);
    }
    
    /* Back Button */
    .btn-back {
      background: #F2BC1B;
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-back:hover {
      background: #d9a616;
      transform: translateY(-2px);
    }
    
  /* Data Table */
  .data-table-container {
  grid-column: 1 / -1;
  background: #1a1a1a;
  border: 1px solid #333;
  border-radius: 5px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  max-height: 350px;
}    
    .table-header {
      background: #F2BC1B;
      padding: 10px 12px;
      font-size: 15px;
      font-weight: 700;
      color: #000;
    }
    
    .table-scroll {
      overflow-y: auto;
      max-height: 300px;
    }
    
    .table-scroll::-webkit-scrollbar {
      width: 5px;
    }
    
    .table-scroll::-webkit-scrollbar-track {
      background: #262626;
    }
    
    .table-scroll::-webkit-scrollbar-thumb {
      background: #F2BC1B;
      border-radius: 3px;
    }
    
    .data-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .data-table th {
      background: #262626;
      color: #F2BC1B;
      font-size: 14px;
      font-weight: 700;
      padding: 11px;
      text-align: center;
      border-bottom: 1px solid #404040;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
  .data-table td {
  padding: 10px 12px;
  font-size: 14px;
  color: #ccc;
  text-align: center;
  border-bottom: 1px solid #333;
}
    
    .data-table tr:hover td {
      background: #262626;
    }
    
    .data-table .highlight {
      color: #F2BC1B;
      font-weight: 600;
      font-size: 15px;
    }
    
    /* Info Boxes */
    .info-box {
      background: #1a3a52;
      border: 1px solid #3b82f6;
      border-radius: 4px;
      padding: 10px 12px;
      font-size: 13px;
      color: #93c5fd;
      margin-top: 7px;
    }
    
    .warning-box {
      background: #4a3a1a;
      border: 1px solid #f59e0b;
      border-radius: 4px;
      padding: 10px 12px;
      font-size: 13px;
      color: #fbbf24;
      margin-top: 7px;
    }
    
    .error-box {
      background: #4a1a1a;
      border: 1px solid #ef4444;
      border-radius: 4px;
      padding: 10px 12px;
      font-size: 13px;
      color: #fca5a5;
      margin-top: 7px;
    }
    
    /* Loading */
    .spinner {
      border: 2px solid #333;
      border-top: 2px solid #F2BC1B;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .hidden {
      display: none !important;
    }
    
    /* Login Page Styles */
    .login-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .login-box {
      background: linear-gradient(145deg, #1a1a1a 0%, #262626 100%);
      border: 2px solid #F2BC1B;
      border-radius: 12px;
      padding: 40px 50px;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 20px 60px rgba(242, 188, 27, 0.2),
                  0 0 100px rgba(242, 188, 27, 0.05);
    }
    
    .login-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .login-header h1 {
      font-size: 28px;
      font-weight: 700;
      color: #F2BC1B;
      margin: 0 0 8px 0;
      text-shadow: 0 0 20px rgba(242, 188, 27, 0.3);
    }
    
    .login-header p {
      font-size: 14px;
      color: #999;
      margin: 0;
    }
    
    .login-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .login-field {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .login-field label {
      font-size: 14px;
      color: #F2BC1B;
      font-weight: 600;
    }
    
    .login-input {
      background: #0a0a0a;
      border: 2px solid #333;
      border-radius: 8px;
      padding: 12px 16px;
      color: #fff;
      font-size: 16px;
      transition: all 0.3s ease;
    }
    
    .login-input:focus {
      outline: none;
      border-color: #F2BC1B;
      background: #0f0f0f;
      box-shadow: 0 0 20px rgba(242, 188, 27, 0.1);
    }
    
    .login-input::placeholder {
      color: #555;
    }
    
    .remember-me {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: -8px;
    }
    
    .remember-me input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #F2BC1B;
    }
    
    .remember-me label {
      font-size: 14px;
      color: #ccc;
      cursor: pointer;
      user-select: none;
    }
    
    .login-button {
      background: linear-gradient(135deg, #F2BC1B 0%, #d4a319 100%);
      border: none;
      border-radius: 8px;
      padding: 14px;
      color: #000;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 10px;
    }
    
    .login-button:hover {
      background: linear-gradient(135deg, #d4a319 0%, #F2BC1B 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(242, 188, 27, 0.3);
    }
    
    .login-button:active {
      transform: translateY(0);
    }
    
    .login-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .login-error {
      background: #4a1a1a;
      border: 1px solid #ef4444;
      border-radius: 6px;
      padding: 12px;
      color: #fca5a5;
      font-size: 13px;
      text-align: center;
      margin-top: -8px;
      animation: shake 0.5s ease;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    
    .logout-btn {
      background: #4a1a1a;
      border: 1px solid #ef4444;
      color: #fca5a5;
      padding: 6px 14px;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .logout-btn:hover {
      background: #5a1a1a;
      border-color: #ff5555;
      color: #fff;
      transform: translateY(-1px);
    }
    
    /* Logout Confirmation Modal */
    .logout-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      animation: fadeIn 0.2s ease;
    }
    
    .logout-modal {
      background: linear-gradient(145deg, #1a1a1a 0%, #262626 100%);
      border: 2px solid #ef4444;
      border-radius: 12px;
      padding: 35px 40px;
      width: 420px;
      max-width: 90%;
      box-shadow: 0 20px 60px rgba(239, 68, 68, 0.3),
                  0 0 100px rgba(239, 68, 68, 0.1);
      animation: slideIn 0.3s ease;
      text-align: center;
    }
    
    .logout-modal-icon {
      font-size: 64px;
      margin-bottom: 20px;
      animation: pulse 2s infinite;
    }
    
    .logout-modal-title {
      font-size: 24px;
      font-weight: 700;
      color: #ef4444;
      margin: 0 0 12px 0;
      text-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
    }
    
    .logout-modal-message {
      font-size: 15px;
      color: #ccc;
      margin: 0 0 30px 0;
      line-height: 1.6;
    }
    
    .logout-modal-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    
    .logout-modal-btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .logout-modal-btn-confirm {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: #fff;
    }
    
    .logout-modal-btn-confirm:hover {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
    }
    
    .logout-modal-btn-cancel {
      background: #262626;
      color: #F2BC1B;
      border: 2px solid #404040;
    }
    
    .logout-modal-btn-cancel:hover {
      background: #333;
      border-color: #F2BC1B;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(242, 188, 27, 0.2);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from {
        transform: translateY(-30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .login-box {
        padding: 30px 25px;
        width: 90%;
      }
      
      .login-header h1 {
        font-size: 24px;
      }
      
      .logout-modal {
        padding: 25px 20px;
        width: 90%;
      }
      
      .logout-modal-icon {
        font-size: 48px;
      }
      
      .logout-modal-title {
        font-size: 20px;
      }
    }
    
    /* Login Page Styles */
    .login-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .login-box {
      background: linear-gradient(145deg, #1a1a1a 0%, #262626 100%);
      border: 2px solid #F2BC1B;
      border-radius: 12px;
      padding: 40px 50px;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 20px 60px rgba(242, 188, 27, 0.2),
                  0 0 100px rgba(242, 188, 27, 0.05);
    }
    
    .login-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .login-header h1 {
      font-size: 28px;
      font-weight: 700;
      color: #F2BC1B;
      margin: 0 0 8px 0;
      text-shadow: 0 0 20px rgba(242, 188, 27, 0.3);
    }
    
    .login-header p {
      font-size: 14px;
      color: #999;
      margin: 0;
    }
    
    .login-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .login-field {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .login-field label {
      font-size: 14px;
      color: #F2BC1B;
      font-weight: 600;
    }
    
    .login-input {
      background: #0a0a0a;
      border: 2px solid #333;
      border-radius: 8px;
      padding: 12px 16px;
      color: #fff;
      font-size: 16px;
      transition: all 0.3s ease;
    }
    
    .login-input:focus {
      outline: none;
      border-color: #F2BC1B;
      background: #0f0f0f;
      box-shadow: 0 0 20px rgba(242, 188, 27, 0.1);
    }
    
    .login-input::placeholder {
      color: #555;
    }
    
    .remember-me {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: -8px;
    }
    
    .remember-me input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #F2BC1B;
    }
    
    .remember-me label {
      font-size: 14px;
      color: #ccc;
      cursor: pointer;
      user-select: none;
    }
    
    .login-button {
      background: linear-gradient(135deg, #F2BC1B 0%, #d4a319 100%);
      border: none;
      border-radius: 8px;
      padding: 14px;
      color: #000;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 10px;
    }
    
    .login-button:hover {
      background: linear-gradient(135deg, #d4a319 0%, #F2BC1B 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(242, 188, 27, 0.3);
    }
    
    .login-button:active {
      transform: translateY(0);
    }
    
    .login-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .login-error {
      background: #4a1a1a;
      border: 1px solid #ef4444;
      border-radius: 6px;
      padding: 12px;
      color: #fca5a5;
      font-size: 13px;
      text-align: center;
      margin-top: -8px;
      animation: shake 0.5s ease;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    
    .logout-btn {
      background: #4a1a1a;
      border: 1px solid #ef4444;
      color: #fca5a5;
      padding: 6px 14px;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .logout-btn:hover {
      background: #5a1a1a;
      border-color: #ff5555;
      color: #fff;
      transform: translateY(-1px);
    }
    
    /* Fullscreen Iframe Container */
    .fullscreen-iframe-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #0a0a0a;
      z-index: 1000;
      display: flex;
      flex-direction: column;
    }
    
    .fullscreen-iframe-header {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 10;
      background: transparent;
      border: none;
      padding: 0;
      pointer-events: none;
    }
    
    .fullscreen-iframe-header .btn-back {
      pointer-events: all;
      background: rgba(242, 188, 27, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .fullscreen-iframe-header .btn-back:hover {
      background: rgba(217, 166, 22, 0.95);
    }
    
    .fullscreen-iframe-container {
      flex: 1;
      width: 100%;
      overflow: hidden;
    }
    
    .fullscreen-iframe-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    /* Wash Cards Compact */
    .wash-cards-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-top: 6px;
    }
    
    .wash-card-compact {
      background: #262626;
      border: 1px solid #404040;
      border-radius: 4px;
      padding: 8px;
      transition: all 0.2s ease;
    }
    
    .wash-card-compact:hover {
      border-color: #F2BC1B;
      transform: translateY(-2px);
    }
    
    .wash-card-compact h3 {
      font-size: 14px;
      color: #F2BC1B;
      margin: 0 0 5px 0;
      font-weight: 700;
    }
    
    .wash-card-compact .price {
      font-size: 13px;
      color: #fff;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .wash-card-compact ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .wash-card-compact li {
      font-size: 12px;
      color: #999;
      padding: 2px 0;
      padding-right: 14px;
      position: relative;
      line-height: 1.3;
    }
    
    .wash-card-compact li:before {
      content: "âœ“";
      position: absolute;
      right: 0;
      top: 2px;
      color: #10b981;
      font-weight: bold;
      font-size: 10px;
    }
    
    /* Copy Button */
    .copy-btn-small {
      background: #F2BC1B;
      color: #000;
      border: none;
      border-radius: 3px;
      padding: 6px 8px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      margin-top: 5px;
      transition: all 0.2s ease;
    }
    
    .copy-btn-small:hover {
      background: #d9a616;
    }
    
    .copy-btn-small.success {
      background: #10b981;
      color: #fff;
    }

    /* Completed months floating box */
    .completed-months {
      position: fixed;
      left: 12px;
      top: 12px;
      background: rgba(10,10,10,0.95);
      border: 1px solid #333;
      padding: 10px;
      border-radius: 6px;
      z-index: 1200;
      max-height: 80vh;
      overflow: auto;
      width: 360px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.6);
    }
    .animated-highlight{ animation: glowGradient 6s linear infinite; background: linear-gradient(90deg, rgba(242,188,27,0.12), rgba(242,188,27,0.04)); border:1px solid rgba(242,188,27,0.2); }
    @keyframes glowGradient{ 0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%} }
    .completed-months h4{ color: #F2BC1B; margin:0 0 8px 0; font-size:14px }
    .completed-months .month-block{ border-top:1px dashed #333; padding-top:8px; margin-top:8px }
    .completed-months .month-title{ color:#ccc; font-weight:700; font-size:13px; margin-bottom:6px }
    .completed-months .top3{ display:flex; gap:8px; margin-bottom:6px }
    .completed-months .top3 div{ flex:1; text-align:center; padding:6px; border-radius:6px; background:#0f0f0f; border:1px solid #222 }
    .completed-months .others{ display:flex; gap:8px; flex-wrap:wrap; align-items:stretch }
    .completed-months .others div{ flex:1 0 45%; color:#fff; text-align:center; font-size:18px; padding:10px; display:flex; align-items:center; justify-content:center }
    .completed-toggle{ position: fixed; left: 12px; top: 12px; width:36px; height:36px; background:#0a0a0a; border:1px solid #333; border-radius:6px; z-index:1300; display:flex; align-items:center; justify-content:center; cursor:pointer }
    .completed-toggle .lines{ width:18px; height:14px; display:flex; flex-direction:column; gap:3px }
    .completed-toggle .lines span{ display:block; height:2px; background:#F2BC1B; border-radius:2px }
    .completed-toggle-inline{ width:36px; height:36px; background:#0a0a0a; border:1px solid #333; border-radius:6px; display:flex; align-items:center; justify-content:center; cursor:pointer; margin-left:6px }
    .completed-toggle-inline .lines{ width:16px; height:12px; display:flex; flex-direction:column; gap:3px }
    .completed-toggle-inline .lines span{ display:block; height:2px; background:#F2BC1B; border-radius:2px }
    .completed-months .no-data{ color:#bbb; font-size:14px; text-align:center; padding:8px }
    /* Protection cards and logos */
    .data-card {
      padding:14px;
      border:1px solid rgba(255,215,0,0.06);
      border-radius:12px;
      background: linear-gradient(180deg,#0f1214 0%, #071018 100%);
      color:#e6e6e6;
      box-shadow: 0 12px 30px rgba(0,0,0,0.65);
      min-height:110px;
    }
    .data-card h4{ margin:0 0 10px 0; color:#F2BC1B; font-size:15px }
    .prot-logos-grid{ display:flex; gap:14px; align-items:center; }
    .prot-logo{ max-height:80px; width:auto; object-fit:contain; cursor:pointer; padding:12px; border-radius:12px; background:linear-gradient(180deg,#070909,#0b0b0b); border:1px solid rgba(255,255,255,0.03); box-shadow: 0 8px 20px rgba(0,0,0,0.6); transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease }
    .prot-logo:hover{ transform: translateY(-4px); box-shadow: 0 14px 30px rgba(0,0,0,0.7) }
    .prot-logo.active{ border-color:#F2BC1B; box-shadow: 0 14px 36px rgba(242,188,27,0.06); transform: translateY(-4px) }
    .prot-transport{ margin-top:12px;padding:14px;border-radius:10px;background:#7f1d1d;color:#fff;border:1px solid #f87171; box-shadow: 0 8px 24px rgba(0,0,0,0.6) }
    .prot-note{ margin-top:18px; padding:14px; border-radius:10px; background: linear-gradient(180deg,#071018, #08131a); border:1px solid #123; color:#dbeafe }
    /* Important red message used in protection results (single red note as requested) */
    .prot-important{ margin-top:12px; padding:12px; border-radius:8px; background: rgba(127,29,29,0.04); border:1px solid #ef4444; color:#ffb3b3; font-weight:700 }
    .prot-toast{ position:fixed; top:80px; right:40px; background:#F2BC1B; color:#000; padding:12px 16px; border-radius:10px; border:1px solid rgba(0,0,0,0.12); box-shadow:0 12px 40px rgba(0,0,0,0.6); display:none; z-index:1500; font-weight:700 }
    
    /* Ramadan Decorations */
    .ramadan-decoration {
      position: fixed;
      z-index: 5;
      pointer-events: none;
    }
    
    /* Top Right Corner Decoration */
    .ramadan-corner-tr {
      top: 0;
      right: 0;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle at 100% 0%, rgba(242, 188, 27, 0.15), transparent 70%);
      border-radius: 0 0 0 200px;
    }
    
    /* Top Left Corner Decoration */
    .ramadan-corner-tl {
      top: 0;
      left: 0;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle at 0% 0%, rgba(242, 188, 27, 0.15), transparent 70%);
      border-radius: 0 0 200px 0;
    }
    
    /* Bottom Right Corner Decoration */
    .ramadan-corner-br {
      bottom: 0;
      right: 0;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle at 100% 100%, rgba(242, 188, 27, 0.15), transparent 70%);
      border-radius: 200px 0 0 0;
    }
    
    /* Bottom Left Corner Decoration */
    .ramadan-corner-bl {
      bottom: 0;
      left: 0;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle at 0% 100%, rgba(242, 188, 27, 0.15), transparent 70%);
      border-radius: 0 200px 0 0;
    }
    
    /* Crescent Moon */
    .crescent-moon {
      position: fixed;
      width: 80px;
      height: 80px;
      top: 30px;
      right: 30px;
      z-index: 10;
      animation: moonFloat 6s ease-in-out infinite;
    }
    
    @keyframes moonFloat {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }
    
    /* Star decorations */
    .star {
      position: fixed;
      z-index: 8;
      animation: starTwinkle 3s ease-in-out infinite;
      pointer-events: none;
    }
    
    @keyframes starTwinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }
    
    .star-1 { top: 60px; right: 150px; font-size: 20px; animation-delay: 0s; }
    .star-2 { top: 40px; right: 220px; font-size: 16px; animation-delay: 0.5s; }
    .star-3 { bottom: 120px; right: 80px; font-size: 18px; animation-delay: 1s; }
    .star-4 { bottom: 80px; right: 160px; font-size: 14px; animation-delay: 1.5s; }
    .star-5 { top: 100px; left: 40px; font-size: 18px; animation-delay: 2s; }
    .star-6 { top: 60px; left: 120px; font-size: 16px; animation-delay: 0.8s; }
    .star-7 { bottom: 100px; left: 50px; font-size: 20px; animation-delay: 1.2s; }
    .star-8 { bottom: 60px; left: 140px; font-size: 14px; animation-delay: 2.2s; }
    
    /* Lantern decorations */
    .lantern {
      position: fixed;
      z-index: 7;
      animation: lanternSway 4s ease-in-out infinite;
      pointer-events: none;
    }
    
    @keyframes lanternSway {
      0%, 100% { transform: translateX(0px) rotate(-2deg); }
      50% { transform: translateX(15px) rotate(2deg); }
    }
    
    .lantern-1 { top: 100px; right: 20px; font-size: 40px; animation-delay: 0s; }
    .lantern-2 { bottom: 100px; right: 20px; font-size: 40px; animation-delay: 1s; }
    .lantern-3 { top: 150px; left: 20px; font-size: 40px; animation-delay: 0.5s; }
    .lantern-4 { bottom: 150px; left: 20px; font-size: 40px; animation-delay: 1.5s; }
    
    /* Dates decoration */
    .date-palm {
      position: fixed;
      z-index: 6;
      animation: dateFloat 5s ease-in-out infinite;
      pointer-events: none;
    }
    
    @keyframes dateFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-15px); }
    }
    
    .date-1 { top: 300px; right: 30px; font-size: 24px; animation-delay: 0s; }
    .date-2 { bottom: 300px; right: 40px; font-size: 24px; animation-delay: 1.2s; }
    .date-3 { top: 350px; left: 30px; font-size: 24px; animation-delay: 0.6s; }
    .date-4 { bottom: 280px; left: 35px; font-size: 24px; animation-delay: 1.8s; }
    
    /* Imsakia (Ramadan Schedule) Styles */
    .imsakia-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .imsakia-header {
      background: linear-gradient(135deg, #F2BC1B 0%, #d4a319 100%);
      color: #000;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      font-weight: 700;
      font-size: 20px;
      box-shadow: 0 8px 24px rgba(242, 188, 27, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    
    .imsakia-lantern {
      font-size: 28px;
      animation: lanternSway 4s ease-in-out infinite;
    }
    
    .imsakia-filter {
      background: #1a1a1a;
      border: 1px solid #F2BC1B;
      padding: 12px 16px;
      border-radius: 8px;
      color: #F2BC1B;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .imsakia-filter:hover {
      background: #262626;
      box-shadow: 0 0 20px rgba(242, 188, 27, 0.1);
    }
    
    .imsakia-table {
      width: 100%;
      border-collapse: collapse;
      background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    }
    
    .imsakia-table thead {
      background: linear-gradient(135deg, #1a1a1a 0%, #262626 100%);
      border-bottom: 2px solid #F2BC1B;
    }
    
    .imsakia-table th {
      padding: 14px;
      color: #F2BC1B;
      font-weight: 700;
      text-align: right;
      border-right: 1px solid #333;
      font-size: 14px;
    }
    
    .imsakia-table th:first-child {
      border-right: none;
    }
    
    .imsakia-table tbody tr {
      border-bottom: 1px solid #262626;
      transition: all 0.3s ease;
    }
    
    .imsakia-table tbody tr:hover {
      background: rgba(242, 188, 27, 0.05);
      border-bottom-color: #F2BC1B;
    }
    
    .imsakia-table tbody tr.current-day {
      background: linear-gradient(90deg, rgba(242,188,27,0.1), transparent);
      border: 2px solid #F2BC1B;
      border-right: 2px solid #F2BC1B;
    }
    
    .imsakia-table td {
      padding: 12px 14px;
      color: #ccc;
      text-align: right;
      border-right: 1px solid #333;
      font-size: 13px;
    }
    
    .imsakia-table td:first-child {
      border-right: none;
      font-weight: 600;
      color: #F2BC1B;
    }
    
    .imsakia-table tbody tr.current-day td:first-child {
      color: #FFD700;
      font-size: 15px;
      font-weight: 700;
    }
    
    .prayer-time {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .prayer-time.current {
      color: #FFD700;
      font-weight: 700;
      animation: highlight 1s ease-in-out infinite alternate;
    }
    
    @keyframes highlight {
      from { text-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
      to { text-shadow: 0 0 20px rgba(255, 215, 0, 0.6); }
    }
    
    .next-prayer-info {
      background: linear-gradient(135deg, #1a3a1a 0%, #0f2a0f 100%);
      border: 1px solid #4ade80;
      border-radius: 8px;
      padding: 14px;
      margin-top: 12px;
      color: #86efac;
      text-align: center;
      font-weight: 600;
      animation: slideIn 0.5s ease;
    }
    
    .iftar-countdown {
      background: linear-gradient(135deg, #3a1a1a 0%, #2a0f0f 100%);
      border: 2px solid #ef4444;
      border-radius: 8px;
      padding: 16px;
      margin-top: 12px;
      color: #fca5a5;
      text-align: center;
      font-weight: 700;
      animation: pulse 2s ease-in-out infinite;
    }
    
    .countdown-number {
      font-size: 28px;
      color: #fca5a5;
      font-weight: 900;
      display: inline-block;
      margin: 0 4px;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    
    /* Service item Ramadan decoration */
    .service-item::before {
      content: 'ğŸŒ™';
      margin-right: 4px;
      font-size: 14px;
      animation: itemFloat 2s ease-in-out infinite;
    }
    
    @keyframes itemFloat {
      0%, 100% { transform: translateY(0px) scale(1); opacity: 1; }
      50% { transform: translateY(-3px) scale(1.05); opacity: 0.8; }
    }
    
    /* Header title animation for Ramadan text */
    @keyframes fadeInOut {
      0% { opacity: 0; transform: scale(0.95); }
      50% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(0.95); }
    }
    
    .ramadan-text {
      display: inline-block;
      animation: fadeInOut 3s ease-in-out infinite;
      margin-right: 8px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  
  <!-- Login Page -->
  <div id="loginContainer" class="login-container hidden">
    <div class="login-box">
      <div class="login-header">
        <img src="https://i.top4top.io/p_35860o72q1.png" alt="Ø¨ÙˆØ±ØªØ±Ø§Ø¬" style="width: 150px; height: auto; margin: 0 auto 20px; display: block;">
      </div>
      
      <form id="loginForm" class="login-form">
        <div style="text-align: center; margin-bottom: 12px; font-size: 14px; color: #F2BC1B; font-weight: 700;">
          ğŸŒ™ Ù…Ø¨Ø§Ø±Ùƒ Ø¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø´Ù‡Ø± - Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ… ğŸŒ™
        </div>
        <div class="login-field">
          <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
          <input 
            type="text" 
            id="username" 
            class="login-input" 
            placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"
            autocomplete="username"
            required
          />
        </div>
        
        <div class="login-field">
          <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <input 
            type="password" 
            id="password" 
            class="login-input" 
            placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
            autocomplete="current-password"
            required
          />
        </div>
        
        <div class="remember-me">
          <input type="checkbox" id="rememberMe" />
          <label for="rememberMe">ØªØ°ÙƒØ±Ù†ÙŠ</label>
        </div>
        
        <div id="loginError" class="login-error hidden"></div>
        
        <button type="submit" id="loginButton" class="login-button">
          Ø¯Ø®ÙˆÙ„
        </button>
      </form>
    </div>
  </div>
  
  <!-- Logout Confirmation Modal -->
  <div id="logoutModal" class="logout-modal-overlay hidden">
    <div class="logout-modal">
      <div class="logout-modal-icon">âš ï¸</div>
      <h2 class="logout-modal-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</h2>
      <p class="logout-modal-message">
        Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ<br>
        Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù„Ø³Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©.
      </p>
      <div class="logout-modal-buttons">
        <button id="logoutCancel" class="logout-modal-btn logout-modal-btn-cancel">Ø¥Ù„ØºØ§Ø¡</button>
        <button id="logoutConfirm" class="logout-modal-btn logout-modal-btn-confirm">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      </div>
    </div>
  </div>
  
  <div class="dashboard-wrapper" id="dashboardWrapper"><!-- Sidebar -->
   <aside class="sidebar" id="sidebar">
    <div class="logo-section"><img src="https://i.top4top.io/p_35860o72q1.png" alt="Logo">
     <h1 id="siteTitle">Ø®Ø¯Ù…Ø§Øª Ø¨ÙˆØ±ØªØ±Ø§Ø¬</h1>
    </div>
    <div class="service-item has-submenu" data-service="staff"><span class="icon">ğŸ‘¥</span> <span class="label">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span> <span class="arrow">â–¼</span>
    </div>
    <div class="service-submenu" id="staffSubmenu">
     <div class="service-item submenu-item" data-service="staff_centers"><span class="label">Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
     </div>
    </div>
    <div class="service-item" data-service="tow"><span class="icon">ğŸšš</span> <span class="label">ÙˆÙ†Ø´Ø§Øª</span>
    </div>
    <div class="service-item has-submenu" data-service="battery"><span class="icon">ğŸ”‹</span> <span class="label">Ø¨Ø·Ø§Ø±ÙŠØ©</span> <span class="arrow">â–¼</span>
    </div>
    <div class="service-submenu" id="batterySubmenu">
     <div class="service-item submenu-item" data-service="batterySubscription"><span class="label">Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø·Ø§Ø±ÙŠØ©</span>
     </div>
     <div class="service-item submenu-item" data-service="newBattery"><span class="label">Ø¨Ø·Ø§Ø±ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</span>
     </div>
     <div class="service-item submenu-item" data-service="batteryInstall"><span class="label">ØªØ±ÙƒÙŠØ¨ Ø¨Ø·Ø§Ø±ÙŠØ©</span>
     </div>
    </div>
    <div class="service-item" data-service="fuel"><span class="icon">â›½</span> <span class="label">Ø®Ø¯Ù…Ø© Ø¨Ù†Ø²ÙŠÙ†</span>
    </div>
    <div class="service-item" data-service="unlock"><span class="icon">ğŸ”“</span> <span class="label">ÙØªØ­ Ù‚ÙÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</span>
    </div>
    <div class="service-item has-submenu" data-service="tire"><span class="icon">ğŸ“€</span> <span class="label">Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø¨Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª</span> <span class="arrow">â–¼</span>
    </div>
    <div class="service-submenu" id="tireSubmenu">
     <div class="service-item submenu-item" data-service="puncture"><span class="label">Ø¨Ù†Ø´Ø±</span>
     </div>
     <div class="service-item submenu-item" data-service="tireIncrease"><span class="label">Ø²ÙŠØ§Ø¯Ø§Øª Ø§Ù„ØªÙˆØ§ÙŠØ±</span>
     </div>
     <div class="service-item submenu-item" data-service="tireSheet"><span class="label">Ø´ÙŠØª Ø§Ù„ØªÙˆØ§ÙŠØ±</span>
     </div>
     <div class="service-item submenu-item" data-service="balance"><span class="label">Ù…ÙŠØ²Ø§Ù† ÙˆØªØ±ÙƒÙŠØ¨</span>
     </div>
     <div class="service-item submenu-item" data-service="ringRepair"><span class="label">ØªØµÙ„ÙŠØ­ Ø§Ù„Ø±Ù†Ù‚Ø§Øª</span>
     </div>
    </div>
    <div class="service-item" data-service="mechanical"><span class="icon">ğŸ”©</span> <span class="label">Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©</span>
    </div>
    <div class="service-item" data-service="carwash"><span class="icon">ğŸ’§</span> <span class="label">ØºØ³ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</span>
    </div>
    <div class="service-item" data-service="protection"><span class="icon">ğŸ›¡ï¸</span> <span class="label">Ø§Ù„Ø­Ù…Ø§ÙŠÙ‡ ÙˆØ§Ù„ØªØºÙŠÙ…</span>
    </div>
    <div class="service-item" data-service="insurance"><span class="icon">ğŸš§</span> <span class="label">ØªØ£Ù…ÙŠÙ†Ø§Øª</span>
    </div>
    <div class="service-item" data-service="annualSubscription"><span class="icon">ğŸ“…</span> <span class="label">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ</span>
    </div>
    <div class="service-item" data-service="imsakia"><span class="icon">ğŸŒ™</span> <span class="label">Ø§Ù…Ø³Ø§ÙƒÙŠÙ‡ Ø±Ù…Ø¶Ø§Ù†</span>
    </div>
   </aside><!-- Main Content -->
   <main class="main-content"><!-- Header Bar -->
    <header class="header-bar">
     <h2 id="serviceTitle">Ø§Ø®ØªØ± Ø®Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
     <div style="display: flex; align-items: center; gap: 15px;">
       <div class="status"><span class="status-dot"></span> <span>Ù…ØªØµÙ„</span></div>
       <button id="logoutButton" class="logout-btn" style="display: none;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
     </div>
    </header><!-- Content Area -->
    <div id="contentArea" class="content-area">
     <div style="grid-column: 1 / -1; text-align: center; padding: 40px 20px;">
      <div style="font-size: 48px; margin-bottom: 16px;">
       ğŸ“Š
      </div>
      <h3 style="color: #F2BC1B; font-size: 18px; margin-bottom: 8px;">ğŸŒ™ Ù…Ø¨Ø§Ø±Ùƒ Ø¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø´Ù‡Ø± ğŸŒ™</h3>
      <p style="color: #FFD700; font-size: 16px; font-weight: 600;">Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ… âœ¨</p>
     </div>
    </div>
   </main>
  </div><!-- Fullscreen Iframe Wrapper (Hidden by default) -->
  <div id="fullscreenIframeWrapper" class="fullscreen-iframe-wrapper hidden">
   <div class="fullscreen-iframe-header"><button class="btn-back" onclick="closeFullscreenIframe()"> <span>â†</span> <span>Ø±Ø¬ÙˆØ¹</span> </button>
   </div>
   <div class="fullscreen-iframe-container" id="fullscreenIframeContainer">
   </div>
  </div>
  <script>
    // ========== LOGIN SYSTEM ==========
    const GOOGLE_SHEET_ID = '1x2ongtstODqEEWh_jAwN8zLHjsYeIppk8EH_Q1CXMzk';
    const USERS_SHEET_NAME = 'users';
    const GOOGLE_SHEET_URL = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEET_ID}/gviz/tq?tqx=out:json&sheet=${USERS_SHEET_NAME}`;
    
    let usersData = [];
    let isAuthenticated = false;
    
    // Check if user is already logged in
    function checkAuthStatus() {
      const authToken = localStorage.getItem('authToken');
      const rememberMe = localStorage.getItem('rememberMe') === 'true';
      
      if (authToken && rememberMe) {
        isAuthenticated = true;
        showMainApp();
      } else {
        showLogin();
      }
    }
    
    // Load users from Google Sheets
    async function loadUsers() {
      try {
        const response = await fetch(GOOGLE_SHEET_URL);
        const text = await response.text();
        
        // Parse Google Sheets JSON response
        const jsonString = text.substring(47).slice(0, -2);
        const data = JSON.parse(jsonString);
        
        usersData = [];
        if (data.table && data.table.rows) {
          // Skip header row (index 0) and start from index 1
          for (let i = 1; i < data.table.rows.length; i++) {
            const row = data.table.rows[i];
            if (row.c && row.c[0] && row.c[1]) {
              const username = row.c[0].v;
              const password = row.c[1].v;
              if (username && password) {
                usersData.push({ username: String(username), password: String(password) });
              }
            }
          }
        }
        
        console.log('âœ… Users loaded:', usersData.length);
        return true;
      } catch (error) {
        console.error('âŒ Error loading users:', error);
        return false;
      }
    }
    
    // Verify login credentials
    function verifyLogin(username, password) {
      return usersData.some(user => 
        user.username === username && user.password === password
      );
    }
    
    // Show login page
    function showLogin() {
      document.getElementById('loginContainer').classList.remove('hidden');
      document.querySelector('.dashboard-wrapper').style.display = 'none';
      document.getElementById('logoutButton').style.display = 'none';
    }
    
    // Show main app
    function showMainApp() {
      document.getElementById('loginContainer').classList.add('hidden');
      document.querySelector('.dashboard-wrapper').style.display = 'grid';
      document.getElementById('logoutButton').style.display = 'block';
    }
    
    // Initialize login system
    (async function initLogin() {
      await loadUsers();
      checkAuthStatus();
      
      const loginForm = document.getElementById('loginForm');
      const loginError = document.getElementById('loginError');
      const loginButton = document.getElementById('loginButton');
      const logoutButton = document.getElementById('logoutButton');
      
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;
        const rememberMe = document.getElementById('rememberMe').checked;
        
        loginButton.disabled = true;
        loginButton.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
        loginError.classList.add('hidden');
        
        await new Promise(resolve => setTimeout(resolve, 500));
        
        if (verifyLogin(username, password)) {
          const authToken = btoa(username + ':' + Date.now());
          localStorage.setItem('authToken', authToken);
          localStorage.setItem('rememberMe', rememberMe);
          localStorage.setItem('currentUser', username);
          
          isAuthenticated = true;
          showMainApp();
          
          loginForm.reset();
          loginButton.disabled = false;
          loginButton.textContent = 'Ø¯Ø®ÙˆÙ„';
        } else {
          loginError.textContent = 'âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
          loginError.classList.remove('hidden');
          loginButton.disabled = false;
          loginButton.textContent = 'Ø¯Ø®ÙˆÙ„';
          
          document.querySelector('.login-box').style.animation = 'shake 0.5s ease';
          setTimeout(() => {
            document.querySelector('.login-box').style.animation = '';
          }, 500);
        }
      });
      
      // Logout button - show custom modal
      logoutButton.addEventListener('click', () => {
        document.getElementById('logoutModal').classList.remove('hidden');
      });
      
      // Logout modal handlers
      document.getElementById('logoutCancel').addEventListener('click', () => {
        document.getElementById('logoutModal').classList.add('hidden');
      });
      
      document.getElementById('logoutConfirm').addEventListener('click', () => {
        document.getElementById('logoutModal').classList.add('hidden');
        localStorage.removeItem('authToken');
        localStorage.removeItem('rememberMe');
        localStorage.removeItem('currentUser');
        isAuthenticated = false;
        showLogin();
      });
      
      // Close modal when clicking outside
      document.getElementById('logoutModal').addEventListener('click', (e) => {
        if (e.target.id === 'logoutModal') {
          document.getElementById('logoutModal').classList.add('hidden');
        }
      });
    })();
    
    // ========== ORIGINAL APP CODE ==========
    
    // Configuration
    const defaultConfig = {
      site_title: 'Ø®Ø¯Ù…Ø§Øª Ø¨ÙˆØ±ØªØ±Ø§Ø¬',
      sheet_id: '1x2ongtstODqEEWh_jAwN8zLHjsYeIppk8EH_Q1CXMzk',
      currency: 'Ø¯.Ùƒ'
    };

    // Ø«Ø§Ø¨Øª Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ù„Ø®Ø¯Ù…Ø© ÙØªØ­ Ø§Ù„Ù‚ÙÙ„ (Ù…Ù‚Ø¯Ø§Ø± Ø«Ø§Ø¨Øª ÙŠØ¶Ø§Ù Ù„Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ)
    const LOCK_SURCHARGE = 15; // Ø¯.Ùƒ

    let config = { ...defaultConfig };
    let sheetsData = {};
    let currentService = '';
    let formData = {};
    let carWashData = [];
    let lastIframeState = null; // Store last iframe state

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (newConfig) => {
          config = { ...defaultConfig, ...newConfig };
          document.getElementById('siteTitle').textContent = config.site_title;
          
          if (newConfig.sheet_id && newConfig.sheet_id !== sheetsData.currentSheetId) {
            await loadAllSheets();
          }
        },
        mapToCapabilities: () => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['site_title', cfg.site_title || defaultConfig.site_title],
          ['sheet_id', cfg.sheet_id || defaultConfig.sheet_id],
          ['currency', cfg.currency || defaultConfig.currency]
        ])
      });
    }

    // Company mapping
    const companyMapping = {
      'Ø¨ÙˆØ±ØªØ±Ø§Ø¬': 'portarage towtruk',
      'Ù‡ÙŠØ±Ùˆ ÙˆØ±ÙƒØ³': 'hero.works',
      'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù†Ù…': 'Ahmed Al-Ghanem',
      'Ø¨ÙŠÙƒÙˆÙƒ ÙƒÙˆÙ†Ø³ÙŠØ±Ø¬': 'Peacock Concierge',
      'Ø¨Ø±ÙˆØ¬ÙƒØª Ø¥ÙƒØ³ Ø±ÙŠØ³Ù†Ù‚': 'ProjX Racing',
      'ÙŠØ§Ù…Ø§Ù‡Ø§ Ù…ÙˆØªÙˆØ±': 'Yamaha Motor',
      'ÙÙˆÙ„Øª Ù‚Ø§Ø±Ø§Ø¬': 'Vault Garage',
      'Ø¬ÙŠÙ„ÙŠ': 'Geely',
      'Ø§ÙˆØªÙˆ ÙƒØ§Ø¨ÙŠØªØ§Ù„': 'Auto Capital'
    };
    
    const companies = Object.keys(companyMapping);

    // Parse CSV
    function parseCSV(csvText) {
      const rows = [];
      const lines = csvText.split('\n');
      
      for (let line of lines) {
        if (!line.trim()) continue;
        
        const cells = [];
        let cell = '';
        let inQuotes = false;
        
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          
          if (char === '"') {
            if (inQuotes && line[i + 1] === '"') {
              cell += '"';
              i++;
            } else {
              inQuotes = !inQuotes;
            }
          } else if (char === ',' && !inQuotes) {
            cells.push(cell.replace(/^"|"$/g, ''));
            cell = '';
          } else {
            cell += char;
          }
        }
        cells.push(cell.replace(/^"|"$/g, ''));
        rows.push(cells);
      }
      
      return rows;
    }

    // Load all sheets
    async function loadAllSheets() {
      try {
        const sheetId = config.sheet_id;
        
        const sheetNames = [
          'portarage towtruk',
          'hero.works',
          'Ahmed Al-Ghanem',
          'Peacock Concierge',
          'ProjX Racing',
          'Yamaha Motor',
          'Vault Garage',
          'Geely',
          'Auto Capital',
          'Ø®Ø¯Ù…Ø§Øª5',
          'Ù…ÙŠØ²Ø§Ù† ÙˆØªØ±ÙƒÙŠØ¨',
          'Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©',
          'Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©2',
          'ØªØ±ÙƒÙŠØ¨ Ø¨Ø·Ø§Ø±ÙŠØ©',
          'ØªØ£Ù…ÙŠÙ† ÙˆØ±Ø¨Ù‡',
          'ØªØ£Ù…ÙŠÙ† ØµÙÙŠÙ†Ù‡ VIP',
          'ØªØ£Ù…ÙŠÙ† Ø¥ÙŠÙ„Ø§Ù',
          'others'
        ];
        
        sheetsData = { currentSheetId: sheetId };
        
        for (const sheetName of sheetNames) {
          try {
            const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;
            const response = await fetch(csvUrl);
            
            if (response.ok) {
              const csvText = await response.text();
              const rows = parseCSV(csvText);
              sheetsData[sheetName] = rows;
            }
          } catch (err) {
            console.log(`Could not load sheet: ${sheetName}`);
          }
        }
        
        // Load others sheet separately
        try {
          const othersSheetId = '1ax4pCBDTm6Vkq-MZjmmOY1dgwKCUQS5x1GeffkUYOzI';
          const csvUrl = `https://docs.google.com/spreadsheets/d/${othersSheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent('others')}`;
          const res = await fetch(csvUrl);
          if (res.ok) {
            const csvText = await res.text();
            const rows = parseCSV(csvText);
            sheetsData['others'] = rows;
          }
        } catch (err) {
          console.log('Could not load others sheet');
        }
        
      } catch (error) {
        console.error('Error loading sheets:', error);
      }
    }

    // Fullscreen iframe functions
    function openFullscreenIframe(url, title) {
      const wrapper = document.getElementById('fullscreenIframeWrapper');
      const container = document.getElementById('fullscreenIframeContainer');
      
      // Store state before opening
      lastIframeState = {
        url: url,
        title: title,
        service: currentService,
        formData: { ...formData }
      };
      
      container.innerHTML = `<iframe src="${url}" title="${title}"></iframe>`;
      wrapper.classList.remove('hidden');
      
      // Hide the main dashboard
      document.getElementById('dashboardWrapper').style.display = 'none';
    }

    window.closeFullscreenIframe = function() {
      const wrapper = document.getElementById('fullscreenIframeWrapper');
      const container = document.getElementById('fullscreenIframeContainer');
      
      wrapper.classList.add('hidden');
      container.innerHTML = '';
      
      // Show the main dashboard again
      document.getElementById('dashboardWrapper').style.display = 'grid';
      
      // Don't reset the service - keep the current state
      // The user will see the same service they had before opening the iframe
    };

    // Service Selection
    document.addEventListener('click', (e) => {
      const serviceItem = e.target.closest('.service-item');
      if (serviceItem) {
        // Handle submenu toggle for battery, tire, and staff
        if ((serviceItem.dataset.service === 'battery' || serviceItem.dataset.service === 'tire' || serviceItem.dataset.service === 'staff') && serviceItem.classList.contains('has-submenu')) {
          serviceItem.classList.toggle('expanded');
          const submenuId = serviceItem.dataset.service === 'battery' ? 'batterySubmenu' : (serviceItem.dataset.service === 'tire' ? 'tireSubmenu' : 'staffSubmenu');
          const submenu = document.getElementById(submenuId);
          if (submenu) submenu.classList.toggle('show');
          return;
        }
        
        // Clear all active states
        document.querySelectorAll('.service-item').forEach(item => {
          item.classList.remove('active');
        });
        
        serviceItem.classList.add('active');
        
        currentService = serviceItem.dataset.service;
        formData = {};
        
        const serviceTitles = {
          'tow': 'Ø®Ø¯Ù…Ø© ÙˆÙ†Ø´Ø§Øª',
          'batterySubscription': 'Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø·Ø§Ø±ÙŠØ©',
          'newBattery': 'Ø¨Ø·Ø§Ø±ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©',
          'batteryInstall': 'ØªØ±ÙƒÙŠØ¨ Ø¨Ø·Ø§Ø±ÙŠØ©',
          'fuel': 'Ø®Ø¯Ù…Ø© Ø¨Ù†Ø²ÙŠÙ†',
          'unlock': 'ÙØªØ­ Ù‚ÙÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©',
          'tireSheet': 'Ø´ÙŠØª Ø§Ù„ØªÙˆØ§ÙŠØ±',
          'tireIncrease': 'Ø²ÙŠØ§Ø¯Ø§Øª Ø§Ù„ØªÙˆØ§ÙŠØ±',
          'puncture': 'Ø¨Ù†Ø´Ø±',
          'balance': 'Ù…ÙŠØ²Ø§Ù† ÙˆØªØ±ÙƒÙŠØ¨',
          'ringRepair': 'ØªØµÙ„ÙŠØ­ Ø§Ù„Ø±Ù†Ù‚Ø§Øª',
          'mechanical': 'Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©',
          'staff_centers': 'Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø·Ù„Ø¨Ø§Øª',
          'carwash': 'ØºØ³ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª',
          'protection': 'Ø§Ù„Ø­Ù…Ø§ÙŠÙ‡ ÙˆØ§Ù„ØªØºÙŠÙ…',
          'insurance': 'ØªØ£Ù…ÙŠÙ†Ø§Øª',
          'annualSubscription': 'Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ',
          'imsakia': 'Ø§Ù…Ø³Ø§ÙƒÙŠÙ‡ Ø±Ù…Ø¶Ø§Ù†'
        };
        
        const titleElement = document.getElementById('serviceTitle');
        const serviceText = serviceTitles[currentService];
        titleElement.innerHTML = serviceText + ' <span class="ramadan-text">ğŸŒ™ Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…</span>';
        
        switch(currentService) {
          case 'tow':
            renderTowInterface();
            break;
          case 'batterySubscription':
            renderBatterySubscriptionInterface();
            break;
          case 'newBattery':
            openFullscreenIframe('https://portaragebatteries.netlify.app/', 'Ø¨Ø·Ø§Ø±ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©');
            break;
          case 'batteryInstall':
            renderBatteryInstallInterface();
            break;
          case 'fuel':
            renderFuelInterface();
            break;
          case 'unlock':
            renderLockInterface();
            break;
          case 'tireSheet':
            renderTireSheetInterface();
            break;
          case 'tireIncrease':
            openFullscreenIframe('https://portaragetiers.netlify.app/', 'Ø²ÙŠØ§Ø¯Ø§Øª Ø§Ù„ØªÙˆØ§ÙŠØ±');
            break;
          case 'puncture':
            renderPunctureService();
            break;
          case 'balance':
            renderBalanceService();
            break;
          case 'ringRepair':
            renderRingRepairInterface();
            break;
          case 'mechanical':
            renderMechanicalInterface();
            break;
          case 'staff_centers':
            renderStaffInterface();
            break;
          case 'carwash':
            renderCarWashInterface();
            break;
          case 'protection':
            renderProtectionInterface();
            break;
          case 'insurance':
            renderInsuranceInterface();
            break;
          case 'annualSubscription':
            renderAnnualSubscriptionInterface();
            break;
          case 'imsakia':
            renderImsakia();
            break;
        }
      }
    });

    // Render Battery Subscription Interface (was old "battery" service)
    function renderBatterySubscriptionInterface() {
      renderServiceWithDatalist('Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø·Ø§Ø±ÙŠØ©', 'Ø®Ø¯Ù…Ø§Øª5', [0, 1, 2, 4, 5, 6], 
        '<div class="info-box">ÙÙŠ Ø­Ø§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ¨ÙŠ ÙØ­Øµ Ø¨Ø·Ø§Ø±ÙŠØ©: 10 Ø¯.Ùƒ ØªÙ†Ø®ØµÙ… Ù…Ù† Ø³Ø¹Ø± Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©</div>');
    }

    // Render Staff Interface
    function renderStaffInterface() {
      // clear any existing interval
      if (window.staffIntervalId) clearInterval(window.staffIntervalId);

      const contentArea = document.getElementById('contentArea');
      const monthNames = ['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
      const now = new Date();
      const currentMonth = now.getMonth() + 1; // 1..12
      contentArea.innerHTML = `
        <div class="form-section full-width">
          <div style="background: linear-gradient(135deg, #F2BC1B 0%, #d4a319 100%); color: #000; padding: 16px; border-radius: 8px; text-align: center; margin-bottom: 12px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 12px; font-size: 18px;">
            <span style="font-size: 24px; animation: lanternSway 4s ease-in-out infinite;">ğŸ®</span>
            Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø·Ù„Ø¨Ø§Øª - ${monthNames[(new Date()).getMonth()]} - Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…
            <span style="font-size: 24px; animation: lanternSway 4s ease-in-out infinite; animation-delay: 1s;">ğŸ®</span>
          </div>
          <div style="display:flex;align-items:center;justify-content:flex-start;margin-bottom:8px;">
            <div id="staffUpdated" style="color:#999; font-size:13px;">ØªØ­Ù…ÙŠÙ„...</div>
          </div>
          <div id="staffTop" style="display:flex;flex-direction:column;gap:8px;align-items:center;
               background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);border:1px solid #F2BC1B;padding:16px;border-radius:8px;">
            <!-- top 3 will be injected here -->
          </div>
        </div>
        <div id="staffListSection" class="form-section full-width hidden" style="padding-top:8px;">
          <div id="staffColumns" style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start;"></div>
        </div>
      `;
      

      // initial load and periodic refresh (every 5 minutes)
      loadStaffData(true);
      if (window.staffIntervalId) clearInterval(window.staffIntervalId);
      window.staffIntervalId = setInterval(() => {
        loadStaffData();
      }, 5 * 60 * 1000);
    }

    async function loadStaffData(force = false) {
      try {
        const sheetId = '1FkHv8c06WTPtOK9WUYM2ZNBR_IFhDq4W05JUr-b3SnI';
      const sheetName = 'Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†';
      const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;
        const res = await fetch(csvUrl, { cache: 'no-cache' });
        if (!res.ok) throw new Error('failed to load staff sheet');
        const text = await res.text();

        // detect change silently
        if (!force && window._staffRawText && window._staffRawText === text) return; // no change
        window._staffRawText = text;

        const rows = parseCSV(text);
        // find last update: try first row col C (index 2)
        const headerRow = rows[0] || [];
        window._carWashHeaderRow = headerRow;
        const lastUpdate = (headerRow[2] && headerRow[2].trim()) ? headerRow[2].trim() : new Date().toLocaleString();

        // Staff data from second row onward
        const dataRows = rows.slice(1).filter(r => r && (r[0] || r[1]));
        const staff = dataRows.map(r => ({ name: (r[0] || '').toString().trim(), count: parseInt((r[1] || '0').toString().trim()) || 0 }));

        // sort by count desc
        staff.sort((a,b) => b.count - a.count);

        updateStaffUI(staff, lastUpdate);
      } catch (err) {
        console.error(err);
        const up = document.getElementById('staffUpdated'); if (up) up.textContent = 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
      }
    }

    

    function updateStaffUI(staff, lastUpdate) {
      const updatedEl = document.getElementById('staffUpdated');
      if (updatedEl) updatedEl.textContent = lastUpdate;

      const topEl = document.getElementById('staffTop');
      const listSection = document.getElementById('staffListSection');
      const colsContainer = document.getElementById('staffColumns');

      if (!topEl || !colsContainer) return;

      // Build top 3 with rank labels and larger, exciting typography
      const first = staff[0] || null;
      const second = staff[1] || null;
      const third = staff[2] || null;

      topEl.innerHTML = '';
      if (first) {
        const f = document.createElement('div');
        f.style.textAlign = 'center';
        f.style.padding = '18px';
        f.style.border = '2px solid #F2BC1B';
        f.style.borderRadius = '8px';
        f.style.width = '100%';
        f.style.background = 'linear-gradient(90deg, rgba(242,188,27,0.15), rgba(242,188,27,0.05))';
        f.innerHTML = `<div style="font-size:16px;color:#F2BC1B;margin-bottom:6px;font-weight:700;">ğŸ¥‡ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø£ÙˆÙ„</div><div style="font-size:28px;font-weight:900;color:#FFD700;">${first.name}</div><div style="color:#86efac;font-size:20px;margin-top:8px;font-weight:700;">${first.count} Ø·Ù„Ø¨</div>`;
        f.classList.add('animated-highlight');
        topEl.appendChild(f);
      }

      const duo = document.createElement('div');
      duo.style.display = 'flex';
      duo.style.gap = '12px';
      duo.style.width = '100%';
      duo.style.justifyContent = 'center';

      if (second) {
        const s = document.createElement('div');
        s.style.flex = '1';
        s.style.padding = '12px';
        s.style.border = '1px solid #4ade80';
        s.style.borderRadius = '8px';
        s.style.textAlign = 'center';
        s.style.background = 'linear-gradient(135deg, rgba(242,188,27,0.08), transparent)';
        s.innerHTML = `<div style="font-size:14px;color:#F2BC1B;margin-bottom:4px;font-weight:700;">ğŸ¥ˆ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù†ÙŠ</div><div style="font-weight:800;color:#FFD700;">${second.name}</div><div style="color:#86efac;font-weight:600;">${second.count} Ø·Ù„Ø¨</div>`;
        duo.appendChild(s);
      }
      if (third) {
        const t = document.createElement('div');
        t.style.flex = '1';
        t.style.padding = '12px';
        t.style.border = '1px solid #f97316';
        t.style.borderRadius = '8px';
        t.style.textAlign = 'center';
        t.style.background = 'linear-gradient(135deg, rgba(249,115,22,0.08), transparent)';
        t.innerHTML = `<div style="font-size:14px;color:#f97316;margin-bottom:4px;font-weight:700;">ğŸ¥‰ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù„Ø«</div><div style="font-weight:800;color:#FFD700;">${third.name}</div><div style="color:#fb923c;font-weight:600;">${third.count} Ø·Ù„Ø¨</div>`;
        duo.appendChild(t);
      }

      if (duo.children.length > 0) topEl.appendChild(duo);

      // Build remaining in responsive columns (avoid fixed 4-per-column)
      const rest = staff.slice(3);
      colsContainer.innerHTML = '';
      if (rest.length === 0) {
        listSection.classList.add('hidden');
      } else {
        listSection.classList.remove('hidden');
        // determine columns based on available width
        const available = Math.max(320, Math.min(window.innerWidth - 420, 900));
        const approxCol = 180;
        let columnsCount = Math.max(1, Math.floor(available / approxCol));
        columnsCount = Math.min(columnsCount, rest.length);
        const perCol = Math.ceil(rest.length / columnsCount);

        for (let c = 0; c < columnsCount; c++) {
          const start = c * perCol;
          const chunk = rest.slice(start, start + perCol);
          const col = document.createElement('div');
          col.style.flex = `1 0 ${Math.floor(100 / columnsCount)}%`;
          col.style.display = 'flex';
          col.style.flexDirection = 'column';
          col.style.gap = '8px';

          chunk.forEach((it, idx) => {
            const globalIndex = 4 + start + idx; // rank number starting at 4
            const div = document.createElement('div');
            div.style.color = '#fff';
            div.style.fontSize = '16px';
            div.style.textAlign = 'center';
            div.style.fontWeight = '600';
            div.textContent = `${globalIndex}- ${it.name} ${it.count} Ø·Ù„Ø¨`;
            col.appendChild(div);
          });

          colsContainer.appendChild(col);
        }
      }
    }

    // Render Tow Interface
    function renderTowInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù‡Ø©</h3>
          <div class="btn-grid" style="grid-template-columns: 1fr;">
            <button class="btn-option active" data-company="Ø¨ÙˆØ±ØªØ±Ø§Ø¬">Ø¨ÙˆØ±ØªØ±Ø§Ø¬</button>
          </div>
          <button id="toggleCompanies" class="btn-option" style="width: 100%; margin-top: 8px; background: #353535; border-color: #666;">
            â¬‡ï¸ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
          </button>
          <div id="moreCompanies" class="hidden" style="margin-top: 8px;">
            <div class="btn-grid">
              ${companies.slice(1, 5).map(company => `
                <button class="btn-option" data-company="${company}">${company}</button>
              `).join('')}
            </div>
            <div class="btn-grid">
              ${companies.slice(5, 9).map(company => `
                <button class="btn-option" data-company="${company}">${company}</button>
              `).join('')}
            </div>
          </div>
        </div>
        
        <div id="towTypeSection" class="form-section hidden">
          <h3 class="section-title">Ù†ÙˆØ¹ Ø§Ù„ÙˆÙ†Ø´</h3>
          <div class="btn-grid" id="towTypeButtons" style="grid-template-columns: repeat(2, 1fr);">
            <button class="btn-option" data-type="normal">ÙˆÙ†Ø´ Ø¹Ø§Ø¯ÙŠ</button>
            <button class="btn-option" data-type="flatbed">ÙˆÙ†Ø´ ÙÙ„ Ø¯Ø§ÙˆÙ†</button>
          </div>
          
          
          <div id="lockedOption" class="hidden" style="margin-top: 10px;">
            <h3 class="section-title">ÙˆÙ†Ø´ Ù…Ø³ÙƒØ±</h3>
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; background: #262626; border-radius: 4px; border: 1px solid #404040;">
              <input type="checkbox" id="lockedCheckbox" style="width: 18px; height: 18px; cursor: pointer; accent-color: #F2BC1B;">
              <span style="color: #F2BC1B; font-size: 12px; font-weight: 600;">ØªÙØ¹ÙŠÙ„ ÙˆÙ†Ø´ Ù…Ø³ÙƒØ± (+5 Ø¯.Ùƒ)</span>
            </label>
            <div id="lockedYesNote" class="warning-box hidden">
              <strong>âš ï¸ ØªÙ†ÙˆÙŠÙ‡:</strong> Ø¥Ø°Ø§ Ø§Ù„Ù‚ÙŠØ± Ù…Ø§ ÙŠØªØ¨ÙˆØ´ Ø§Ùˆ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙÙŠÙ‡Ø§ Ø­Ø§Ø¯Ø« Ù…Ø§ Ù†Ù‚Ø¯Ø± Ù†Ø´ÙŠÙ„Ù‡Ø§ Ø¨Ø§Ù„ÙˆÙ†Ø´ Ø§Ù„Ù…Ø³ÙƒØ±
            </div>
          </div>
          
          <div id="flatbedOnlyNote" class="info-box hidden" style="margin-top: 10px;">
            <strong>â„¹ï¸ ØªÙ†ÙˆÙŠÙ‡:</strong> Ø§Ù„Ø³ÙŠØ§Ø±Ø© ØªØ­ØªØ§Ø¬ ÙˆÙ†Ø´ ÙÙ„ Ø¯Ø§ÙˆÙ† Ø¨Ø¯ÙˆÙ† Ù…Ø³ÙƒØ± (+10 Ø¯.Ùƒ Ø±Ø³ÙˆÙ… Ø¹Ø±Ø¨Ø§Ù†Ø§Øª)
          </div>
          
          <div id="flatbedExtraChargesSection" class="hidden" style="margin-top: 10px;">
            <h3 class="section-title">Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©</h3>
            <div class="form-field">
              <label>Ù‡Ù„ Ø§Ù„Ù‚ÙŠØ± Ù…Ø§ ÙŠØªØ¨ÙˆØ´ Ø£Ùˆ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙÙŠÙ‡Ø§ Ø­Ø§Ø¯Ø«ØŸ</label>
              <select id="flatbedExtraChargesSelect" class="form-control">
                <option value="no">Ù„Ø§</option>
                <option value="yes">Ù†Ø¹Ù… (+10 Ø¯.Ùƒ Ø±Ø³ÙˆÙ… Ø¹Ø±Ø¨Ø§Ù†Ø§Øª)</option>
              </select>
            </div>
            <div id="flatbedExtraChargesNote" class="warning-box hidden">
              <strong>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙÙŠ Ø­Ø§Ù„ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø®ÙØ±: 5 Ø¯.Ùƒ Ù„ÙƒÙ„ Ù†ØµÙ Ø³Ø§Ø¹Ø© | 10 Ø¯.Ùƒ Ù„ÙƒÙ„ Ø³Ø§Ø¹Ø©
            </div>
          </div>
        </div>
        
        <div id="towLocationsSection" class="form-section full-width hidden">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹</h3>
          <div class="form-grid">
            <div class="form-field">
              <label>Ù…Ù† Ø£ÙŠÙ†</label>
              <input type="text" list="fromLocations" id="fromSelect" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹">
              <datalist id="fromLocations"></datalist>
            </div>
            <div class="form-field">
              <label>Ø¥Ù„Ù‰ Ø£ÙŠÙ†</label>
              <input type="text" list="toLocations" id="toSelect" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹">
              <datalist id="toLocations"></datalist>
            </div>
          </div>
          <div id="extraChargesSection" class="hidden">
            <div class="form-field" style="margin-top: 10px;">
              <label>Ù‡Ù„ Ø§Ù„Ù‚ÙŠØ± Ù…Ø§ ÙŠØªØ¨ÙˆØ´ Ø£Ùˆ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙÙŠÙ‡Ø§ Ø­Ø§Ø¯Ø«ØŸ</label>
              <select id="extraChargesSelect" class="form-control">
                <option value="no">Ù„Ø§</option>
                <option value="yes">Ù†Ø¹Ù… (+10 Ø¯.Ùƒ Ø±Ø³ÙˆÙ… Ø¹Ø±Ø¨Ø§Ù†Ø§Øª)</option>
              </select>
            </div>
            <div id="extraChargesNote" class="warning-box hidden">
              <strong>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙÙŠ Ø­Ø§Ù„ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø®ÙØ±: 5 Ø¯.Ùƒ Ù„ÙƒÙ„ Ù†ØµÙ Ø³Ø§Ø¹Ø© | 10 Ø¯.Ùƒ Ù„ÙƒÙ„ Ø³Ø§Ø¹Ø©
            </div>
          </div>
          <div id="flatbedPortarageExtraChargesSection" class="hidden">
            <div class="form-field" style="margin-top: 10px;">
              <label>Ù‡Ù„ Ø§Ù„Ù‚ÙŠØ± Ù…Ø§ ÙŠØªØ¨ÙˆØ´ Ø£Ùˆ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙÙŠÙ‡Ø§ Ø­Ø§Ø¯Ø«ØŸ</label>
              <select id="flatbedPortarageExtraChargesSelect" class="form-control">
                <option value="no">Ù„Ø§</option>
                <option value="yes">Ù†Ø¹Ù… (+10 Ø¯.Ùƒ Ø±Ø³ÙˆÙ… Ø¹Ø±Ø¨Ø§Ù†Ø§Øª)</option>
              </select>
            </div>
            <div id="flatbedPortarageExtraChargesNote" class="warning-box hidden">
              <strong>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙÙŠ Ø­Ø§Ù„ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø®ÙØ±: 5 Ø¯.Ùƒ Ù„ÙƒÙ„ Ù†ØµÙ Ø³Ø§Ø¹Ø© | 10 Ø¯.Ùƒ Ù„ÙƒÙ„ Ø³Ø§Ø¹Ø©
            </div>
          </div>
        </div>
        
        <div id="towResultSection" class="data-table-container hidden">
          <div class="table-header">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</div>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                  <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                </tr>
              </thead>
              <tbody id="towResultBody">
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      // Toggle companies button
      const toggleBtn = document.getElementById('toggleCompanies');
      const moreCompanies = document.getElementById('moreCompanies');
      let companiesVisible = false;
      
      toggleBtn.onclick = () => {
        companiesVisible = !companiesVisible;
        if (companiesVisible) {
          moreCompanies.classList.remove('hidden');
          toggleBtn.textContent = 'â¬†ï¸ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰';
        } else {
          moreCompanies.classList.add('hidden');
          toggleBtn.textContent = 'â¬‡ï¸ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰';
          
          // Reset to Ø¨ÙˆØ±ØªØ±Ø§Ø¬ when hiding
          const portarageBtn = document.querySelector('[data-company="Ø¨ÙˆØ±ØªØ±Ø§Ø¬"]');
          if (portarageBtn && !portarageBtn.classList.contains('active')) {
            document.querySelectorAll('[data-company]').forEach(b => b.classList.remove('active'));
            portarageBtn.classList.add('active');
            
            formData.companyArabic = 'Ø¨ÙˆØ±ØªØ±Ø§Ø¬';
            formData.company = 'portarage towtruk';
            formData.isLocked = false;
            formData.gearWorks = true;
            updateTowTypeOptions();
          }
        }
      };
      
      // Company selection
      document.querySelectorAll('[data-company]').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('[data-company]').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          formData.companyArabic = btn.dataset.company;
          formData.company = companyMapping[btn.dataset.company];
          
          // Clear previous state
          formData.towType = null;
          formData.from = null;
          formData.to = null;
          formData.isLocked = false;
          formData.extraCharges = 'no';
          
          // Hide sections
          document.getElementById('towTypeSection').classList.add('hidden');
          document.getElementById('towLocationsSection').classList.add('hidden');
          document.getElementById('towResultSection').classList.add('hidden');
          document.getElementById('lockedOption').classList.add('hidden');
          document.getElementById('lockedYesNote').classList.add('hidden');
          document.getElementById('flatbedOnlyNote').classList.add('hidden');
          
          updateTowTypeOptions();
        });
      });
      
      // Set default to Ø¨ÙˆØ±ØªØ±Ø§Ø¬
      formData.companyArabic = 'Ø¨ÙˆØ±ØªØ±Ø§Ø¬';
      formData.company = 'portarage towtruk';
      formData.isLocked = false;
      formData.gearWorks = true;
      updateTowTypeOptions();
    }

    // Render Driver Follow-up Interface (Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª)
    function renderDriverFollowupInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section full-width">
          <h3 class="section-title">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª - Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</h3>
          <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;">
            <button id="openFollowForm" class="btn-primary">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ù…ØªØ§Ø¨Ø¹Ø© Ø³Ø§Ø¦Ù‚</button>
            <button id="editFollowSheet" class="btn-primary">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ù…ØªØ§Ø¨Ø¹Ø©</button>
          </div>
        </div>
        <div class="form-section full-width">
          <div class="table-scroll">
            <table class="data-table" id="driverScheduleTable">
              <thead>
                <tr>
                  <th>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                  <th>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                  <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                  <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                  <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      `;

      document.getElementById('openFollowForm').onclick = () => {
        window.open('https://forms.gle/sseHak21qRmfFcXc7', '_blank');
      };
      document.getElementById('editFollowSheet').onclick = () => {
        const sheetId = '1FkWKRxRFC8UG1Ez2VzYHadHju2HARBLbdTIsr57hKXc';
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/edit`;
        window.open(url, '_blank');
      };

      // Clear any existing interval and set up auto-refresh
      if (window.driverFollowIntervalId) clearInterval(window.driverFollowIntervalId);
      
      // initial load
      loadDriverSchedules();
      
      // Auto-refresh every 3 minutes
      window.driverFollowIntervalId = setInterval(() => {
        loadDriverSchedules();
      }, 3 * 60 * 1000);
    }

    async function loadDriverSchedules() {
      try {
        const sheetId = '1FkWKRxRFC8UG1Ez2VzYHadHju2HARBLbdTIsr57hKXc';
        const sheetName = 'Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†';
        const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;
        const res = await fetch(csvUrl, { cache: 'no-cache' });
        const tbody = document.querySelector('#driverScheduleTable tbody');
        if (!tbody) return;
        tbody.innerHTML = '<tr><td colspan="5" style="color:#999;padding:12px">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>';
        if (!res.ok) {
          tbody.innerHTML = `<tr><td colspan="5" style="color:#f88;padding:12px">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´ÙŠØª (ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø´ÙŠØª Ø¹Ø§Ù…)</td></tr>`;
          return;
        }
        const text = await res.text();
        const rows = parseCSV(text || '');
        const dataRows = rows.slice(1).filter(r => r && (r[0] || r[1] || r[2] || r[3]));

        if (dataRows.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" style="color:#999;padding:12px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
          return;
        }

        // The sheet columns expected: A: Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù, B: Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©, C: Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚, D: Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®, E: Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        // We'll display: Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø© | Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚ | Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª | Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù | Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        tbody.innerHTML = '';
        dataRows.forEach(r => {
          const emp = (r[0]||'').toString().trim();
          const svc = (r[1]||'').toString().trim();
          const driver = (r[2]||'').toString().trim();
          const datetime = (r[3]||'').toString().trim();
          const notes = (r[4]||'').toString().trim();

          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${escapeHtml(svc)}</td><td>${escapeHtml(driver)}</td><td>${escapeHtml(datetime)}</td><td>${escapeHtml(emp)}</td><td>${escapeHtml(notes)}</td>`;
          tbody.appendChild(tr);
        });
      } catch (err) {
        console.error(err);
        const tbody = document.querySelector('#driverScheduleTable tbody');
        if (tbody) tbody.innerHTML = `<tr><td colspan="5" style="color:#f88;padding:12px">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>`;
      }
    }

    function escapeHtml(s) {
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    function updateTowTypeOptions() {
      const towTypeSection = document.getElementById('towTypeSection');
      const sheetName = formData.company;
      
      if (!sheetName || !sheetsData[sheetName]) {
        towTypeSection.classList.add('hidden');
        return;
      }
      
      towTypeSection.classList.remove('hidden');
      
      // Check which tow types are available
      const rows = sheetsData[sheetName];
      let hasNormal = false;
      let hasFlatbed = false;
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        if (row[4] || row[1]) hasNormal = true;
        if (row[12] || row[9]) hasFlatbed = true;
      }
      
      // Update buttons visibility
      const towTypeButtons = document.getElementById('towTypeButtons');
      const buttons = towTypeButtons.querySelectorAll('.btn-option');
      
      buttons.forEach(btn => {
        const type = btn.dataset.type;
        if (type === 'normal' && !hasNormal) {
          btn.style.display = 'none';
        } else if (type === 'flatbed' && !hasFlatbed) {
          btn.style.display = 'none';
        } else {
          btn.style.display = 'block';
        }
      });
      
      const visibleButtons = Array.from(buttons).filter(btn => btn.style.display !== 'none');
      towTypeButtons.style.gridTemplateColumns = `repeat(${visibleButtons.length}, 1fr)`;
      
      buttons.forEach(btn => btn.classList.remove('active'));
      
      if (!formData.towType) {
        document.getElementById('towLocationsSection').classList.add('hidden');
        document.getElementById('towResultSection').classList.add('hidden');
        document.getElementById('lockedOption').classList.add('hidden');
      }
      
      // Tow type selection
      buttons.forEach(btn => {
        btn.onclick = () => {
          buttons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          formData.towType = btn.dataset.type;
          
          // Reset all sections
          document.getElementById('towResultSection').classList.add('hidden');
          document.getElementById('towLocationsSection').classList.add('hidden');
          formData.from = null;
          formData.to = null;
          
          const fromSelect = document.getElementById('fromSelect');
          const toSelect = document.getElementById('toSelect');
          if (fromSelect) fromSelect.value = '';
          if (toSelect) toSelect.value = '';
          
          const lockedOption = document.getElementById('lockedOption');
          const flatbedOnlyNote = document.getElementById('flatbedOnlyNote');
          const lockedCheckbox = document.getElementById('lockedCheckbox');
          const flatbedExtraChargesSection = document.getElementById('flatbedExtraChargesSection');
          
          if (formData.towType === 'flatbed') {
            if (formData.companyArabic === 'Ø¨ÙˆØ±ØªØ±Ø§Ø¬') {
              lockedOption.classList.remove('hidden');
              flatbedOnlyNote.classList.add('hidden');
              flatbedExtraChargesSection.classList.add('hidden');
              
              if (formData.isLocked === undefined) {
                formData.isLocked = false;
              }
              
              if (lockedCheckbox) {
                lockedCheckbox.checked = formData.isLocked;
              }
              
              if (lockedCheckbox) {
                lockedCheckbox.onchange = () => {
                  formData.isLocked = lockedCheckbox.checked;
                  
                  const lockedYesNote = document.getElementById('lockedYesNote');
                  
                  if (formData.isLocked) {
                    lockedYesNote.classList.remove('hidden');
                  } else {
                    lockedYesNote.classList.add('hidden');
                  }
                  
                  if (formData.from && formData.to) {
                    calculateTowPrice();
                  }
                };
              }
            } else {
              // For other companies - NO gear question for flatbed
              lockedOption.classList.add('hidden');
              flatbedOnlyNote.classList.add('hidden');
              document.getElementById('lockedYesNote').classList.add('hidden');
              flatbedExtraChargesSection.classList.add('hidden');
              formData.isLocked = false;
              formData.flatbedExtraCharges = 'no';
            }
          } else {
            lockedOption.classList.add('hidden');
            flatbedOnlyNote.classList.add('hidden');
            flatbedExtraChargesSection.classList.add('hidden');
            document.getElementById('lockedYesNote').classList.add('hidden');
            document.getElementById('flatbedExtraChargesNote').classList.add('hidden');
            formData.isLocked = false;
            formData.flatbedExtraCharges = 'no';
          }
          
          updateTowLocations();
        };
      });
    }

    function updateTowLocations() {
      const towLocationsSection = document.getElementById('towLocationsSection');
      towLocationsSection.classList.remove('hidden');
      
      const routes = getTowRoutes(formData.company, formData.towType);
      const fromLocations = [...new Set(routes.map(r => r.from))].filter(Boolean);
      
      const fromDatalist = document.getElementById('fromLocations');
      fromDatalist.innerHTML = fromLocations.map(loc => `<option value="${loc}">${loc}</option>`).join('');
      
      const fromSelect = document.getElementById('fromSelect');
      const toSelect = document.getElementById('toSelect');
      
      fromSelect.oninput = () => {
        formData.from = fromSelect.value;
        
        const currentTo = toSelect.value;
        
        if (formData.from) {
          const toLocations = [...new Set(routes.filter(r => r.from === formData.from).map(r => r.to))].filter(Boolean);
          const toDatalist = document.getElementById('toLocations');
          toDatalist.innerHTML = toLocations.map(loc => `<option value="${loc}">${loc}</option>`).join('');
          
          if (currentTo && toLocations.includes(currentTo)) {
            toSelect.value = currentTo;
            formData.to = currentTo;
          } else {
            toSelect.value = '';
            formData.to = null;
            document.getElementById('towResultSection').classList.add('hidden');
          }
        } else {
          document.getElementById('towResultSection').classList.add('hidden');
        }
      };
      
      toSelect.oninput = () => {
        formData.to = toSelect.value;
        const currentToInput = toSelect.value.toLowerCase();
      if (formData.from) {
        const routes = getTowRoutes(formData.company, formData.towType);
        const filteredToLocations = [...new Set(
          routes
            .filter(r => r.from === formData.from && r.to.toLowerCase().includes(currentToInput))
            .map(r => r.to)
        )].filter(Boolean);

        const toDatalist = document.getElementById('toLocations');
        toDatalist.innerHTML = filteredToLocations.map(loc => `<option value="${loc}">${loc}</option>`).join('');
      }
        if (!formData.to) {
          document.getElementById('towResultSection').classList.add('hidden');
          
          // Hide gear question sections
          document.getElementById('extraChargesSection').classList.add('hidden');
          document.getElementById('flatbedPortarageExtraChargesSection').classList.add('hidden');
          return;
        }
        
        if (formData.to) {
          // Show gear question ONLY for Ø¨ÙˆØ±ØªØ±Ø§Ø¬ flatbed
          if (formData.companyArabic === 'Ø¨ÙˆØ±ØªØ±Ø§Ø¬' && formData.towType === 'flatbed') {
            document.getElementById('flatbedPortarageExtraChargesSection').classList.remove('hidden');
            document.getElementById('extraChargesSection').classList.add('hidden');
            
            const flatbedPortarageExtraChargesSelect = document.getElementById('flatbedPortarageExtraChargesSelect');
            if (!formData.flatbedPortarageExtraCharges) {
              formData.flatbedPortarageExtraCharges = 'no';
            }
            flatbedPortarageExtraChargesSelect.value = formData.flatbedPortarageExtraCharges;
            
            flatbedPortarageExtraChargesSelect.onchange = () => {
              formData.flatbedPortarageExtraCharges = flatbedPortarageExtraChargesSelect.value;
              
              if (formData.flatbedPortarageExtraCharges === 'yes') {
                document.getElementById('flatbedPortarageExtraChargesNote').classList.remove('hidden');
              } else {
                document.getElementById('flatbedPortarageExtraChargesNote').classList.add('hidden');
              }
              
              calculateTowPrice();
            };
          } else if (formData.companyArabic === 'Ø¨ÙˆØ±ØªØ±Ø§Ø¬' && formData.towType === 'normal') {
            // For Ø¨ÙˆØ±ØªØ±Ø§Ø¬ normal tow
            document.getElementById('extraChargesSection').classList.remove('hidden');
            document.getElementById('flatbedPortarageExtraChargesSection').classList.add('hidden');
            
            const extraChargesSelect = document.getElementById('extraChargesSelect');
            if (!formData.extraCharges) {
              formData.extraCharges = 'no';
            }
            extraChargesSelect.value = formData.extraCharges;
            
            extraChargesSelect.onchange = () => {
              formData.extraCharges = extraChargesSelect.value;
              
              if (formData.extraCharges === 'yes') {
                document.getElementById('extraChargesNote').classList.remove('hidden');
              } else {
                document.getElementById('extraChargesNote').classList.add('hidden');
              }
              
              calculateTowPrice();
            };
          } else {
            // For other companies - no gear question at all
            document.getElementById('extraChargesSection').classList.add('hidden');
            document.getElementById('flatbedPortarageExtraChargesSection').classList.add('hidden');
          }
          
          // Always recalculate when "to" location changes
          calculateTowPrice();
        }
      };
    }

    function getTowRoutes(sheetName, towType) {
      const rows = sheetsData[sheetName];
      if (!rows || rows.length < 3) return [];
      
      const routes = [];
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        
        if (towType === 'normal') {
          const from = row[6];
          const toF = row[5];
          const toC = row[2];
          const priceE = row[4];
          const priceB = row[1];
          
          if (from && toF && priceE) {
            routes.push({ from, to: toF, price: priceE, cancelCol: 3 });
          }
          if (from && toC && priceB) {
            routes.push({ from, to: toC, price: priceB, cancelCol: 0 });
          }
        } else if (towType === 'flatbed') {
          const from = row[14];
          const toN = row[13];
          const toK = row[10];
          const priceM = row[12];
          const priceJ = row[9];
          
          if (from && toN && priceM) {
            routes.push({ from, to: toN, price: priceM, cancelCol: 11 });
          }
          if (from && toK && priceJ) {
            routes.push({ from, to: toK, price: priceJ, cancelCol: 8 });
          }
        }
      }
      
      return routes;
    }

    function calculateTowPrice() {
      const routes = getTowRoutes(formData.company, formData.towType);
      const route = routes.find(r => r.from === formData.from && r.to === formData.to);
      
      if (!route) {
        document.getElementById('towResultSection').classList.add('hidden');
        return;
      }
      
      let companyPrice = parseFloat(route.price) || 0;
      
      let extraCharges = 0;
      
      if (formData.towType === 'normal') {
        // For normal tow Ø¨ÙˆØ±ØªØ±Ø§Ø¬
        extraCharges = (formData.companyArabic === 'Ø¨ÙˆØ±ØªØ±Ø§Ø¬' && formData.extraCharges === 'yes') ? 10 : 0;
      } else if (formData.towType === 'flatbed') {
        if (formData.companyArabic === 'Ø¨ÙˆØ±ØªØ±Ø§Ø¬') {
          // For flatbed Ø¨ÙˆØ±ØªØ±Ø§Ø¬ - use flatbedPortarageExtraCharges
          extraCharges = (formData.flatbedPortarageExtraCharges === 'yes') ? 10 : 0;
        } else {
          // For flatbed other companies - no charges
          extraCharges = 0;
        }
      }
      
      const lockedCharge = (formData.towType === 'flatbed' && formData.isLocked) ? 5 : 0;
      
      let portaragePrice = companyPrice;
      let discount = 0;
      
      if (formData.company.toLowerCase() !== 'portarage towtruk') {
        const portarageRoutes = getTowRoutes('portarage towtruk', formData.towType);
        const portarageRoute = portarageRoutes.find(r => r.from === formData.from && r.to === formData.to);
        
        if (portarageRoute) {
          portaragePrice = parseFloat(portarageRoute.price) || 0;
          discount = portaragePrice - companyPrice;
        }
      }
      
      const tbody = document.getElementById('towResultBody');
      let rows = '';
      
      if (formData.company.toLowerCase() !== 'portarage towtruk') {
        const finalPrice = companyPrice + extraCharges + lockedCharge;
        
        rows = `
          <tr>
            <td>Ø³Ø¹Ø± ${formData.companyArabic}</td>
            <td class="highlight">${companyPrice.toFixed(2)} ${config.currency}</td>
          </tr>
          <tr>
            <td>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ (Ø¨ÙˆØ±ØªØ±Ø§Ø¬)</td>
            <td>${portaragePrice.toFixed(2)} ${config.currency}</td>
          </tr>
          <tr style="background: #1a4a2a;">
            <td><strong>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…</strong></td>
            <td class="highlight" style="color: #10b981;"><strong>${discount.toFixed(2)} ${config.currency}</strong></td>
          </tr>
        `;
        
        if (lockedCharge > 0 || extraCharges > 0) {
          if (lockedCharge > 0) {
            rows += `
              <tr>
                <td>Ø¥Ø¶Ø§ÙØ© ÙˆÙ†Ø´ Ù…Ø³ÙƒØ±</td>
                <td class="highlight">${lockedCharge.toFixed(2)} ${config.currency}</td>
              </tr>
            `;
          }
          if (extraCharges > 0) {
            rows += `
              <tr>
                <td>Ø±Ø³ÙˆÙ… Ø¹Ø±Ø¨Ø§Ù†Ø§Øª (Ø§Ù„Ù‚ÙŠØ± Ù„Ø§ ÙŠØ¹Ù…Ù„)</td>
                <td class="highlight">${extraCharges.toFixed(2)} ${config.currency}</td>
              </tr>
            `;
          }
          rows += `
            <tr style="background: #262626;">
              <td><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</strong></td>
              <td class="highlight"><strong>${finalPrice.toFixed(2)} ${config.currency}</strong></td>
            </tr>
          `;
        }
      } else {
        rows = `
          <tr>
            <td>Ø³Ø¹Ø± Ø¨ÙˆØ±ØªØ±Ø§Ø¬ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</td>
            <td class="highlight">${companyPrice.toFixed(2)} ${config.currency}</td>
          </tr>
        `;
        
        if (lockedCharge > 0 || extraCharges > 0) {
          if (lockedCharge > 0) {
            rows += `
              <tr>
                <td>Ø¥Ø¶Ø§ÙØ© ÙˆÙ†Ø´ Ù…Ø³ÙƒØ±</td>
                <td class="highlight">${lockedCharge.toFixed(2)} ${config.currency}</td>
              </tr>
            `;
          }
          if (extraCharges > 0) {
            rows += `
              <tr>
                <td>Ø±Ø³ÙˆÙ… Ø¹Ø±Ø¨Ø§Ù†Ø§Øª (Ø§Ù„Ù‚ÙŠØ± Ù„Ø§ ÙŠØ¹Ù…Ù„)</td>
                <td class="highlight">${extraCharges.toFixed(2)} ${config.currency}</td>
              </tr>
            `;
          }
          const total = companyPrice + lockedCharge + extraCharges;
          rows += `
            <tr style="background: #262626;">
              <td><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</strong></td>
              <td class="highlight"><strong>${total.toFixed(2)} ${config.currency}</strong></td>
            </tr>
          `;
        }
        
        const cancelPrice = getCancellationPrice(formData.from, formData.to, formData.towType);
        if (cancelPrice) {
          rows += `
            <tr>
              <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
              <td>${cancelPrice}</td>
            </tr>
          `;
        }
      }
      
      tbody.innerHTML = rows;
      document.getElementById('towResultSection').classList.remove('hidden');
      
      setTimeout(() => {
        const resultSection = document.getElementById('towResultSection');
        if (resultSection) {
          resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      }, 100);
    }
    
    function getCancellationPrice(from, to, towType) {
      const rows = sheetsData['portarage towtruk'];
      if (!rows || rows.length < 3) return null;
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        
        if (towType === 'normal') {
          if (row[6] === from && row[5] === to && row[3]) {
            return `${parseFloat(row[3]).toFixed(2)} ${config.currency}`;
          }
          if (row[6] === from && row[2] === to && row[0]) {
            return `${parseFloat(row[0]).toFixed(2)} ${config.currency}`;
          }
        } else if (towType === 'flatbed') {
          if (row[14] === from && row[13] === to && row[11]) {
            return `${parseFloat(row[11]).toFixed(2)} ${config.currency}`;
          }
          if (row[14] === from && row[10] === to && row[8]) {
            return `${parseFloat(row[8]).toFixed(2)} ${config.currency}`;
          }
        }
      }
      
      return null;
    }

    // Render Battery Install Interface
    function renderBatteryInstallInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section full-width">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
          <div class="form-field">
            <input type="text" list="areaOptions" id="areaSelect" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
            <datalist id="areaOptions"></datalist>
          </div>
          <div class="info-box">Ø¨Ø·Ø§Ø±ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„ - Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¹Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
        </div>
        
        <div id="serviceResultSection" class="data-table-container hidden">
          <div class="table-header">ØªØ±ÙƒÙŠØ¨ Ø¨Ø·Ø§Ø±ÙŠØ©</div>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                  <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                </tr>
              </thead>
              <tbody id="serviceResultBody">
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      loadBatteryInstallOptions();
    }
    
    function loadBatteryInstallOptions() {
      const areaSelect = document.getElementById('areaSelect');
      const areaDatalist = document.getElementById('areaOptions');
      
      if (!sheetsData['ØªØ±ÙƒÙŠØ¨ Ø¨Ø·Ø§Ø±ÙŠØ©']) {
        areaDatalist.innerHTML = '<option value="">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>';
        return;
      }
      
      const rows = sheetsData['ØªØ±ÙƒÙŠØ¨ Ø¨Ø·Ø§Ø±ÙŠØ©'];
      const areas = [];
      
      // Skip first 3 rows (headers)
      for (let i = 3; i < rows.length; i++) {
        const row = rows[i];
        if (row[0]) areas.push(row[0]);
        if (row[4]) areas.push(row[4]);
      }
      
      const uniqueAreas = [...new Set(areas)].filter(Boolean);
      areaDatalist.innerHTML = uniqueAreas.map(area => `<option value="${area}">${area}</option>`).join('');
      
      areaSelect.oninput = () => {
        formData.area = areaSelect.value;
        if (formData.area) {
          calculateBatteryInstallPrice();
        } else {
          document.getElementById('serviceResultSection').classList.add('hidden');
        }
      };
    }
    
    function calculateBatteryInstallPrice() {
      const rows = sheetsData['ØªØ±ÙƒÙŠØ¨ Ø¨Ø·Ø§Ø±ÙŠØ©'];
      if (!rows || !formData.area) return;
      
      let price = null;
      let cancellation = null;
      
      // Skip first 3 rows (headers)
      for (let i = 3; i < rows.length; i++) {
        const row = rows[i];
        
        if (row[0] === formData.area) {
          price = row[1];
          cancellation = row[2];
          break;
        }
        
        if (row[4] === formData.area) {
          price = row[5];
          cancellation = row[6];
          break;
        }
      }
      
      if (!price) {
        document.getElementById('serviceResultSection').classList.add('hidden');
        return;
      }
      
      const tbody = document.getElementById('serviceResultBody');
      tbody.innerHTML = `
        <tr>
          <td>Ø³Ø¹Ø± Ø§Ù„Ø®Ø¯Ù…Ø©</td>
          <td class="highlight">${parseFloat(price).toFixed(2)} ${config.currency}</td>
        </tr>
        <tr>
          <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
          <td>${cancellation ? parseFloat(cancellation).toFixed(2) + ' ' + config.currency : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
        </tr>
      `;
      
      document.getElementById('serviceResultSection').classList.remove('hidden');
    }

    // Render Fuel Interface
    function renderFuelInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
          <div class="form-field">
            <input type="text" list="areaOptions" id="areaSelect" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
            <datalist id="areaOptions"></datalist>
          </div>
        </div>
        
        <div id="fuelTypeSection" class="form-section hidden">
          <h3 class="section-title">Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†</h3>
          <div class="btn-grid" style="grid-template-columns: repeat(3, 1fr);">
            <button class="btn-option" data-fuel="premium">Ø¨Ù†Ø²ÙŠÙ† Ù…Ù…ØªØ§Ø²<br><small>(1.5 Ø¯.Ùƒ)</small></button>
            <button class="btn-option" data-fuel="special">Ø¨Ù†Ø²ÙŠÙ† Ø®ØµÙˆØµÙŠ<br><small>(1.5 Ø¯.Ùƒ)</small></button>
            <button class="btn-option" data-fuel="ultra">Ø¨Ù†Ø²ÙŠÙ† Ø§Ù„ØªØ±Ø§<br><small>(2.5 Ø¯.Ùƒ)</small></button>
          </div>
        </div>

        <!-- (ØªÙ… Ù†Ù‚Ù„ ÙˆØ§Ø¬Ù‡Ø© ÙØªØ­ Ø§Ù„Ù‚ÙÙ„ Ø¥Ù„Ù‰ Ø®Ø¯Ù…Ø© Ù…Ù†ÙØµÙ„Ø© 'ÙØªØ­ Ù‚ÙÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©') -->

        <div id="fuelResultSection" class="data-table-container hidden">
          <div class="table-header">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</div>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                  <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                </tr>
              </thead>
              <tbody id="fuelResultBody">
              </tbody>
            </table>
          </div>
          <div class="warning-box">
            <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ù„Ø§Ø²Ù… ØªØ´Ø±Ø­ÙˆÙ† Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù†Ù‡ Ø±Ø³ÙˆÙ… Ø§Ù„Ø®Ø¯Ù…Ù‡ Ù…Ù†ÙØµÙ„Ø© Ø¹Ù† Ø³Ø¹Ø± Ø§Ù„Ø¨Ù†Ø²ÙŠÙ† ÙˆØ§Ù„ÙƒÙ… ÙŠÙˆØµÙ„Ù‡ Ù„Ø§Ù‚Ø±Ø¨ Ù…Ø­Ø·Ù‡ ÙÙ‚Ø·
          </div>
        </div>
      `;
      
      loadAreaOptionsDatalist('Ø®Ø¯Ù…Ø§Øª5', [0, 1, 2, 4, 5, 6], () => {
        document.getElementById('fuelTypeSection').classList.remove('hidden');

        document.querySelectorAll('[data-fuel]').forEach(btn => {
          btn.onclick = () => {
            document.querySelectorAll('[data-fuel]').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            formData.fuelType = btn.dataset.fuel;
            calculateFuelPrice();
          };
        });
      });
    }

    function calculateFuelPrice() {
      const rows = sheetsData['Ø®Ø¯Ù…Ø§Øª5'];
      if (!rows || !formData.area) return;
      
      let servicePrice = 0;
      let cancellation = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        if (row[0] === formData.area) {
          servicePrice = parseFloat(row[1]) || 0;
          cancellation = row[2] ? `${parseFloat(row[2]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        } else if (row[4] === formData.area) {
          servicePrice = parseFloat(row[5]) || 0;
          cancellation = row[6] ? `${parseFloat(row[6]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        }
      }
      
      const fuelPrices = { 'premium': 1.5, 'special': 1.5, 'ultra': 2.5 };
      const fuelPrice = fuelPrices[formData.fuelType] || 1.5;
      const total = servicePrice + fuelPrice;
      
      const fuelNames = { 'premium': 'Ø¨Ù†Ø²ÙŠÙ† Ù…Ù…ØªØ§Ø²', 'special': 'Ø¨Ù†Ø²ÙŠÙ† Ø®ØµÙˆØµÙŠ', 'ultra': 'Ø¨Ù†Ø²ÙŠÙ† Ø§Ù„ØªØ±Ø§' };
      
      const tbody = document.getElementById('fuelResultBody');
      tbody.innerHTML = `
        <tr>
          <td>Ø±Ø³ÙˆÙ… Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</td>
          <td class="highlight">${servicePrice.toFixed(2)} ${config.currency}</td>
        </tr>
        <tr>
          <td>Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†</td>
          <td>${fuelNames[formData.fuelType]}</td>
        </tr>
        <tr>
          <td>Ø³Ø¹Ø± Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†</td>
          <td class="highlight">${fuelPrice.toFixed(2)} ${config.currency}</td>
        </tr>
        <tr style="background: #262626;">
          <td><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</strong></td>
          <td class="highlight"><strong>${total.toFixed(2)} ${config.currency}</strong></td>
        </tr>
        <tr>
          <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
          <td>${cancellation}</td>
        </tr>
      `;
      
      document.getElementById('fuelResultSection').classList.remove('hidden');
    }

    // Calculate price for ÙØªØ­ Ù‚ÙÙ„ when performed by Ø¨ÙˆØ±ØªØ±Ø§Ø¬
    function calculateLockPortaragePrice() {
      const rows = sheetsData['ÙØªØ­ Ù‚ÙÙ„'] || sheetsData['Ø®Ø¯Ù…Ø§Øª5'];
      if (!rows || !formData.lockArea) return;

      let price = null;
      let cancellation = null;

      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];

        // Read from columns Q (16), R (17), S (18)
        if (row[16] === formData.lockArea) {
          price = parseFloat(row[17]) || 0;
          cancellation = row[18] ? `${parseFloat(row[18]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        }

        // Read from columns U (20), V (21), W (22)
        if (row[20] === formData.lockArea) {
          price = parseFloat(row[21]) || 0;
          cancellation = row[22] ? `${parseFloat(row[22]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        }
      }

      const body = document.getElementById('lockPortarageBody');
      const result = document.getElementById('lockPortarageResult');
      const finalNotice = document.getElementById('lockFinalNotice');

      if (price === null) {
        result.classList.add('hidden');
        return;
      }

      // Ù„Ø¨ÙˆØ±ØªØ±Ø§Ø¬: Ù„Ø§ Ù†Ø¶ÙŠÙ Ø£ÙŠ Ø²ÙŠØ§Ø¯Ø©ØŒ Ø§Ù„Ø³Ø¹Ø± ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ù† Ø§Ù„Ø´ÙŠØª
      const finalPrice = price;

      body.innerHTML = `
        <tr>
          <td>Ø³Ø¹Ø± ÙØªØ­ Ø§Ù„Ù‚ÙÙ„ (Ø¨ÙˆØ±ØªØ±Ø§Ø¬)</td>
          <td class="highlight">${price.toFixed(2)} ${config.currency}</td>
        </tr>
        <tr>
          <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
          <td>${cancellation}</td>
        </tr>
        <tr style="background: #262626;">
          <td><strong>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</strong></td>
          <td class="highlight"><strong>${finalPrice.toFixed(2)} ${config.currency}</strong></td>
        </tr>
      `;

      result.classList.remove('hidden');
      // Ù„Ø¨ÙˆØ±ØªØ±Ø§Ø¬: Ù„Ø§ Ù†Ø¹Ø±Ø¶ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø£Ø²Ø±Ù‚ ÙˆÙÙ‚ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    }

    // Calculate price for ÙØªØ­ Ù‚ÙÙ„ when performed by Ù…ÙˆØ±Ø¯ Ø®Ø§Ø±Ø¬ÙŠ
    function calculateLockExternalPrice(externalPrice) {
      const rows = sheetsData['ÙØªØ­ Ù‚ÙÙ„'] || sheetsData['Ø®Ø¯Ù…Ø§Øª5'];
      const externalBody = document.getElementById('lockExternalBody');
      const externalResult = document.getElementById('lockExternalResult');
      const finalNotice = document.getElementById('lockFinalNotice');
      const externalNoteDisplay = document.getElementById('lockExternalNoteDisplay');

      if (!rows) return;

      // apply fixed surcharge for external as well
      const finalPrice = (externalPrice || 0) + LOCK_SURCHARGE;

      externalBody.innerHTML = `
        <tr>
          <td>Ø³Ø¹Ø± Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ</td>
          <td class="highlight">${(externalPrice||0).toFixed(2)} ${config.currency}</td>
        </tr>
        <tr style="background: #262626;">
          <td><strong>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</strong></td>
          <td class="highlight"><strong>${finalPrice.toFixed(2)} ${config.currency}</strong></td>
        </tr>
      `;

      externalResult.classList.remove('hidden');
      // show final notice and external note
      if (finalNotice) {
        finalNotice.classList.remove('hidden');
        finalNotice.textContent = `Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø°ÙŠ ÙŠØªÙ… Ø§Ø¨Ù„Ø§Øº Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠÙ‡ Ù…Ø¹ Ø§Ù„Ø²ÙŠØ§Ø¯Ø© : ${finalPrice.toFixed(2)} ${config.currency}`;
      }
      if (externalNoteDisplay) externalNoteDisplay.classList.remove('hidden');
    }

    // Apply surcharge string from sheet first row column I.
    // surchargeRaw can be '10%' or '2.5' (absolute). Returns numeric final price.
    function applySurcharge(basePrice, surchargeRaw) {
      if (!surchargeRaw) return basePrice;
      const s = surchargeRaw.toString().trim();
      if (s.endsWith('%')) {
        const p = parseFloat(s.replace('%', '')) || 0;
        return basePrice + (basePrice * p / 100);
      }
      const absolute = parseFloat(s);
      if (isNaN(absolute)) return basePrice;
      // If value looks like a percentage number (e.g. 10) treat as percent (10 -> 10%)
      if (absolute >= 1 && absolute <= 100) {
        return basePrice + (basePrice * absolute / 100);
      }
      // otherwise treat as absolute amount
      return basePrice + absolute;
    }

    // Render Puncture Service (Ø¨Ù†Ø´Ø±)
    function renderPunctureService() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section full-width">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
          <div class="form-field">
            <input type="text" list="areaOptions" id="areaSelect" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
            <datalist id="areaOptions"></datalist>
          </div>
          <div class="info-box">
            <strong>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù…:</strong><br>
            â€¢ <strong>Ø±Ù‚Ø¹Ø© Ø®Ø§Ø±Ø¬ÙŠØ© / Ø³Ø¨ÙŠØ± / ØªØ¹Ø¨Ø¦Ø© Ù‡ÙˆØ§Ø¡:</strong> Ø£ÙŠ ÙÙ†ÙŠ + Ø¨Ø§Øµ Ø§Ù„ØªÙˆØ§ÙŠØ±<br>
            â€¢ <strong>Ø±Ù‚Ø¹Ø© Ø¯Ø§Ø®Ù„ÙŠØ©:</strong> ÙÙ‚Ø· Ø¨Ø§Øµ Ø§Ù„ØªÙˆØ§ÙŠØ±
          </div>
        </div>
        
        <div id="tireResultSection" class="data-table-container hidden">
          <div class="table-header">Ø£Ø³Ø¹Ø§Ø± Ø®Ø¯Ù…Ø© Ø§Ù„Ø¨Ù†Ø´Ø±</div>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                  <th>Ø§Ù„Ø³Ø¹Ø±</th>
                  <th>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</th>
                </tr>
              </thead>
              <tbody id="tireResultBody">
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      loadAreaOptionsDatalist('Ø®Ø¯Ù…Ø§Øª5', [0, 1, 2, 4, 5, 6, 8, 9, 10, 12, 13, 14], () => {
        calculatePuncturePrice();
      });
    }

    // Render Unlock (ÙØªØ­ Ù‚ÙÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©) as a separate service
    function renderLockInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section">
          <h3 class="section-title">ÙØªØ­ Ù‚ÙÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ğŸ”“</h3>
          <div class="form-field">
            <label>Ù…Ù† Ø³ÙŠÙ‚ÙˆÙ… Ø¨Ø§Ù„Ø®Ø¯Ù…Ø©ØŸ</label>
            <div class="btn-grid" style="grid-template-columns: repeat(2,1fr);">
              <button class="btn-option" id="lockProviderPortarage" data-lock-provider="Ø¨ÙˆØ±ØªØ±Ø§Ø¬">Ø¨ÙˆØ±ØªØ±Ø§Ø¬</button>
              <button class="btn-option" id="lockProviderExternal" data-lock-provider="Ù…ÙˆØ±Ø¯ Ø®Ø§Ø±Ø¬ÙŠ">Ù…ÙˆØ±Ø¯ Ø®Ø§Ø±Ø¬ÙŠ</button>
            </div>
          </div>

          <div id="lockPortaragePanel" class="form-section hidden" style="margin-top:8px;">
            <div class="form-field">
              <label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
              <input type="text" list="areaOptions" id="lockAreaSelect" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
              <datalist id="areaOptions"></datalist>
            </div>
            <div id="lockPortarageResult" class="data-table-container hidden">
              <div class="table-header">Ù†ØªÙŠØ¬Ø© ÙØªØ­ Ø§Ù„Ù‚ÙÙ„ - Ø¨ÙˆØ±ØªØ±Ø§Ø¬</div>
              <div class="table-scroll"><table class="data-table"><thead><tr><th>Ø§Ù„Ø¨ÙŠØ§Ù†</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr></thead><tbody id="lockPortarageBody"></tbody></table></div>
            </div>
            <div class="warning-box" style="margin-top:8px;">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙÙ†ÙŠ Ø¨ÙˆØ±ØªØ±Ø§Ø¬ Ø§Ù†Ù‡ ÙŠÙ‚Ø¯Ø± ÙŠÙØªØ­ Ø¨Ø§Ø¨ Ø§Ù„Ø³ÙŠØ§Ø±Ù‡ Ù„Ù†Ù‡ Ù…Ø§Ø¹Ù†Ø¯Ù†Ø§ Ø§Ù…ÙƒØ§Ù†ÙŠÙ‡ Ù†ÙØªØ­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</div>
          </div>

          <div id="lockExternalPanel" class="form-section hidden" style="margin-top:8px;">
            <div class="form-field">
              <label>Ø³Ø¹Ø± Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ</label>
              <input type="number" id="lockExternalPrice" class="form-control" placeholder="Ø¶Ø¹ Ø³Ø¹Ø± Ø§Ù„ÙÙ†ÙŠ Ù‡Ù†Ø§">
            </div>
            <div id="lockExternalNoteDisplay" class="info-box" style="margin-top:8px;">Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ù„ÙÙ†ÙŠÙ† Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠÙ† â€” Ù‚Ø±ÙˆØ¨ Ø¹Ø«Ù…Ø§Ù† â€¢ Mr.LOCK</div>
            <div id="lockExternalResult" class="data-table-container hidden"><div class="table-header">Ù†ØªÙŠØ¬Ø© ÙØªØ­ Ø§Ù„Ù‚ÙÙ„ - Ù…ÙˆØ±Ø¯ Ø®Ø§Ø±Ø¬ÙŠ</div><div class="table-scroll"><table class="data-table"><thead><tr><th>Ø§Ù„Ø¨ÙŠØ§Ù†</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr></thead><tbody id="lockExternalBody"></tbody></table></div></div>
          </div>

          <div id="lockFinalNotice" class="info-box hidden" style="margin-top:8px;"></div>
        </div>
      `;
      // populate area options for this service from sheet 'ÙØªØ­ Ù‚ÙÙ„'
      loadLockAreaOptionsDatalist();

      // wire up buttons
      document.getElementById('lockProviderPortarage').onclick = () => {
        document.getElementById('lockProviderPortarage').classList.add('active');
        document.getElementById('lockProviderExternal').classList.remove('active');
        document.getElementById('lockPortaragePanel').classList.remove('hidden');
        document.getElementById('lockExternalPanel').classList.add('hidden');
        document.getElementById('lockFinalNotice').classList.add('hidden');
      };

      document.getElementById('lockProviderExternal').onclick = () => {
        document.getElementById('lockProviderExternal').classList.add('active');
        document.getElementById('lockProviderPortarage').classList.remove('active');
        document.getElementById('lockExternalPanel').classList.remove('hidden');
        document.getElementById('lockPortaragePanel').classList.add('hidden');
        document.getElementById('lockFinalNotice').classList.add('hidden');
      };

      // when area selected
      const lockAreaSelect = document.getElementById('lockAreaSelect');
      lockAreaSelect.oninput = () => {
        formData.lockArea = lockAreaSelect.value.trim();
        if (!formData.lockArea) {
          document.getElementById('lockPortarageResult').classList.add('hidden');
          return;
        }
        calculateLockPortaragePrice();
      };

      // external price
      const lockExternalPrice = document.getElementById('lockExternalPrice');
      // update immediately on input/change/keyup
      if (lockExternalPrice) {
        ['input', 'change', 'keyup'].forEach(evt => {
          lockExternalPrice.addEventListener(evt, () => {
            const val = parseFloat(lockExternalPrice.value);
            calculateLockExternalPrice(isNaN(val) ? 0 : val);
            const note = document.getElementById('lockExternalNoteDisplay');
            if (note) note.style.display = 'block';
          });
        });
      }
    }

    // Load datalist options specifically for ÙØªØ­ Ù‚ÙÙ„ sheet
    function loadLockAreaOptionsDatalist() {
      const areaDatalist = document.getElementById('areaOptions');
      const rows = sheetsData['ÙØªØ­ Ù‚ÙÙ„'] || sheetsData['Ø®Ø¯Ù…Ø§Øª5'];
      if (!rows) {
        areaDatalist.innerHTML = '<option value="">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>';
        return;
      }

      const areas = [];
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        // Read from column Q (16) and U (20)
        if (row[16]) areas.push(row[16]);
        if (row[20]) areas.push(row[20]);
      }

      const uniqueAreas = [...new Set(areas)].filter(Boolean);
      areaDatalist.innerHTML = uniqueAreas.map(area => `<option value="${area}">${area}</option>`).join('');
    }

    function calculatePuncturePrice() {
      const rows = sheetsData['Ø®Ø¯Ù…Ø§Øª5'];
      if (!rows) return;
      
      let externalPrice = 'ØºÙŠØ± Ù…ØªÙˆÙØ±', externalCancel = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      let internalPrice = 'ØºÙŠØ± Ù…ØªÙˆÙØ±', internalCancel = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        
        if (row[0] === formData.area) {
          externalPrice = row[1] ? `${parseFloat(row[1]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
          externalCancel = row[2] ? `${parseFloat(row[2]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        } else if (row[4] === formData.area) {
          externalPrice = row[5] ? `${parseFloat(row[5]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
          externalCancel = row[6] ? `${parseFloat(row[6]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }
        
        if (row[8] === formData.area) {
          internalPrice = row[9] ? `${parseFloat(row[9]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
          internalCancel = row[10] ? `${parseFloat(row[10]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        } else if (row[12] === formData.area) {
          internalPrice = row[13] ? `${parseFloat(row[13]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
          internalCancel = row[14] ? `${parseFloat(row[14]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }
      }
      
      const tbody = document.getElementById('tireResultBody');
      tbody.innerHTML = `
        <tr>
          <td>Ø±Ù‚Ø¹Ø© Ø®Ø§Ø±Ø¬ÙŠØ© / ØªØ±ÙƒÙŠØ¨ Ø³Ø¨ÙŠØ± / ØªØ¹Ø¨Ø¦Ø© Ù‡ÙˆØ§Ø¡</td>
          <td class="highlight">${externalPrice}</td>
          <td>${externalCancel}</td>
        </tr>
        <tr>
          <td>Ø±Ù‚Ø¹Ø© Ø¯Ø§Ø®Ù„ÙŠØ©</td>
          <td class="highlight">${internalPrice}</td>
          <td>${internalCancel}</td>
        </tr>
      `;
      
      document.getElementById('tireResultSection').classList.remove('hidden');
    }

    // Render Balance Service (Ù…ÙŠØ²Ø§Ù† ÙˆØªØ±ÙƒÙŠØ¨)
    function renderBalanceService() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section">
          <h3 class="section-title">Ù…ØµØ¯Ø± Ø§Ù„ØªÙˆØ§ÙŠØ±</h3>
          <div class="btn-grid" style="grid-template-columns: repeat(2, 1fr);">
            <button class="btn-option" data-source="customer">Ù…Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
            <button class="btn-option" data-source="ours">Ù…Ù† Ø¹Ù†Ø¯Ù†Ø§</button>
          </div>
        </div>
        
        <div id="balanceAreaSection" class="form-section hidden">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
          <div class="form-field">
            <input type="text" list="areaOptions" id="areaSelect" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
            <datalist id="areaOptions"></datalist>
          </div>
        </div>
        
        <div id="tireCountSection" class="form-section hidden">
          <h3 class="section-title">Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆØ§ÙŠØ±</h3>
          <div class="form-field">
            <input type="number" id="tireCountInput" class="form-control" min="1" max="10" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆØ§ÙŠØ±">
          </div>
        </div>
        
        <div id="balanceResultSection" class="data-table-container hidden">
          <div class="table-header">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</div>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                  <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                </tr>
              </thead>
              <tbody id="balanceResultBody">
              </tbody>
            </table>
          </div>
          <div id="balanceNote" class="info-box hidden"></div>
        </div>
      `;
      
      document.querySelectorAll('[data-source]').forEach(btn => {
        btn.onclick = () => {
          document.querySelectorAll('[data-source]').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          formData.tireSource = btn.dataset.source;
          
          // Hide all sections first
          document.getElementById('balanceResultSection').classList.add('hidden');
          document.getElementById('balanceAreaSection').classList.add('hidden');
          document.getElementById('tireCountSection').classList.add('hidden');
          document.getElementById('areaSelect').value = '';
          formData.area = null;
          
          // Show area section
          document.getElementById('balanceAreaSection').classList.remove('hidden');
          
          if (formData.tireSource === 'ours') {
            document.getElementById('tireCountSection').classList.add('hidden');
            loadAreaOptionsDatalist('Ù…ÙŠØ²Ø§Ù† ÙˆØªØ±ÙƒÙŠØ¨', [0, 1, 2, 4, 5, 6], calculateBalancePrice);
          } else {
            document.getElementById('tireCountSection').classList.remove('hidden');
            loadAreaOptionsDatalist('Ù…ÙŠØ²Ø§Ù† ÙˆØªØ±ÙƒÙŠØ¨', [8, 9, 10, 12, 13, 14], () => {
              const tireCountInput = document.getElementById('tireCountInput');
              tireCountInput.oninput = (e) => {
                formData.tireCount = parseInt(e.target.value) || 0;
                if (formData.tireCount > 0 && formData.area) calculateBalancePrice();
              };
            });
          }
        };
      });
    }

    function calculateBalancePrice() {
      if (!formData.area) return;
      
      const rows = sheetsData['Ù…ÙŠØ²Ø§Ù† ÙˆØªØ±ÙƒÙŠØ¨'];
      if (!rows) return;
      
      let basePrice = 0;
      let cancellation = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      
      if (formData.tireSource === 'ours') {
        for (let i = 2; i < rows.length; i++) {
          const row = rows[i];
          if (row[0] === formData.area) {
            basePrice = parseFloat(row[1]) || 0;
            cancellation = row[2] ? `${parseFloat(row[2]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            break;
          } else if (row[4] === formData.area) {
            basePrice = parseFloat(row[5]) || 0;
            cancellation = row[6] ? `${parseFloat(row[6]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            break;
          }
        }
        
        const tbody = document.getElementById('balanceResultBody');
        tbody.innerHTML = `
          <tr>
            <td>Ø³Ø¹Ø± Ø§Ù„Ø®Ø¯Ù…Ø©</td>
            <td class="highlight">${basePrice.toFixed(2)} ${config.currency}</td>
          </tr>
          <tr>
            <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
            <td>${cancellation}</td>
          </tr>
        `;
        
        const noteDiv = document.getElementById('balanceNote');
        noteDiv.textContent = 'Ø§Ù„Ø³Ø¹Ø± Ù‡Ø°Ø§ Ø³ÙˆØ§Ø¡ Ø¨Ù†Ø±ÙƒØ¨ Ù…Ù† ØªØ§ÙŠØ± Ø§Ù„Ù‰ Ø§Ø±Ø¨Ø¹ ØªÙˆØ§ÙŠØ± Ù†ÙØ³ Ø±Ø³ÙˆÙ… Ø§Ù„Ø®Ø¯Ù…Ù‡';
        noteDiv.classList.remove('hidden');
        
      } else {
        for (let i = 2; i < rows.length; i++) {
          const row = rows[i];
          if (row[8] === formData.area) {
            basePrice = parseFloat(row[9]) || 0;
            cancellation = row[10] ? `${parseFloat(row[10]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            break;
          } else if (row[12] === formData.area) {
            basePrice = parseFloat(row[13]) || 0;
            cancellation = row[14] ? `${parseFloat(row[14]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            break;
          }
        }
        
        const tireCount = formData.tireCount || 0;
        const total = basePrice + (tireCount * 5);
        
        const tbody = document.getElementById('balanceResultBody');
        tbody.innerHTML = `
          <tr>
            <td>Ø³Ø¹Ø± Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</td>
            <td class="highlight">${basePrice.toFixed(2)} ${config.currency}</td>
          </tr>
          <tr>
            <td>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆØ§ÙŠØ±</td>
            <td>${tireCount}</td>
          </tr>
          <tr>
            <td>Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆØ§ÙŠØ± (5 Ø¯.Ùƒ Ã— ${tireCount})</td>
            <td class="highlight">${(tireCount * 5).toFixed(2)} ${config.currency}</td>
          </tr>
          <tr style="background: #262626;">
            <td><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</strong></td>
            <td class="highlight"><strong>${total.toFixed(2)} ${config.currency}</strong></td>
          </tr>
          <tr>
            <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
            <td>${cancellation}</td>
          </tr>
        `;
        
        const noteDiv = document.getElementById('balanceNote');
        noteDiv.textContent = 'Ø¥Ø°Ø§ Ø§Ù„ØªÙˆØ§ÙŠØ± Ù…Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„';
        noteDiv.classList.remove('hidden');
      }
      
      document.getElementById('balanceResultSection').classList.remove('hidden');
    }

    // Render Mechanical Interface - UPDATED: Ø²ÙŠØª ÙˆÙÙ„ØªØ± ÙƒØ®ÙŠØ§Ø±
    function renderMechanicalInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section" id="mechTypeSection">
          <h3 class="section-title" style="display:flex; align-items:center; gap:8px;">
            <span>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</span>
            <button id="groupsCircleBtn" title="Ø§Ù„Ù‚Ø±ÙˆØ¨Ø§Øª" aria-label="Ø§Ù„Ù‚Ø±ÙˆØ¨Ø§Øª"
              style="height:28px; border-radius:16px; display:inline-flex; align-items:center; justify-content:center; background:#0a0a0a; border:1px solid #333; color:#F2BC1B; font-size:14px; cursor:pointer; padding:0 10px; gap:6px;">
              <span>ğŸ‘¥</span>
              <span style="color:#F2BC1B;">Ø§Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚Ø±ÙˆØ¨Ø§Øª</span>
            </button>
          </h3>
          <div class="btn-grid" style="grid-template-columns: repeat(5, 1fr);">
            <button class="btn-option" id="mechAppointmentsBtn">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</button>
            <button class="btn-option" data-mech="inspection">ÙØ­Øµ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</button>
            <button class="btn-option" data-mech="brakes">Ø³ÙØ§ÙŠÙ ÙˆØ¯ÙŠØ³ÙƒØ§Øª</button>
            <button class="btn-option" data-mech="oilfilter">Ø²ÙŠØª ÙˆÙÙ„ØªØ±</button>
            <button class="btn-option" data-mech="alternator">ØªØ¨Ø¯ÙŠÙ„ Ø¯ÙŠÙ†Ù…Ùˆ/Ø³Ù„Ù</button>
            <button class="btn-option" data-mech="wipers">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª</button>
            <button class="btn-option" data-mech="acgas">ØªØ¹Ø¨Ø¦Ù‡ ØºØ§Ø² Ù…ÙƒÙŠÙ</button>
            <button class="btn-option" data-mech="coolant">Ù…Ø§ÙŠ Ø±Ø§Ø¯ÙŠØªØ±</button>
            <button class="btn-option" data-mech="brakefluid">Ø²ÙŠØª Ø¨Ø±ÙŠÙƒ</button>
            <button class="btn-option" data-mech="transmission">Ø²ÙŠØª Ø³ÙƒØ§Ù†</button>
          </div>
        </div>
        
        <div class="form-section" id="mechBackButtonSection" style="display:none;">
          <div style="display:flex;gap:8px;align-items:center;justify-content:flex-start;">
            <button class="btn-back" onclick="renderMechanicalInterface()" style="padding:8px 12px;font-size:12px;flex:0;">
              <span>â†</span> <span>Ø±Ø¬ÙˆØ¹</span>
            </button>
            <div id="mechSelectedService" style="color:#F2BC1B;font-weight:700;font-size:14px;white-space:nowrap;padding:4px 8px;"></div>
          </div>
        </div>
        
        <div id="oilFilterSourceSection" class="form-section hidden">
          <h3 class="section-title">Ù…ØµØ¯Ø± Ø§Ù„Ø²ÙŠØª</h3>
          <div class="btn-grid" style="grid-template-columns: repeat(2, 1fr);">
            <button class="btn-option" data-oil-source="customer">Ù…Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
            <button class="btn-option" data-oil-source="ours">Ù…Ù† Ø¹Ù†Ø¯Ù†Ø§</button>
          </div>
        </div>
        
        <div id="mechAreaSection" class="form-section hidden">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
          <div class="form-field">
            <input type="text" list="areaOptions" id="areaSelect" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
            <datalist id="areaOptions"></datalist>
          </div>
        </div>
        
        <div id="diskTurningSection" class="form-section hidden">
          <h3 class="section-title">Ù…Ø®Ø±Ø·Ø© Ø¯ÙŠØ³ÙƒØ§Øª</h3>
          <div class="btn-grid" style="grid-template-columns: 1fr 1fr;">
            <button class="btn-option active" data-disk="no">Ù„Ø§</button>
            <button class="btn-option" data-disk="yes">Ù†Ø¹Ù… (+5 Ø¯.Ùƒ)</button>
          </div>
        </div>
        
        <div id="alternatorSupplierPriceSection" class="form-section hidden">
          <h3 class="section-title">Ø³Ø¹Ø± Ø§Ù„Ù…ÙˆØ±Ø¯</h3>
          <div class="form-field">
            <input type="number" id="supplierPrice" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„Ù‚Ø·Ø¹Ø© Ù…Ù† Ø§Ù„Ù…ÙˆØ±Ø¯" step="0.01">
          </div>
        </div>
        
        <div id="mechResultSection" class="data-table-container hidden">
          <div class="table-header">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</div>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                  <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„Ù‰</th>
                </tr>
              </thead>
              <tbody id="mechResultBody">
              </tbody>
            </table>
          </div>
          <div id="mechNote" class="info-box hidden"></div>
        </div>
        
        <div id="mechAppointmentsSection" class="data-table-container hidden" style="margin-top:12px; grid-column: 1 / -1;">
          <div class="table-header">Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©</div>
          <div style="display:flex;gap:8px;align-items:center;margin:8px 0;">
            <div>
              <label style="color:#fff;">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
              <input type="date" id="mechApptDate" class="form-control" style="max-width:160px;" />
            </div>
            <div>
              <label style="color:#fff;">Ø§Ù„ÙÙ†ÙŠ</label>
              <select id="mechTechnicianFilter" class="form-control" style="min-width:160px;"><option value="">Ø§Ù„ÙƒÙ„</option></select>
            </div>
            <div style="margin-left:auto;display:flex;gap:8px;">
              <button id="mechRegisterBtn" class="btn-primary">ØªØ³Ø¬ÙŠÙ„ Ù…ÙˆØ¹Ø¯</button>
              <button id="mechEditBtn" class="btn-primary" style="background:#666;color:#fff;">ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¹Ø¯</button>
            </div>
          </div>
          <div style="overflow-x:auto;">
            <table class="data-table" id="mechAppointmentsTable">
              <thead>
                <tr>
                  <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                  <th>Ø§Ù„ÙˆÙ‚Øª</th>
                  <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                  <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                  <th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
                  <th>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                  <th>Ø§Ù„ÙÙ†ÙŠ</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      `;
      
      // Service names mapping
      const serviceNames = {
        'inspection': 'ÙØ­Øµ Ø§Ù„Ø³ÙŠØ§Ø±Ø©',
        'brakes': 'Ø³ÙØ§ÙŠÙ ÙˆØ¯ÙŠØ³ÙƒØ§Øª',
        'oilfilter': 'Ø²ÙŠØª ÙˆÙÙ„ØªØ±',
        'alternator': 'ØªØ¨Ø¯ÙŠÙ„ Ø¯ÙŠÙ†Ù…Ùˆ/Ø³Ù„Ù',
        'wipers': 'ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª',
        'acgas': 'ØªØ¹Ø¨Ø¦Ù‡ ØºØ§Ø² Ù…ÙƒÙŠÙ',
        'coolant': 'Ù…Ø§ÙŠ Ø±Ø§Ø¯ÙŠØªØ±',
        'brakefluid': 'Ø²ÙŠØª Ø¨Ø±ÙŠÙƒ',
        'transmission': 'Ø²ÙŠØª Ø³ÙƒØ§Ù†'
      };
      
      document.querySelectorAll('[data-mech]').forEach(btn => {
        btn.onclick = () => {
          document.querySelectorAll('[data-mech]').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          // Hide service type section and show back button
          document.getElementById('mechTypeSection').style.display = 'none';
          document.getElementById('mechBackButtonSection').style.display = 'block';
          
          // Display selected service name
          const serviceName = serviceNames[btn.dataset.mech];
          document.getElementById('mechSelectedService').textContent = serviceName;
          
          formData.mechanicalService = btn.dataset.mech;
          
          document.getElementById('mechResultSection').classList.add('hidden');
          document.getElementById('areaSelect').value = '';
          formData.area = null;
          
          // Hide all dynamic sections
          document.getElementById('oilFilterSourceSection').classList.add('hidden');
          document.getElementById('mechAreaSection').classList.add('hidden');
          document.getElementById('diskTurningSection').classList.add('hidden');
          document.getElementById('alternatorSupplierPriceSection').classList.add('hidden');
          
          if (formData.mechanicalService === 'oilfilter') {
            // Show oil source selection
            document.getElementById('oilFilterSourceSection').classList.remove('hidden');
            
            document.querySelectorAll('[data-oil-source]').forEach(oilBtn => {
              oilBtn.onclick = () => {
                document.querySelectorAll('[data-oil-source]').forEach(b => b.classList.remove('active'));
                oilBtn.classList.add('active');
                
                formData.oilSource = oilBtn.dataset.oilSource;
                
                if (formData.oilSource === 'customer') {
                  // Show area selection and load data from columns 8-14
                  document.getElementById('mechAreaSection').classList.remove('hidden');
                  loadAreaOptionsDatalist('Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©', [8, 9, 10, 12, 13, 14], calculateMechanicalPrice);
                } else if (formData.oilSource === 'ours') {
                  // Open external oil website
                  openFullscreenIframe('https://portarageoils.netlify.app/', 'Ø²ÙŠØª ÙˆÙÙ„ØªØ±');
                }
              };
            });
            
          } else if (formData.mechanicalService === 'inspection' || formData.mechanicalService === 'acgas') {
            document.getElementById('diskTurningSection').classList.add('hidden');
            document.getElementById('mechAreaSection').classList.remove('hidden');
            // Use Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ© for inspection areas (A,B,C and E,F,G)
            loadAreaOptionsDatalist('Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©', [0, 1, 2, 4, 5, 6], calculateMechanicalPrice);
          } else if (formData.mechanicalService === 'brakes') {
            document.getElementById('diskTurningSection').classList.remove('hidden');
            document.getElementById('mechAreaSection').classList.remove('hidden');
            formData.diskTurning = 'no';
            
            document.querySelectorAll('[data-disk]').forEach(diskBtn => {
              diskBtn.onclick = () => {
                document.querySelectorAll('[data-disk]').forEach(b => b.classList.remove('active'));
                diskBtn.classList.add('active');
                
                formData.diskTurning = diskBtn.dataset.disk;
                if (formData.area) calculateMechanicalPrice();
              };
            });
            
            loadAreaOptionsDatalist('Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©', [16, 17, 18, 20, 21, 22], calculateMechanicalPrice);
          } else if (formData.mechanicalService === 'wipers') {
            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª â€” Ù…Ù†Ø§Ø·Ù‚ Ù…Ù† Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©2 (Ø£Ø¹Ù…Ø¯Ø© I,J,K Ùˆ M,N,O)
            document.getElementById('mechAreaSection').classList.remove('hidden');
            loadAreaOptionsDatalist('Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©2', [8, 9, 10, 12, 13, 14], calculateWipersPrice);
          } else if (formData.mechanicalService === 'alternator') {
            // Show area selection for alternator service from sheet 'Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©2'
            document.getElementById('mechAreaSection').classList.remove('hidden');
            document.getElementById('alternatorSupplierPriceSection').classList.remove('hidden');

            // Load areas from columns A & E from sheet 'Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©2'
            loadAreaOptionsDatalist('Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©2', [0, 1, 2, 4, 5, 6], calculateAlternatorPrice);

            // Add listener to supplier price input â€” hide results if cleared
            const supplierPriceInput = document.getElementById('supplierPrice');
            const newSupplierPriceInput = supplierPriceInput.cloneNode(true);
            supplierPriceInput.parentNode.replaceChild(newSupplierPriceInput, supplierPriceInput);

            newSupplierPriceInput.oninput = () => {
              const raw = newSupplierPriceInput.value.trim();
              if (raw === '') {
                formData.supplierPrice = null;
                document.getElementById('mechResultSection').classList.add('hidden');
                return;
              }

              formData.supplierPrice = parseFloat(raw) || 0;
              if (!formData.supplierPrice) {
                document.getElementById('mechResultSection').classList.add('hidden');
                return;
              }

              if (formData.area) calculateAlternatorPrice();
            };
          } else if (formData.mechanicalService === 'coolant' || formData.mechanicalService === 'brakefluid' || formData.mechanicalService === 'transmission') {
            document.getElementById('mechAreaSection').classList.remove('hidden');
            loadAreaOptionsDatalist('Ø®Ø¯Ù…Ø§Øª5', [0, 1, 2, 4, 5, 6], calculateFluidPrice);
          }
        };
      });
      // Appointments button (available immediately without selecting a service)
      const apptBtn = document.getElementById('mechAppointmentsBtn');
      if (apptBtn) {
        apptBtn.onclick = () => {
          // Hide service type section and show back button with appointments title
          document.getElementById('mechTypeSection').style.display = 'none';
          document.getElementById('mechBackButtonSection').style.display = 'block';
          document.getElementById('mechSelectedService').textContent = 'Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯';
          
          renderMechanicalAppointments();
        };
      }

      // Groups circle button opens groups modal without leaving mechanical UI
      const groupsCircleBtn = document.getElementById('groupsCircleBtn');
      if (groupsCircleBtn) {
        groupsCircleBtn.onclick = () => openGroupsModal();
      }
    }

    function calculateMechanicalPrice() {
      if (!formData.area) return;
      
      // Select appropriate sheet depending on mechanical service
      let rows = null;
      if (formData.mechanicalService === 'inspection' || formData.mechanicalService === 'acgas') {
        rows = sheetsData['Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©'];
      } else {
        rows = sheetsData['Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©'];
      }
      if (!rows) return;
      
      let columns;
      if (formData.mechanicalService === 'inspection' || formData.mechanicalService === 'acgas') {
        columns = [0, 1, 2, 4, 5, 6];
      } else if (formData.mechanicalService === 'brakes') {
        columns = [16, 17, 18, 20, 21, 22];
      } else if (formData.mechanicalService === 'oilfilter' && formData.oilSource === 'customer') {
        columns = [8, 9, 10, 12, 13, 14];
      }
      
      let basePrice = 0;
      let cancellation = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        if (row[columns[0]] === formData.area) {
          basePrice = parseFloat(row[columns[1]]) || 0;
          cancellation = row[columns[2]] ? `${parseFloat(row[columns[2]]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        } else if (row[columns[3]] === formData.area) {
          basePrice = parseFloat(row[columns[4]]) || 0;
          cancellation = row[columns[5]] ? `${parseFloat(row[columns[5]]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        }
      }
      
      const tbody = document.getElementById('mechResultBody');
      const noteDiv = document.getElementById('mechNote');
      
      if (formData.mechanicalService === 'brakes' && formData.diskTurning === 'yes') {
        const total = basePrice + 5;
        
        tbody.innerHTML = `
          <tr>
            <td>Ø³Ø¹Ø± Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</td>
            <td class="highlight">${basePrice.toFixed(2)} ${config.currency}</td>
          </tr>
          <tr>
            <td>Ù…Ø®Ø±Ø·Ø© Ø¯ÙŠØ³ÙƒØ§Øª</td>
            <td class="highlight">5.00 ${config.currency}</td>
          </tr>
          <tr style="background: #262626;">
            <td><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</strong></td>
            <td class="highlight"><strong>${total.toFixed(2)} ${config.currency}</strong></td>
          </tr>
          <tr>
            <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
            <td>${cancellation}</td>
          </tr>
        `;
        noteDiv.textContent = 'Ø¥Ø°Ø§ Ø§Ù„Ù‚Ø·Ø¹ Ù…Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„';
        noteDiv.classList.remove('hidden');
      } else {
        tbody.innerHTML = `
          <tr>
            <td>Ø³Ø¹Ø± Ø§Ù„Ø®Ø¯Ù…Ø©</td>
            <td class="highlight">${basePrice.toFixed(2)} ${config.currency}</td>
          </tr>
          <tr>
            <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
            <td>${cancellation}</td>
          </tr>
        `;
        
        if (formData.mechanicalService === 'brakes' || formData.mechanicalService === 'oilfilter') {
          noteDiv.textContent = 'Ø¥Ø°Ø§ Ø§Ù„Ù‚Ø·Ø¹ Ù…Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„';
          noteDiv.classList.remove('hidden');
        } else {
          noteDiv.classList.add('hidden');
        }
      }
      
      document.getElementById('mechResultSection').classList.remove('hidden');
    }

    function calculateFluidPrice() {
      if (!formData.area) return;

      const rows = sheetsData['Ø®Ø¯Ù…Ø§Øª5'];
      if (!rows) return;

      const columns = [0, 1, 2, 4, 5, 6];
      let basePrice = 0;
      let cancellation = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        if (row[columns[0]] === formData.area) {
          basePrice = parseFloat(row[columns[1]]) || 0;
          cancellation = row[columns[2]] ? `${parseFloat(row[columns[2]]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        } else if (row[columns[3]] === formData.area) {
          basePrice = parseFloat(row[columns[4]]) || 0;
          cancellation = row[columns[5]] ? `${parseFloat(row[columns[5]]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        }
      }

      // Determine service name and type
      let serviceName = '';
      let typeFilter = '';
      if (formData.mechanicalService === 'coolant') {
        serviceName = 'Ù…Ø§ÙŠ Ø±Ø§Ø¯ÙŠØªØ±';
        typeFilter = 'COOLANT';
      } else if (formData.mechanicalService === 'brakefluid') {
        serviceName = 'Ø²ÙŠØª Ø¨Ø±ÙŠÙƒ';
        typeFilter = 'BREAK LIQUIDO';
      } else if (formData.mechanicalService === 'transmission') {
        serviceName = 'Ø²ÙŠØª Ø³ÙƒØ§Ù†';
        typeFilter = 'TRANSMISIONES';
      }

      const tbody = document.getElementById('mechResultBody');
      const noteDiv = document.getElementById('mechNote');
      const resultSection = document.getElementById('mechResultSection');

      // Load brands from 'others' sheet - retry if not loaded
      let brands = [];
      const othersRows = sheetsData['others'];
      
      if (!othersRows) {
        // If data not loaded, retry in a moment
        setTimeout(() => {
          calculateFluidPrice();
        }, 500);
        return;
      }
      
      if (othersRows) {
        for (let i = 1; i < othersRows.length; i++) { // start from 1 to skip header
          const row = othersRows[i];
          if (row[1] === typeFilter) { // column B is type
            let country = row[2] || ''; // column C
            if (country === 'Spain') country = 'Ø¥Ø³Ø¨Ø§Ù†ÙŠØ§';
            else if (country === 'Britain') country = 'Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠØ§';
            else if (country === 'Cepsa') country = 'Ø³ÙŠØ³Ø¨Ø§';
            else if (country === 'dukhum') country = 'Ø¯Ø§ÙƒÙ‡Ø§Ù…';
            const brand = row[0] || ''; // column A
            const price = parseFloat(row[3]) || 0; // column D
            if (brand && !isNaN(price)) {
              brands.push({ brand, country, price });
            }
          }
        }
      }

      // Build table rows - only details, no headers
      let tableHtml = '';
      
      if (brands.length > 0) {
        brands.forEach(b => {
          const total = basePrice + b.price;
          tableHtml += `
            <tr>
              <td>${b.brand} (${b.price.toFixed(2)} ${config.currency}) - Ø±Ø³ÙˆÙ… Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ¹Ø¨Ø¦Ù‡: ${basePrice.toFixed(2)} ${config.currency}</td>
              <td class="highlight">${total.toFixed(2)} ${config.currency}</td>
            </tr>
          `;
        });
        
        // Add cancellation fee once at the bottom
        tableHtml += `
          <tr style="border-top: 1px solid #333; padding-top: 8px; margin-top: 8px;">
            <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
            <td>${cancellation}</td>
          </tr>
        `;
      } else {
        // If no brands, just show service price
        tableHtml = `
          <tr>
            <td>Ø±Ø³ÙˆÙ… Ø®Ø¯Ù…Ø© ØªØ¹Ø¨Ø¦Ù‡ ${serviceName}</td>
            <td class="highlight">${basePrice.toFixed(2)} ${config.currency}</td>
          </tr>
          <tr>
            <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
            <td>${cancellation}</td>
          </tr>
        `;
      }

      tbody.innerHTML = tableHtml;

      // Auto-expand the result container when there are multiple brands
      if (brands.length > 1) {
        resultSection.style.maxHeight = 'none';
        resultSection.style.overflow = 'visible';
        const tableScroll = resultSection.querySelector('.table-scroll');
        if (tableScroll) {
          tableScroll.style.maxHeight = 'none';
          tableScroll.style.overflow = 'visible';
        }
      } else {
        // Reset to normal for single brand or no brands
        resultSection.style.maxHeight = '350px';
        resultSection.style.overflow = 'hidden';
        const tableScroll = resultSection.querySelector('.table-scroll');
        if (tableScroll) {
          tableScroll.style.maxHeight = '300px';
          tableScroll.style.overflowY = 'auto';
        }
      }

      // Add note for coolant
      if (formData.mechanicalService === 'coolant') {
        noteDiv.innerHTML = `
          <div style="line-height: 1.6;">
            Ù¡- Ù„Ø§Ø²Ù… ØªØ³Ø§Ù„ÙˆÙ† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ùˆ Ø§Ù„Ø³ÙŠØ§Ø±Ù‡ ÙÙŠÙ‡Ø§ Ø­Ø±Ø§Ø±Ù‡ ÙˆÙ„Ùˆ Ø§Ø±ØªÙØ¹Øª Ø§Ù„Ø­Ø±Ø§Ø±Ù‡ Ø¨Ø¹Ø¯ Ù…Ø§ Ø¹Ø¨ÙŠÙ†Ø§ Ù„Ø§Ø²Ù… ØªÙˆØ¯ÙŠÙ‡Ø§ ÙƒØ±Ø§Ø¬ ÙˆÙŠØ´ÙŠÙƒ Ø¹Ù„Ù‰ Ø§Ù„ØªØ³Ø±ÙŠØ¨ Ù„Ù†Ù‡ Ù…Ø§ Ø¹Ù†Ø¯Ù†Ø§ Ø®Ø¯Ù…Ù‡ ØªØµÙ„ÙŠØ­ Ø§Ùˆ ÙØ­Øµ ØªØ³Ø±ÙŠØ¨<br>
            Ù¢-Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø­Ø§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø·Ù„Ø¨ ØªØ¹Ø¨Ø¦Ù‡ Ù…Ø§ÙŠ Ø±Ø§Ø¯ÙŠØªØ± Ùˆ(Ù„ÙŠØ³ ØªØ¨Ø¯ÙŠÙ„) Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ ÙŠØ®ØªÙ„Ù Ø³Ø¹Ø±Ù‡ Ø¹Ù† Ø§Ù„ØªØ¹Ø¨Ø¦Ù‡ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ø¯Ø§Ø±Ù‡
          </div>
        `;
        noteDiv.classList.remove('hidden');
      } else {
        noteDiv.classList.add('hidden');
      }

      resultSection.classList.remove('hidden');
    }

    // Calculate Wipers (ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª)
    function calculateWipersPrice() {
      if (!formData.area) return;

      const rows = sheetsData['Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©2'];
      if (!rows) return;

      const columns = [8, 9, 10, 12, 13, 14]; // I,J,K and M,N,O

      let servicePrice = 0;
      let cancellation = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        if (row[columns[0]] === formData.area) {
          servicePrice = parseFloat(row[columns[1]]) || 0;
          cancellation = row[columns[2]] ? `${parseFloat(row[columns[2]]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        } else if (row[columns[3]] === formData.area) {
          servicePrice = parseFloat(row[columns[4]]) || 0;
          cancellation = row[columns[5]] ? `${parseFloat(row[columns[5]]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        }
      }

      const tbody = document.getElementById('mechResultBody');
      tbody.innerHTML = `
        <tr>
          <td>Ø±Ø³ÙˆÙ… Ø®Ø¯Ù…Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª</td>
          <td class="highlight">${servicePrice.toFixed(2)} ${config.currency}</td>
        </tr>
        <tr>
          <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
          <td>${cancellation}</td>
        </tr>
      `;

      const noteDiv = document.getElementById('mechNote');
      if (noteDiv) noteDiv.classList.add('hidden');

      document.getElementById('mechResultSection').classList.remove('hidden');
    }

    // Load and render mechanical appointments from external Google Sheet (Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠÙ‡)
    async function loadMechanicalAppointmentsData() {
      try {
        const sheetId = '1CPGWPsJ3lFdYkV2DMWmJef5yw7QBimoTruBw-ef1Dq4';
        const sheetName = 'Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠÙ‡';
        const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;
        const res = await fetch(csvUrl);
        if (!res.ok) throw new Error('failed');
        const text = await res.text();
        const rows = parseCSV(text);
        // store temporarily
        window._mechAppointmentsRaw = rows;
        window._mechAppointmentsHeader = rows[0] || [];
        // DEBUG: Print header row to verify exact column names
        console.log('=== MECHANICAL APPOINTMENTS HEADER ===');
        console.log('Header Row:', window._mechAppointmentsHeader);
        window._mechAppointmentsHeader.forEach((col, idx) => {
          console.log(`Column ${idx} (${String.fromCharCode(65 + idx)}): "${col}"`);
        });
        console.log('=====================================');
        return rows;
      } catch (err) {
        console.error('Could not load mechanical appointments', err);
        return null;
      }
    }

    // Helper function to get local date in YYYY-MM-DD format (without UTC offset)
    function getLocalDateString(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    function parseCellDate(cell) {
      if (!cell) return null;
      
      // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¨ØµÙŠØºØ© YYYY-MM-DD Ø¨Ø§Ù„ÙØ¹Ù„
      if (typeof cell === 'string' && /^\d{4}-\d{2}-\d{2}$/.test(cell)) {
        return cell;
      }
      
      // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®
      const d = new Date(cell);
      if (!isNaN(d.getTime())) {
        // Use local date instead of UTC (toISOString)
        return getLocalDateString(d);
      }
      
      return null;
    }

    async function renderMechanicalAppointments() {
      const section = document.getElementById('mechAppointmentsSection');
      const dateInput = document.getElementById('mechApptDate');
      const techFilter = document.getElementById('mechTechnicianFilter');
      const tableBody = document.querySelector('#mechAppointmentsTable tbody');

      // default date = today (using local date, not UTC)
      if (!dateInput.value) {
        const today = new Date();
        dateInput.value = getLocalDateString(today);
      }

      // load data
      let rows = window._mechAppointmentsRaw || await loadMechanicalAppointmentsData();
      if (!rows) {
        section.classList.remove('hidden');
        tableBody.innerHTML = '<tr><td colspan="6">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</td></tr>';
        return;
      }

      // rows: include header row; data starts from row index 1 (second row)
      let dataRows = rows.slice(1);

      const populateTechnicians = () => {
        const techs = new Set();
        dataRows.forEach(r => { if (r[6]) techs.add(r[6]); });
        const current = techFilter.value;
        techFilter.innerHTML = '<option value="">Ø§Ù„ÙƒÙ„</option>' + Array.from(techs).map(t => `<option value="${t}">${t}</option>`).join('');
        if (current && techs.has(current)) techFilter.value = current;
      };
      populateTechnicians();

      function filterAndRender() {
        const selectedDate = dateInput.value;
        const selectedTech = techFilter.value;
        const filtered = dataRows.filter(r => {
          // Check if row has data (not empty)
          if (!r[0] && !r[1] && !r[2]) return false;
          
          const dateCell = parseCellDate(r[0]); // column A -> index 0 (Ø§Ù„ØªØ§Ø±ÙŠØ®)
          // If date parsing fails but row has data, still include it
          if (!dateCell && r[0]) {
            // If manually entered, try to compare as string
            if ((r[0] || '').trim() !== selectedDate) return false;
          } else if (dateCell && dateCell !== selectedDate) {
            return false;
          }
          
          if (selectedTech && (r[6] || '') !== selectedTech) return false;
          return true;
        });

        if (filtered.length === 0) {
          tableBody.innerHTML = '<tr><td colspan="7">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®</td></tr>';
        } else {
          tableBody.innerHTML = filtered.map(r => `
            <tr>
              <td>${r[0] || '-'}</td>
              <td>${r[1] || '-'}</td>
              <td>${r[2] || '-'}</td>
              <td>${r[3] || '-'}</td>
              <td>${r[4] || '-'}</td>
              <td>${r[5] || '-'}</td>
              <td>${r[6] || '-'}</td>
            </tr>
          `).join('');
        }
      }

      // attach handlers
      dateInput.onchange = filterAndRender;
      techFilter.onchange = filterAndRender;

      document.getElementById('mechRegisterBtn').onclick = () => {
        openMechanicalModal();
      };

      document.getElementById('mechEditBtn').onclick = () => {
        window.open('https://docs.google.com/spreadsheets/d/1CPGWPsJ3lFdYkV2DMWmJef5yw7QBimoTruBw-ef1Dq4/edit?usp=sharing', '_blank');
      };

      const scheduleAutoRefresh = () => {
        if (window._mechAutoRefreshTimer) clearInterval(window._mechAutoRefreshTimer);
        window._mechAutoRefreshTimer = setInterval(async () => {
          const updatedRows = await loadMechanicalAppointmentsData();
          if (!updatedRows) return;
          rows = updatedRows;
          dataRows = rows.slice(1);
          populateTechnicians();
          filterAndRender();
        }, 60000);
      };

      section.classList.remove('hidden');
      filterAndRender();
      scheduleAutoRefresh();
    }

    function calculateAlternatorPrice() {
      if (!formData.area || !formData.supplierPrice) return;
      
      const rows = sheetsData['Ø®Ø¯Ù…Ø§Øª Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©2'];
      if (!rows) return;
      
      const columns = [0, 1, 2, 4, 5, 6]; // Columns A, B, C and E, F, G
      
      let servicePrice = 0;
      let cancellation = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        if (row[columns[0]] === formData.area) {
          servicePrice = parseFloat(row[columns[1]]) || 0;
          cancellation = row[columns[2]] ? `${parseFloat(row[columns[2]]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        } else if (row[columns[3]] === formData.area) {
          servicePrice = parseFloat(row[columns[4]]) || 0;
          cancellation = row[columns[5]] ? `${parseFloat(row[columns[5]]).toFixed(2)} ${config.currency}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          break;
        }
      }
      
      // Supplier price + 20 dinars = part price
      const partPrice = formData.supplierPrice + 20;
      const total = servicePrice + partPrice;
      
      const tbody = document.getElementById('mechResultBody');
      
      tbody.innerHTML = `
        <tr>
          <td>Ø³Ø¹Ø± Ø§Ù„Ø®Ø¯Ù…Ø©</td>
          <td class="highlight">${servicePrice.toFixed(2)} ${config.currency}</td>
        </tr>
        <tr>
          <td>Ø³Ø¹Ø± Ø§Ù„Ù‚Ø·Ø¹Ø© (Ø§Ù„Ù…ÙˆØ±Ø¯ + 20 Ø¯.Ùƒ)</td>
          <td class="highlight">${partPrice.toFixed(2)} ${config.currency}</td>
        </tr>
        <tr style="background: #262626;">
          <td><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</strong></td>
          <td class="highlight"><strong>${total.toFixed(2)} ${config.currency}</strong></td>
        </tr>
        <tr>
          <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
          <td>${cancellation}</td>
        </tr>
      `;
      
      const noteDiv = document.getElementById('mechNote');
      if (noteDiv) noteDiv.classList.add('hidden');

      document.getElementById('mechResultSection').classList.remove('hidden');
    }

    // Render Car Wash Interface
    function renderCarWashInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section">
          <h3 class="section-title">Ù†ÙˆØ¹ Ø§Ù„ØºØ³ÙŠÙ„</h3>
          <div class="btn-grid" style="grid-template-columns: repeat(4, 1fr);">
            <button class="btn-option" data-wash="premium">ØºØ³ÙŠÙ„ Ù…Ù…ØªØ§Ø²</button>
            <button class="btn-option" data-wash="special">ØºØ³ÙŠÙ„ Ø®ØµÙˆØµÙŠ</button>
            <button class="btn-option" data-wash="ultra">ØºØ³ÙŠÙ„ Ø£Ù„ØªØ±Ø§</button>
            <button class="btn-option" data-wash="all">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
          </div>
        </div>
        
        <div id="washCardsSection" class="form-section full-width hidden">
          <h3 class="section-title" style="margin-bottom: 10px;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</h3>
          <div class="wash-cards-grid" id="washCardsGrid">
          </div>
        </div>
        
        <div id="appointmentSection" class="form-section full-width">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¹Ø¯</h3>
          <div class="form-field">
            <label>ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ù…ÙˆØ¹Ø¯</label>
            <input type="datetime-local" id="appointmentDateTime" class="form-control datetime-control" style="max-width: 280px;">
          </div>
          <div style="display:flex;gap:8px;">
            <button id="bookAppointmentBtn" class="btn-primary">ğŸ“… Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ¹Ø¯</button>
          </div>
          <div id="availableSlots" style="margin-top: 12px;"></div>
        </div>
      `;
      
      const bookBtn = document.getElementById('bookAppointmentBtn');
      if (bookBtn) {
        bookBtn.onclick = () => openCarWashModal();
      }

      // Edit Appointment button (restore functionality)
      const editBtn = document.createElement('button');
      editBtn.id = 'editAppointmentBtn';
      editBtn.className = 'btn-primary';
      editBtn.style.marginLeft = '8px';
      editBtn.style.minWidth = '140px';
      editBtn.textContent = 'âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¹Ø¯';
      editBtn.onclick = () => {
        const sheetId = '1FkWKRxRFC8UG1Ez2VzYHadHju2HARBLbdTIsr57hKXc';
        const sheetName = 'WASH Sheet';
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/edit#gid=0`; 
        window.open(url, '_blank');
      };
      // insert edit button next to book button
      if (bookBtn && bookBtn.parentNode) {
        bookBtn.className = 'btn-primary';
        bookBtn.style.minWidth = '140px';
        bookBtn.parentNode.insertBefore(editBtn, bookBtn.nextSibling);
      }

      // initialize appointment date and load slots immediately (no need to click a wash)
      (function initAppointments() {
        const appointmentDateTime = document.getElementById('appointmentDateTime');
        if (!appointmentDateTime) return;
        prepareDateTimeInput(appointmentDateTime);
        const dateOnly = (appointmentDateTime.value || '').split('T')[0] || getLocalDateString(new Date());
        loadCarWashAppointments(dateOnly);
        appointmentDateTime.onchange = () => {
          const selectedDate = (appointmentDateTime.value || '').split('T')[0];
          if (selectedDate) loadCarWashAppointments(selectedDate);
        };
      })();

      document.querySelectorAll('[data-wash]').forEach(btn => {
        btn.onclick = () => {
          document.querySelectorAll('[data-wash]').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          const washType = btn.dataset.wash;
          handleWashTypeSelection(washType);
        };
      });

      // show all wash types by default (populate the table/cards)
      try { handleWashTypeSelection('all'); } catch (e) {}
    }

    function handleWashTypeSelection(quality) {
      const washCardsSection = document.getElementById('washCardsSection');
      const washCardsGrid = document.getElementById('washCardsGrid');
      
      if (!quality) {
        washCardsSection.classList.add('hidden');
        // keep appointmentSection visible even if no wash selected
        return;
      }
      
      washCardsGrid.innerHTML = '';
      
      const washDetails = {
        premium: {
          name: 'â­ ØºØ³ÙŠÙ„ Ù…Ù…ØªØ§Ø²',
          duration: '1 Ø³Ø§Ø¹Ø©',
          priceSedan: 7,
          priceSUV: 8,
          services: ['ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ', 'ØªÙ†Ø¸ÙŠÙ Ø¯Ø§Ø®Ù„ÙŠ', 'ØªÙ„Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§ÙŠØ± ÙˆØ§Ù„Ø±Ù†Ù‚Ø§Øª', 'ØªÙ†Ø¸ÙŠÙ ÙØªØ­Ø§Øª Ø§Ù„ØªÙƒÙŠÙŠÙ', 'Ø¹Ø·Ø±']
        },
        special: {
          name: 'ğŸ’ ØºØ³ÙŠÙ„ Ø®ØµÙˆØµÙŠ',
          duration: 'Ø³Ø§Ø¹ØªÙŠÙ†',
          priceSedan: 15,
          priceSUV: 17,
          services: ['ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ', 'ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', 'ØªÙ„Ù…ÙŠØ¹ Ø¯ÙŠÙƒÙˆØ±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©', 'Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ù‚Ø¹ Ø§Ù„Ø®ÙÙŠÙØ©', 'ØªÙ„Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§ÙŠØ± ÙˆØ§Ù„Ø±Ù†Ù‚Ø§Øª', 'ØªÙ†Ø¸ÙŠÙ ÙØªØ­Ø§Øª Ø§Ù„ØªÙƒÙŠÙŠÙ', 'Ø¹Ø·Ø±']
        },
        ultra: {
          name: 'ğŸ‘‘ ØºØ³ÙŠÙ„ Ø£Ù„ØªØ±Ø§',
          duration: '3 Ø³Ø§Ø¹Ø§Øª',
          priceSedan: 30,
          priceSUV: 35,
          services: ['ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ', 'Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', 'ØªÙ„Ù…ÙŠØ¹ Ø¯ÙŠÙƒÙˆØ±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©', 'ØºØ³ÙŠÙ„ Ù…Ù‚Ø§Ø¹Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨', 'ØºØ³ÙŠÙ„ Ø¯Ø¨Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'ØªÙ†Ø¸ÙŠÙ Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©']
        }
      };
      
      const washTypes = quality === 'all' ? ['premium', 'special', 'ultra'] : [quality];
      
      washTypes.forEach(type => {
        const wash = washDetails[type];
        washCardsGrid.innerHTML += `
          <div class="wash-card-compact">
            <h3>${wash.name}</h3>
            <div class="price">ØµØ§Ù„ÙˆÙ†: ${wash.priceSedan} Ø¯.Ùƒ | Ø¬ÙŠØ¨: ${wash.priceSUV} Ø¯.Ùƒ</div>
            <div style="font-size: 11px; color: #10b981; margin-bottom: 6px;">â± ${wash.duration}</div>
            <ul>
              ${wash.services.map(s => `<li>${s}</li>`).join('')}
            </ul>
            <button class="copy-btn-small" onclick="copyWashDetails('${type}')">ğŸ“‹ Ù†Ø³Ø®</button>
          </div>
        `;
      });
      
      formData.selectedWashes = washTypes;
      washCardsSection.classList.remove('hidden');
      
      document.getElementById('appointmentSection').classList.remove('hidden');
      
      const appointmentDateTime = document.getElementById('appointmentDateTime');
      if (appointmentDateTime) {
        prepareDateTimeInput(appointmentDateTime);
        const selectedDate = (appointmentDateTime.value || '').split('T')[0];
        const fallbackDate = getLocalDateString(new Date());
        loadCarWashAppointments(selectedDate || fallbackDate);
        appointmentDateTime.onchange = () => {
          const dateOnly = (appointmentDateTime.value || '').split('T')[0];
          if (dateOnly) loadCarWashAppointments(dateOnly);
        };
      }
    }

    window.copyWashDetails = async function(type) {
      const washDetails = {
        premium: {
          name: 'ØºØ³ÙŠÙ„ Ù…Ù…ØªØ§Ø²',
          duration: 'Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©',
          priceSedan: 7,
          priceSUV: 8,
          services: ['ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ', 'ØªÙ†Ø¸ÙŠÙ Ø¯Ø§Ø®Ù„ÙŠ', 'ØªÙ„Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§ÙŠØ± ÙˆØ§Ù„Ø±Ù†Ù‚Ø§Øª', 'ØªÙ†Ø¸ÙŠÙ ÙØªØ­Ø§Øª Ø§Ù„ØªÙƒÙŠÙŠÙ', 'Ø¹Ø·Ø±']
        },
        special: {
          name: 'ØºØ³ÙŠÙ„ Ø®ØµÙˆØµÙŠ',
          duration: 'Ø³Ø§Ø¹ØªÙŠÙ†',
          priceSedan: 15,
          priceSUV: 17,
          services: ['ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ', 'ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', 'ØªÙ„Ù…ÙŠØ¹ Ø¯ÙŠÙƒÙˆØ±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©', 'Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ù‚Ø¹ Ø§Ù„Ø®ÙÙŠÙØ©', 'ØªÙ„Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§ÙŠØ± ÙˆØ§Ù„Ø±Ù†Ù‚Ø§Øª', 'ØªÙ†Ø¸ÙŠÙ ÙØªØ­Ø§Øª Ø§Ù„ØªÙƒÙŠÙŠÙ', 'Ø¹Ø·Ø±']
        },
        ultra: {
          name: 'ØºØ³ÙŠÙ„ Ø£Ù„ØªØ±Ø§',
          duration: '3 Ø³Ø§Ø¹Ø§Øª',
          priceSedan: 30,
          priceSUV: 35,
          services: ['ØºØ³ÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ', 'Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ', 'ØªÙ„Ù…ÙŠØ¹ Ø¯ÙŠÙƒÙˆØ±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©', 'ØºØ³ÙŠÙ„ Ù…Ù‚Ø§Ø¹Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨', 'ØºØ³ÙŠÙ„ Ø¯Ø¨Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©', 'ØªÙ†Ø¸ÙŠÙ Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©']
        }
      };
      
      const wash = washDetails[type];
      const text = `
${wash.name}
Ù…Ø¯Ø© Ø§Ù„ØºØ³ÙŠÙ„: ${wash.duration}

Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:
â€¢ ØµØ§Ù„ÙˆÙ†: ${wash.priceSedan} Ø¯.Ùƒ
â€¢ Ø¬ÙŠØ¨: ${wash.priceSUV} Ø¯.Ùƒ

Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø´Ù…ÙˆÙ„Ø©:
${wash.services.map(s => `â€¢ ${s}`).join('\n')}
      `.trim();
      
      try {
        await navigator.clipboard.writeText(text);
        
        const buttons = document.querySelectorAll('.copy-btn-small');
        buttons.forEach(btn => {
          if (btn.onclick && btn.onclick.toString().includes(type)) {
            btn.classList.add('success');
            btn.textContent = 'âœ“ ØªÙ… Ø§Ù„Ù†Ø³Ø®!';
            
            setTimeout(() => {
              btn.classList.remove('success');
              btn.textContent = 'ğŸ“‹ Ù†Ø³Ø®';
            }, 2000);
          }
        });
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    };

    async function loadCarWashAppointments(selectedDate) {
      try {
        const sheetId = '1FkWKRxRFC8UG1Ez2VzYHadHju2HARBLbdTIsr57hKXc';
        const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=WASH%20Sheet`;
        
        const response = await fetch(csvUrl, {
          mode: 'cors',
          credentials: 'omit'
        });
        if (!response.ok) throw new Error('Failed to load');
        
        const csvText = await response.text();
        const rows = parseCSV(csvText);
        
        carWashData = [];

        // Detect header indices so renamed columns (Arabic/English) still map correctly.
        const headerRow = rows[0] || [];
        const headers = headerRow.map(h => (h || '').toString().toLowerCase());

        // Prefer exact column headers (Arabic) if provided by user A..I, otherwise fallback to keyword search
        const headerMap = {};
        headers.forEach((h, i) => headerMap[h.trim()] = i);

        function findHeader(...candidates) {
          for (const c of candidates) {
            const key = c.toString().toLowerCase().trim();
            // exact match
            for (const hh in headerMap) {
              if (hh.toLowerCase().trim() === key) return headerMap[hh];
            }
            // substring match
            for (const hh in headerMap) {
              if (hh.toLowerCase().includes(key)) return headerMap[hh];
            }
          }
          return -1;
        }

        const idx = {
          timestamp: findHeader('timestamp', 'time stamp', 'timestamp', 'ØªÙˆÙ‚ÙŠØª'),
          date: findHeader('ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¹Ø¯', 'ØªØ§Ø±ÙŠØ® ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨', 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨', 'date', 'ØªØ§Ø±ÙŠØ®', 'Ø§Ù„ØªØ§Ø±ÙŠØ®'),
          time: findHeader('ÙˆÙ‚Øª Ø§Ù„Ù…ÙˆØ¹Ø¯', 'Ø§Ù„ÙˆÙ‚Øª', 'time'),
          qrOrder: findHeader('Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨', 'qr order', 'qr'),
          location: findHeader('Ø§Ù„Ù…Ù†Ø·Ù‚Ø©', 'Ø§Ù„Ù…Ù†Ø·Ù‚Ù‡', 'Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„', 'location', 'Ù…ÙˆÙ‚Ø¹'),
          customerName: findHeader('Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„', 'customer name', 'customer'),
          customerNumber: findHeader('Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„', 'customer number', 'phone', 'Ø±Ù‚Ù…'),
          washType: findHeader('Ù†ÙˆØ¹ Ø§Ù„ØºØ³ÙŠÙ„', 'wash type', 'Ù†ÙˆØ¹'),
          payment: findHeader('Ø­Ø§Ù„Ù‡ Ø§Ù„Ø¯ÙØ¹', 'Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹', 'payment', 'Ù†Ø¹Ù…', 'Ù„Ø§')
        };

        // If the detected date header is actually the "order timestamp" (ØªØ§Ø±ÙŠØ® ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨) or timestamp, prefer an appointment-date header if present,
        // otherwise fall back to column B (index 1).
        if (idx.date >= 0) {
          const detectedHeader = (headerRow[idx.date] || '').toString().toLowerCase();
          if (detectedHeader.includes('ØªØ§Ø±ÙŠØ® ØªØ³Ø¬ÙŠÙ„') || detectedHeader.includes('timestamp') || detectedHeader.includes('ØªÙˆÙ‚ÙŠØª')) {
            const alt = findHeader('ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¹Ø¯', 'appointment date', 'appointment', 'Ù…ÙˆØ¹Ø¯');
            if (alt >= 0) {
              idx.date = alt;
            } else {
              idx.date = -1; // force fallback to default below (column B)
            }
          }
        }

        // Fallback to legacy indices if detection failed
        const col = {
          // Use correct columns: A=date, B=time, C=order, D=customer, E=location, F=washType, G=payment
          date: idx.date >= 0 ? idx.date : 0,
          time: idx.time >= 0 ? idx.time : 1,
          qrOrder: idx.qrOrder >= 0 ? idx.qrOrder : 2,
          customerName: idx.customerName >= 0 ? idx.customerName : 3,
          location: idx.location >= 0 ? idx.location : 4,
          washType: idx.washType >= 0 ? idx.washType : 5,
          payment: idx.payment >= 0 ? idx.payment : 6,
          customerNumber: idx.customerNumber >= 0 ? idx.customerNumber : 7
        };

        for (let i = 1; i < rows.length; i++) {
          const row = rows[i];
          if (row[col.date] && row[col.time]) {
            let parsedDate = (row[col.date] || '').toString().trim();
            const dateObj = new Date(parsedDate);
            if (!isNaN(dateObj.getTime())) {
              const year = dateObj.getFullYear();
              const month = String(dateObj.getMonth() + 1).padStart(2, '0');
              const day = String(dateObj.getDate()).padStart(2, '0');
              parsedDate = `${year}-${month}-${day}`;
            }

            // helper: parse time like "10:00:00 PM", "10:00 PM", "22:00", or with seconds
            function parseTimeString(s) {
              s = (s || '').toString().trim();
              if (!s) return '';
              // capture hh:mm (ignore seconds)
              const m = s.match(/(\d{1,2}):(\d{2})/);
              if (m) {
                let hh = parseInt(m[1], 10);
                const mm = parseInt(m[2], 10);
                // detect AM/PM (including Arabic Ù…/Øµ or words)
                const isPM = /\bpm\b|Ù…(?![a-z])|Ù…Ø³Ø§Ø¡/i.test(s);
                const isAM = /\bam\b|Øµ(?![a-z])|ØµØ¨Ø§Ø­/i.test(s);
                if (isPM && hh !== 12) hh += 12;
                if (isAM && hh === 12) hh = 0;
                return `${hh}:${String(mm).padStart(2, '0')}`;
              }
              // fallback: try to parse as Date
              const d = new Date('1970-01-01T' + s);
              if (!isNaN(d.getTime())) return `${d.getHours()}:${String(d.getMinutes()).padStart(2, '0')}`;
              return s;
            }

            // helper: normalize phone (preserve as string, trim)
            function normalizePhone(p) {
              return (p || '').toString().trim();
            }

            // helper: normalize payment to Arabic Ù†Ø¹Ù…/Ù„Ø§
            function normalizePayment(p) {
              const v = (p || '').toString().toLowerCase();
              if (!v) return '';
              if (v.includes('Ù†Ø¹Ù…') || v.includes('yes') || v === 'y' || v.includes('paid') || v === 'true') return 'Ù†Ø¹Ù…';
              if (v.includes('Ù„Ø§') || v.includes('no') || v === 'n' || v === 'false') return 'Ù„Ø§';
              return p;
            }

            const formattedTime = parseTimeString(row[col.time]);
            const phoneVal = normalizePhone(row[col.customerNumber]);
            const paymentVal = normalizePayment(row[col.payment]);

            carWashData.push({
              date: parsedDate,
              time: formattedTime,
              qrOrder: (row[col.qrOrder] || '').toString().trim(),
              customerName: (row[col.customerName] || '').toString().trim(),
              phone: phoneVal,
              location: (row[col.location] || '').toString().trim(),
              washType: (row[col.washType] || '').toString().trim(),
              payment: paymentVal
            });
          }
        }
        
        calculateAvailableSlots(selectedDate);
        return carWashData;
        
      } catch (error) {
        document.getElementById('availableSlots').innerHTML = `
          <div class="error-box">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯. ØªØ£ÙƒØ¯ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø´ÙŠØª</div>
        `;
      }
    }

    function calculateAvailableSlots(selectedDate) {
      const availableSlots = document.getElementById('availableSlots');
      
      const dateObj = new Date(selectedDate + 'T00:00:00');
      const dayOfWeek = dateObj.toLocaleDateString('ar-EG', { weekday: 'long' });
      const formattedDate = dateObj.toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' });
      
      const dayIndex = dateObj.getDay();
      const startOfYear = new Date(dateObj.getFullYear(), 0, 1);
      const days = Math.floor((dateObj - startOfYear) / (24 * 60 * 60 * 1000));
      const weekNumber = Math.ceil((days + startOfYear.getDay() + 1) / 7);
      
      if (dayIndex === 5 && weekNumber % 2 === 1) {
        availableSlots.innerHTML = `
          <div class="error-box">
            <strong>âŒ Ù…ØºÙ„Ù‚ ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©</strong><br>
            Ø£Ù‚Ø±Ø¨ Ù…ÙˆØ¹Ø¯ Ù…ØªØ§Ø­: ÙŠÙˆÙ… Ø§Ù„Ø³Ø¨Øª
          </div>
        `;
        return;
      }
      
      const todayAppointments = carWashData.filter(apt => apt.date === selectedDate);
      todayAppointments.sort((a, b) => {
        const timeA = a.time.split(':').map(Number);
        const timeB = b.time.split(':').map(Number);
        return (timeA[0] * 60 + timeA[1]) - (timeB[0] * 60 + timeB[1]);
      });
      
      let html = `
        <div style="background: #1a1a1a; border: 1px solid #F2BC1B; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
          <div style="font-size: 13px; font-weight: 700; color: #F2BC1B;">${dayOfWeek}</div>
          <div style="font-size: 12px; color: #999;">${formattedDate}</div>
        </div>
      `;
      
      const workStartMinutes = 630; // 10:30 AM
      // Last allowed START time (Ø¢Ø®Ø± ÙˆØµÙˆÙ„) per wash type
      const washLastArrival = {
        premium: 20 * 60 + 30, // 20:30
        special: 19 * 60 + 30, // 19:30
        ultra: 18 * 60 + 30    // 18:30
      };
      const workEndMinutes = 1320;  // 10:00 PM (fallback, not used for per-wash limits)
      
      const today = new Date();
      const isToday = dateObj.getDate() === today.getDate() && 
                      dateObj.getMonth() === today.getMonth() && 
                      dateObj.getFullYear() === today.getFullYear();
      
      let earliestAvailableTime = workStartMinutes;
      
      if (isToday) {
        const currentMinutes = today.getHours() * 60 + today.getMinutes();
        const roundedMinutes = Math.ceil((currentMinutes + 30) / 5) * 5;
        earliestAvailableTime = Math.max(earliestAvailableTime, roundedMinutes);
      }
      
      // Build list of appointments with their actual times
      const appointments = [];
      todayAppointments.forEach(apt => {
        const timeParts = apt.time.split(':').map(Number);
        const appointmentMinutes = timeParts[0] * 60 + timeParts[1];
        
        let washDuration = 60;
        const washType = apt.washType.toLowerCase();
        if (washType.includes('Ø®ØµÙˆØµÙŠ')) washDuration = 120;
        else if (washType.includes('Ø§Ù„ØªØ±Ø§')) washDuration = 180;
        
        appointments.push({
          start: appointmentMinutes,
          duration: washDuration,
          end: appointmentMinutes + washDuration + 30
        });
      });
      
      // Sort appointments by start time
      appointments.sort((a, b) => a.start - b.start);
      
      const selectedWashes = formData.selectedWashes || [];
      const washDurations = {
        premium: 60,
        special: 120,
        ultra: 180
      };
      
      const travelTime = 30;
      
        // Find all available time slots for each wash type
      const availableTimeSlots = {};
      
      selectedWashes.forEach(washType => {
        const duration = washDurations[washType];
        const totalDuration = duration + travelTime;
        availableTimeSlots[washType] = [];
        
        // Calculate end limit for this wash type (latest allowed START time)
        const endLimit = washLastArrival[washType] || workEndMinutes;

        // Check before first appointment
        if (appointments.length > 0) {
          const firstAppointmentStart = appointments[0].start;
          const latestStartBeforeFirst = firstAppointmentStart - totalDuration;
          
          if (earliestAvailableTime <= latestStartBeforeFirst) {
            availableTimeSlots[washType].push({
              start: earliestAvailableTime,
              latestStart: latestStartBeforeFirst,
              end: firstAppointmentStart
            });
          }
        }
        
        // Check gaps between appointments
        for (let i = 0; i < appointments.length - 1; i++) {
          const currentAppointmentEnd = appointments[i].end;
          const nextAppointmentStart = appointments[i + 1].start;
          
          const earliestStartInGap = Math.max(currentAppointmentEnd, earliestAvailableTime);
          const latestStartInGap = nextAppointmentStart - totalDuration;
          
          if (earliestStartInGap <= latestStartInGap && earliestStartInGap + totalDuration <= nextAppointmentStart) {
            availableTimeSlots[washType].push({
              start: earliestStartInGap,
              latestStart: latestStartInGap,
              end: nextAppointmentStart
            });
          }
        }
        
        // Check after last appointment (ensure start is <= endLimit)
        if (appointments.length > 0) {
          const lastAppointmentEnd = appointments[appointments.length - 1].end;
          const earliestStartAfterLast = Math.max(lastAppointmentEnd, earliestAvailableTime);

          if (earliestStartAfterLast <= endLimit) {
            availableTimeSlots[washType].push({
              start: earliestStartAfterLast,
              latestStart: endLimit,
              end: endLimit
            });
          }
        } else {
          // No appointments at all
          if (earliestAvailableTime <= endLimit) {
            availableTimeSlots[washType].push({
              start: earliestAvailableTime,
              latestStart: endLimit,
              end: endLimit
            });
          }
        }
      });
      
      // Check if any wash type has available slots
      const hasAnyAvailable = Object.values(availableTimeSlots).some(slots => slots.length > 0);
      
      if (!hasAnyAvailable) {
        html += `
          <div class="warning-box">
            <strong>âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆÙ‚Øª ÙƒØ§ÙÙ Ù„Ø£ÙŠ Ù†ÙˆØ¹ ØºØ³ÙŠÙ„ Ù…Ø­Ø¯Ø¯ Ø§Ù„ÙŠÙˆÙ…</strong><br>
            Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ ØªÙ†ØªÙ‡ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© 10:00 Ù…Ø³Ø§Ø¡Ù‹
          </div>
        `;
        
        const tomorrow = new Date(dateObj);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const tomorrowDay = tomorrow.toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        
        html += `
          <div class="info-box" style="background: #1a4a2a; border-color: #10b981; margin-top: 10px;">
            <div style="font-size: 12px; font-weight: 700; color: #10b981; margin-bottom: 6px;">ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­: ${tomorrowDay}</div>
            <div style="font-size: 11px; color: #10b981; margin: 3px 0;">â­ ØºØ³ÙŠÙ„ Ù…Ù…ØªØ§Ø²: Ø§Ø¨ØªØ¯Ø§Ø¡Ù‹ Ù…Ù† 10:30 ØµØ¨Ø§Ø­Ø§Ù‹</div>
            <div style="font-size: 11px; color: #10b981; margin: 3px 0;">ğŸ’ ØºØ³ÙŠÙ„ Ø®ØµÙˆØµÙŠ: Ø§Ø¨ØªØ¯Ø§Ø¡Ù‹ Ù…Ù† 10:30 ØµØ¨Ø§Ø­Ø§Ù‹</div>
            <div style="font-size: 11px; color: #10b981; margin: 3px 0;">ğŸ‘‘ ØºØ³ÙŠÙ„ Ø£Ù„ØªØ±Ø§: Ø§Ø¨ØªØ¯Ø§Ø¡Ù‹ Ù…Ù† 10:30 ØµØ¨Ø§Ø­Ø§Ù‹</div>
          </div>
        `;
      } else {
        html += `
          <div class="info-box" style="background: #1a4a2a; border-color: #10b981;">
            <div style="font-size: 12px; font-weight: 700; color: #10b981; margin-bottom: 6px;">âœ“ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø©:</div>
        `;
        
        // Helper function to format time
        const formatTimeSimple = (minutes) => {
          const hours = Math.floor(minutes / 60);
          const mins = minutes % 60;
          const period = hours >= 12 ? 'Ù…Ø³Ø§Ø¡Ù‹' : 'ØµØ¨Ø§Ø­Ø§Ù‹';
          const displayHours = hours > 12 ? hours - 12 : (hours === 0 ? 12 : hours);
          
          if (mins === 0) {
            return `${displayHours} ${period}`;
          } else {
            return `${displayHours}:${mins.toString().padStart(2, '0')} ${period}`;
          }
        };
        
        // Helper to format time range - show actual available window (earliest start -> latest allowed start)
        const formatTimeRange = (slots, washDuration, washType) => {
          if (!slots || slots.length === 0) return '';

          let ranges = [];
          slots.forEach(slot => {
            const startTime = formatTimeSimple(slot.start);
            // show latest allowed START time (slot.latestStart) as the window end
            const endTime = formatTimeSimple(slot.latestStart);
            ranges.push(`Ù…Ù† ${startTime} Ø¥Ù„Ù‰ ${endTime}`);
          });

          return ranges.join(' â€¢ ÙˆØ£ÙŠØ¶Ø§Ù‹ ');
        };
        
        if (availableTimeSlots.premium && availableTimeSlots.premium.length > 0) {
          const timeRange = formatTimeRange(availableTimeSlots.premium, 60, 'premium');
          html += `<div style="font-size: 11px; color: #10b981; margin: 3px 0;">â­ ØºØ³ÙŠÙ„ Ù…Ù…ØªØ§Ø²: ${timeRange}</div>`;
        }

        if (availableTimeSlots.special && availableTimeSlots.special.length > 0) {
          const timeRange = formatTimeRange(availableTimeSlots.special, 120, 'special');
          html += `<div style="font-size: 11px; color: #10b981; margin: 3px 0;">ğŸ’ ØºØ³ÙŠÙ„ Ø®ØµÙˆØµÙŠ: ${timeRange}</div>`;
        }

        if (availableTimeSlots.ultra && availableTimeSlots.ultra.length > 0) {
          const timeRange = formatTimeRange(availableTimeSlots.ultra, 180, 'ultra');
          html += `<div style="font-size: 11px; color: #10b981; margin: 3px 0;">ğŸ‘‘ ØºØ³ÙŠÙ„ Ø£Ù„ØªØ±Ø§: ${timeRange}</div>`;
        }
        
        html += `</div>`;
        
        const unavailableTypes = [];
        if (selectedWashes.includes('premium') && availableTimeSlots.premium.length === 0) unavailableTypes.push('â­ ØºØ³ÙŠÙ„ Ù…Ù…ØªØ§Ø²');
        if (selectedWashes.includes('special') && availableTimeSlots.special.length === 0) unavailableTypes.push('ğŸ’ ØºØ³ÙŠÙ„ Ø®ØµÙˆØµÙŠ');
        if (selectedWashes.includes('ultra') && availableTimeSlots.ultra.length === 0) unavailableTypes.push('ğŸ‘‘ ØºØ³ÙŠÙ„ Ø£Ù„ØªØ±Ø§');
        
        if (unavailableTypes.length > 0) {
          html += `<div class="warning-box">
            <div style="font-size: 12px; font-weight: 700; color: #fbbf24; margin-bottom: 4px;">âš ï¸ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø§Ù„ÙŠÙˆÙ…:</div>`;
          
          unavailableTypes.forEach(type => {
            html += `<div style="font-size: 11px; color: #fbbf24; margin: 2px 0;">${type}</div>`;
          });
          
          html += `</div>`;
        }
      }
      
      if (todayAppointments.length > 0) {
        html += `<div style="margin-top: 12px; font-size: 12px; font-weight: 700; color: #F2BC1B; margin-bottom: 8px;">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©:</div>`;
        
        html += `
          <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 5px; overflow: hidden;">
            <div style="overflow-x: auto;">
              <table class="data-table">
                <thead>
                  <tr>
                    <th style="min-width: 80px;">Ø§Ù„ÙˆÙ‚Øª</th>
                    <th style="min-width: 100px;">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th style="min-width: 80px;">Ù†ÙˆØ¹ Ø§Ù„ØºØ³ÙŠÙ„</th>
                    <th style="min-width: 80px;">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                    <th style="min-width: 120px;">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                    <th style="min-width: 100px;">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
                    <th style="min-width: 120px;">Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                    <th style="min-width: 100px;">Ø§Ù„Ù…Ø¯Ø©</th>
                    <th style="min-width: 90px;">Ø§Ù„Ø¯ÙØ¹</th>
                  </tr>
                </thead>
                <tbody>
        `;
        
        todayAppointments.forEach((apt) => {
          const timeParts = apt.time.split(':').map(Number);
          const hours = timeParts[0];
          const minutes = timeParts[1];
          const period = hours >= 12 ? 'Ù…Ø³Ø§Ø¡Ù‹' : 'ØµØ¨Ø§Ø­Ø§Ù‹';
          const displayHours = hours > 12 ? hours - 12 : (hours === 0 ? 12 : hours);
          const displayTime = `${displayHours}:${minutes.toString().padStart(2, '0')} ${period}`;
          
          let washDuration = 60;
          const washType = apt.washType.toLowerCase();
          if (washType.includes('Ø®ØµÙˆØµÙŠ')) washDuration = 120;
          else if (washType.includes('Ø§Ù„ØªØ±Ø§')) washDuration = 180;
          
          const startMinutes = timeParts[0] * 60 + timeParts[1];
          const endMinutes = startMinutes + washDuration;
          const endHours = Math.floor(endMinutes / 60);
          const endMins = endMinutes % 60;
          const endPeriod = endHours >= 12 ? 'Ù…Ø³Ø§Ø¡Ù‹' : 'ØµØ¨Ø§Ø­Ø§Ù‹';
          const endDisplayHours = endHours > 12 ? endHours - 12 : (endHours === 0 ? 12 : endHours);
          const endDisplayTime = `${endDisplayHours}:${endMins.toString().padStart(2, '0')} ${endPeriod}`;
          
          let orderStatus = '';
          let statusColor = '';
          
          const selectedDate = (document.getElementById('appointmentDateTime')?.value || '').split('T')[0] || apt.date;
          const today = new Date();
          const todayStr = getLocalDateString(today);
          const isToday = selectedDate === todayStr;
          
          if (isToday) {
            const currentMinutes = today.getHours() * 60 + today.getMinutes();
            const minutesUntilStart = startMinutes - currentMinutes;
            const minutesSinceEnd = currentMinutes - endMinutes;
            
            if (minutesSinceEnd > 0) {
              orderStatus = 'âœ… ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡';
              statusColor = '#10b981';
            } else if (currentMinutes >= startMinutes && currentMinutes < endMinutes) {
              orderStatus = 'ğŸ”„ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°';
              statusColor = '#3b82f6';
            } else if (minutesUntilStart <= 30 && minutesUntilStart > 0) {
              orderStatus = 'ğŸš— Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚';
              statusColor = '#f59e0b';
            } else if (minutesUntilStart > 0) {
              orderStatus = 'ğŸ“… Ù…Ø­Ø¬ÙˆØ²';
              statusColor = '#3b82f6';
            } else {
              orderStatus = 'ğŸ“‹ Ù…Ø­Ø¬ÙˆØ²';
              statusColor = '#3b82f6';
            }
          } else {
            const selectedDateObj = new Date(selectedDate + 'T00:00:00');
            const todayDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            
            if (selectedDateObj < todayDate) {
              orderStatus = 'âœ… ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡';
              statusColor = '#10b981';
            } else {
              orderStatus = 'ğŸ“… Ù…Ø­Ø¬ÙˆØ²';
              statusColor = '#3b82f6';
            }
          }
          
          const paymentVal = (apt.payment || '').toString().toLowerCase();
          let paymentStatus = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          if (paymentVal.includes('Ù†Ø¹Ù…') || paymentVal.includes('yes') || paymentVal === 'y' || paymentVal === 'true') {
            paymentStatus = 'âœ… ØªÙ…';
          } else if (paymentVal.includes('Ù„Ø§') || paymentVal.includes('no') || paymentVal === 'n' || paymentVal === 'false') {
            paymentStatus = 'âŒ Ù„Ù… ÙŠØªÙ…';
          }
          
          html += `
            <tr>
              <td style="font-weight: 600; color: #F2BC1B;">${displayTime}</td>
              <td style="color: ${statusColor}; font-weight: 600;">${orderStatus}</td>
              <td>${apt.washType}</td>
              <td>${apt.qrOrder || '-'}</td>
              <td>${apt.customerName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
              <td style="direction: ltr; text-align: center;">${apt.phone || '-'}</td>
              <td>${apt.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
              <td style="font-size: 10px; color: #999;">${displayTime} - ${endDisplayTime}<br>(${washDuration} Ø¯Ù‚ÙŠÙ‚Ø©)</td>
              <td>${paymentStatus}</td>
            </tr>
          `;
        });
        
        html += `
                </tbody>
              </table>
            </div>
          </div>
        `;
      }
      
      availableSlots.innerHTML = html;
    }

    // Shared helpers for local booking (carwash/mechanical)
    const SHEETDB_URL = 'https://sheetdb.io/api/v1/wvoh60e0yhry4'; // Car Wash API
    const MECHANICAL_SHEETDB_URL = 'https://sheetdb.io/api/v1/jcvn1kw9zy7o7'; // Mechanical API

    function pickHeader(headerRow, candidates, fallback) {
      const headers = (headerRow || []).map(h => (h || '').toString().toLowerCase().trim());
      for (const c of candidates) {
        const key = (c || '').toString().toLowerCase().trim();
        const exactIdx = headers.findIndex(h => h === key);
        if (exactIdx >= 0) return headerRow[exactIdx];
        const partialIdx = headers.findIndex(h => h.includes(key));
        if (partialIdx >= 0) return headerRow[partialIdx];
      }
      return fallback;
    }

    function getRoundedNowIso() {
      const now = new Date();
      const minutes = now.getMinutes();
      const roundedMinutes = Math.ceil((minutes + 5) / 5) * 5;
      now.setMinutes(roundedMinutes);
      now.setSeconds(0);
      now.setMilliseconds(0);
      
      // Format as YYYY-MM-DDTHH:MM using local time
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes_str = String(now.getMinutes()).padStart(2, '0');
      return `${year}-${month}-${day}T${hours}:${minutes_str}`;
    }

    function blockManualInput(input) {
      if (!input) return;
      const handler = (e) => {
        const allowed = ['Tab', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown'];
        if (!allowed.includes(e.key)) e.preventDefault();
      };
      input.addEventListener('keydown', handler);
      input.addEventListener('keypress', (e) => e.preventDefault());
      input.addEventListener('paste', (e) => e.preventDefault());
    }

    function prepareDateTimeInput(input) {
      if (!input) return;
      const nowIso = getRoundedNowIso();
      if (!input.min) input.min = nowIso;
      if (!input.value) input.value = nowIso;
      blockManualInput(input);
    }

    function normalizeDateStr(str) {
      if (!str) return '';
      const cleaned = (str || '').toString().trim().replace(/^'+/, '');
      const d = new Date(cleaned);
      if (!isNaN(d.getTime())) return getLocalDateString(d);
      return cleaned.split('T')[0];
    }

    function normalizeTimeStr(str) {
      const m = (str || '').toString().trim().replace(/^'+/, '').match(/(\d{1,2}):(\d{2})/);
      if (!m) return '';
      const hh = String(parseInt(m[1], 10)).padStart(2, '0');
      const mm = String(parseInt(m[2], 10)).padStart(2, '0');
      return `${hh}:${mm}`;
    }

    function asSheetText(value) {
      if (value === null || value === undefined) return '';
      return `'${value}`;
    }

    async function postToSheetDb(row, apiUrl = SHEETDB_URL) {
      const res = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ data: [row] })
      });
      return res;
    }

    function setModalMessage(el, type, text) {
      if (!el) return;
      el.className = 'modal-message' + (type ? ' ' + type : '');
      if (!text) {
        el.classList.add('hidden');
        el.textContent = '';
        return;
      }
      el.classList.remove('hidden');
      el.textContent = text;
    }

    // Car Wash Booking Modal (SheetDB)
    function ensureCarWashModal() {
      let overlay = document.getElementById('carWashModal');
      if (overlay) return overlay;

      overlay = document.createElement('div');
      overlay.id = 'carWashModal';
      overlay.className = 'modal-overlay hidden';
      overlay.innerHTML = `
        <div class="modal">
          <button type="button" class="modal-close" aria-label="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
          <h3 style="color: #FFD700; text-align: center; font-size: 20px; margin-bottom: 16px;">ğŸš¿ ØªØ³Ø¬ÙŠÙ„ Ù…ÙˆØ¹Ø¯ ØºØ³ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h3>
          <div class="form-grid" style="grid-template-columns: repeat(2, minmax(180px, 1fr)); gap: 10px;">
            <div class="form-field">
              <label>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</label>
              <input type="datetime-local" id="cwDatetime" class="form-control datetime-control" style="cursor: pointer;" />
            </div>
            <div class="form-field">
              <label>ğŸ“¦ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</label>
              <input type="text" id="cwOrder" class="form-control" placeholder="Ù…Ø«Ø§Ù„: 1234">
            </div>
            <div class="form-field">
              <label>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
              <input type="text" id="cwCustomer" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
            </div>
            <div class="form-field">
              <label>ğŸ“ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
              <input type="text" id="cwLocation" class="form-control" placeholder="Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
            </div>
            <div class="form-field">
              <label>ğŸš— Ù†ÙˆØ¹ Ø§Ù„ØºØ³ÙŠÙ„</label>
              <select id="cwWashType" class="form-control">
                <option value="premium">ØºØ³ÙŠÙ„ Ù…Ù…ØªØ§Ø²</option>
                <option value="special">ØºØ³ÙŠÙ„ Ø®ØµÙˆØµÙŠ</option>
                <option value="ultra">ØºØ³ÙŠÙ„ Ø£Ù„ØªØ±Ø§</option>
              </select>
            </div>
            <div class="form-field">
              <label>ğŸ’³ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</label>
              <select id="cwPayment" class="form-control">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©</option>
                <option value="Ù†Ø¹Ù…">ØªÙ… Ø§Ù„Ø¯ÙØ¹</option>
                <option value="Ù„Ø§">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹</option>
              </select>
            </div>
          </div>
          <div class="modal-actions">
            <button id="cwSubmit" class="btn-primary" style="min-width: 140px;">âœ… Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¹Ø¯</button>
            <button id="cwCancel" class="btn-secondary" type="button" style="min-width: 100px;">âŒ Ø¥Ù„ØºØ§Ø¡</button>
          </div>
          <div id="cwMessage" class="modal-message hidden"></div>
        </div>
      `;

      document.body.appendChild(overlay);

      const closeOverlay = () => overlay.classList.add('hidden');
      overlay.addEventListener('click', (e) => { if (e.target === overlay) closeOverlay(); });
      overlay.querySelector('.modal-close').onclick = closeOverlay;
      overlay.querySelector('#cwCancel').onclick = closeOverlay;
      overlay.querySelector('#cwSubmit').onclick = handleCarWashSubmit;

      prepareDateTimeInput(overlay.querySelector('#cwDatetime'));
      return overlay;
    }

    function buildCarWashSheetRow(payload) {
      const headerRow = window._carWashHeaderRow || [];
      const dateHeader = pickHeader(headerRow, ['ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¹Ø¯', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'date'], 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¹Ø¯');
      const timeHeader = pickHeader(headerRow, ['ÙˆÙ‚Øª Ø§Ù„Ù…ÙˆØ¹Ø¯', 'Ø§Ù„ÙˆÙ‚Øª', 'time'], 'ÙˆÙ‚Øª Ø§Ù„Ù…ÙˆØ¹Ø¯');
      const orderHeader = pickHeader(headerRow, ['Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨', 'qr order', 'order'], 'Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨');
      const nameHeader = pickHeader(headerRow, ['Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„', 'customer name'], 'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„');
      const locationHeader = pickHeader(headerRow, ['Ø§Ù„Ù…Ù†Ø·Ù‚Ø©', 'Ø§Ù„Ù…Ù†Ø·Ù‚Ù‡', 'location', 'Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„', 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†'], 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø©');
      const washTypeHeader = pickHeader(headerRow, ['Ù†ÙˆØ¹ Ø§Ù„ØºØ³ÙŠÙ„', 'wash type'], 'Ù†ÙˆØ¹ Ø§Ù„ØºØ³ÙŠÙ„');
      const paymentHeader = pickHeader(headerRow, ['Ø­Ø§Ù„Ù‡ Ø§Ù„Ø¯ÙØ¹', 'Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹', 'payment'], 'Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹');

      return {
        [dateHeader]: payload.date,
        [timeHeader]: payload.time,
        [orderHeader]: payload.qrOrder,
        [nameHeader]: payload.customerName,
        [locationHeader]: payload.location,
        [washTypeHeader]: payload.washType,
        [paymentHeader]: payload.payment
      };
    }

    function openCarWashModal() {
      const overlay = ensureCarWashModal();
      const datetimeInput = overlay.querySelector('#cwDatetime');
      const mainPicker = document.getElementById('appointmentDateTime');
      const baseValue = mainPicker?.value || getRoundedNowIso();
      datetimeInput.value = baseValue;
      datetimeInput.min = getRoundedNowIso();
      prepareDateTimeInput(datetimeInput);

      const washSelect = overlay.querySelector('#cwWashType');
      const selectedWash = (formData.selectedWashes && formData.selectedWashes[0]) || 'premium';
      washSelect.value = selectedWash;

      overlay.querySelector('#cwOrder').value = '';
      overlay.querySelector('#cwCustomer').value = '';
      overlay.querySelector('#cwLocation').value = '';
      overlay.querySelector('#cwPayment').value = '';

      setModalMessage(overlay.querySelector('#cwMessage'), '', '');
      overlay.classList.remove('hidden');
    }

    async function handleCarWashSubmit() {
      const overlay = ensureCarWashModal();
      const message = overlay.querySelector('#cwMessage');
      const submitBtn = overlay.querySelector('#cwSubmit');
      const cancelBtn = overlay.querySelector('#cwCancel');
      setModalMessage(message, '', '');

      const datetimeVal = overlay.querySelector('#cwDatetime').value;
      const orderVal = (overlay.querySelector('#cwOrder').value || '').trim();
      const customerVal = (overlay.querySelector('#cwCustomer').value || '').trim();
      const locationVal = (overlay.querySelector('#cwLocation').value || '').trim();
      const washVal = overlay.querySelector('#cwWashType').value;
      const paymentVal = overlay.querySelector('#cwPayment').value;

      if (!datetimeVal || !orderVal || !customerVal || !locationVal || !washVal || !paymentVal) {
        setModalMessage(message, 'error', 'ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.');
        return;
      }

      const dateOnly = normalizeDateStr(datetimeVal);
      const timeOnly = normalizeTimeStr(datetimeVal.split('T')[1] || '');

      await loadCarWashAppointments(dateOnly);
      const conflict = carWashData.some(apt => normalizeDateStr(apt.date) === dateOnly && normalizeTimeStr(apt.time) === timeOnly);
      if (conflict) {
        setModalMessage(message, 'error', 'Ù‡Ø°Ø§ Ø§Ù„ÙˆÙ‚Øª Ù…Ø­Ø¬ÙˆØ² Ø¨Ø§Ù„ÙØ¹Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆÙ‚Øª Ø¢Ø®Ø±.');
        return;
      }

      const washLabels = { premium: 'ØºØ³ÙŠÙ„ Ù…Ù…ØªØ§Ø²', special: 'ØºØ³ÙŠÙ„ Ø®ØµÙˆØµÙŠ', ultra: 'ØºØ³ÙŠÙ„ Ø£Ù„ØªØ±Ø§' };
      const row = buildCarWashSheetRow({
        date: dateOnly,
        time: timeOnly,
        qrOrder: orderVal,
        customerName: customerVal,
        location: locationVal,
        washType: washLabels[washVal] || washVal,
        payment: paymentVal
      });

      try {
        // Disable actions and show saving state
        submitBtn.disabled = true;
        cancelBtn.disabled = true;
        const originalText = submitBtn.textContent;
        submitBtn.style.opacity = '0.6';
        submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';

        const res = await postToSheetDb(row);
        if (!res.ok) throw new Error('SheetDB request failed');

        // Loading then success states to mirror mechanical flow
        setModalMessage(message, 'loading', 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...');
        await new Promise(resolve => setTimeout(resolve, 800));
        setModalMessage(message, 'success', 'âœ“ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨Ù†Ø¬Ø§Ø­!');

        if (document.getElementById('appointmentDateTime')) {
          document.getElementById('appointmentDateTime').value = `${dateOnly}T${timeOnly}`;
        }
        await loadCarWashAppointments(dateOnly);
        setTimeout(() => {
          overlay.classList.add('hidden');
          // restore button text for next open
          submitBtn.style.opacity = '1';
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
          cancelBtn.disabled = false;
        }, 1500);
      } catch (err) {
        console.error(err);
        setModalMessage(message, 'error', 'ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¹Ø¯. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
        submitBtn.disabled = false;
        cancelBtn.disabled = false;
        submitBtn.style.opacity = '1';
        submitBtn.textContent = 'âœ… Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¹Ø¯';
      }
    }

    // Mechanical Booking Modal (SheetDB)
    function ensureMechanicalModal() {
      let overlay = document.getElementById('mechanicalModal');
      if (overlay) return overlay;

      overlay = document.createElement('div');
      overlay.id = 'mechanicalModal';
      overlay.className = 'modal-overlay hidden';
      overlay.innerHTML = `
        <div class="modal">
          <button type="button" class="modal-close" aria-label="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
          <h3>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©</h3>
          <div class="form-grid" style="grid-template-columns: repeat(2, minmax(180px, 1fr)); gap: 10px;">
            <div class="form-field">
              <label>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</label>
              <input type="datetime-local" id="mechDatetime" class="form-control datetime-control" />
            </div>
            <div class="form-field">
              <label>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</label>
              <input type="text" id="mechOrder" class="form-control" placeholder="Ù…Ø«Ø§Ù„: 5678" />
            </div>
            <div class="form-field">
              <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
              <input type="text" id="mechCustomer" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" />
            </div>
            <div class="form-field">
              <label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
              <input type="text" id="mechArea" class="form-control" placeholder="Ø§Ù„Ù…Ù†Ø·Ù‚Ø©" />
            </div>
            <div class="form-field">
              <label>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
              <select id="mechService" class="form-control">
                <option value="ÙØ­Øµ Ø§Ù„Ø³ÙŠØ§Ø±Ø©">ÙØ­Øµ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</option>
                <option value="Ø³ÙØ§ÙŠÙ ÙˆØ¯ÙŠØ³ÙƒØ§Øª">Ø³ÙØ§ÙŠÙ ÙˆØ¯ÙŠØ³ÙƒØ§Øª</option>
                <option value="Ø²ÙŠØª ÙˆÙÙ„ØªØ±">Ø²ÙŠØª ÙˆÙÙ„ØªØ±</option>
                <option value="ØªØ¨Ø¯ÙŠÙ„ Ø¯ÙŠÙ†Ù…Ùˆ/Ø³Ù„Ù">ØªØ¨Ø¯ÙŠÙ„ Ø¯ÙŠÙ†Ù…Ùˆ/Ø³Ù„Ù</option>
                <option value="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª</option>
                <option value="ØªØ¹Ø¨Ø¦Ù‡ ØºØ§Ø² Ù…ÙƒÙŠÙ">ØªØ¹Ø¨Ø¦Ù‡ ØºØ§Ø² Ù…ÙƒÙŠÙ</option>
                <option value="Ù…Ø§ÙŠ Ø±Ø§Ø¯ÙŠØªØ±">Ù…Ø§ÙŠ Ø±Ø§Ø¯ÙŠØªØ±</option>
                <option value="Ø²ÙŠØª Ø¨Ø±ÙŠÙƒ">Ø²ÙŠØª Ø¨Ø±ÙŠÙƒ</option>
                <option value="Ø²ÙŠØª Ø³ÙƒØ§Ù†">Ø²ÙŠØª Ø³ÙƒØ§Ù†</option>
                <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
              </select>
            </div>
            <div class="form-field hidden" id="mechServiceOtherField">
              <label>Ø­Ø¯Ø¯ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø£Ø®Ø±Ù‰</label>
              <input type="text" id="mechServiceOtherInput" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©" />
            </div>
            <div class="form-field">
              <label>Ø§Ù„ÙÙ†ÙŠÙŠÙ†</label>
              <select id="mechTechnician" class="form-control">
                <option value="ÙŠÙˆØ³Ù Ùˆ Ø±Ø­Ù…Ù‡ Ø§Ù„Ù„Ù‡">ÙŠÙˆØ³Ù Ùˆ Ø±Ø­Ù…Ù‡ Ø§Ù„Ù„Ù‡</option>
                <option value="Ø³ÙŠØ¯ Ùˆ Ø±Ø§Ù…Ø³">Ø³ÙŠØ¯ Ùˆ Ø±Ø§Ù…Ø³</option>
                <option value="Ù…Ø­Ù…Ø¯ Ùˆ Ø¹Ù„ÙŠ">Ù…Ø­Ù…Ø¯ Ùˆ Ø¹Ù„ÙŠ</option>
              </select>
            </div>
          </div>
          <div class="modal-actions">
            <button id="mechSubmit" class="btn-primary">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¹Ø¯</button>
            <button id="mechCancel" class="btn-secondary" type="button">Ø¥Ù„ØºØ§Ø¡</button>
          </div>
          <div id="mechMessage" class="modal-message hidden"></div>
        </div>
      `;

      document.body.appendChild(overlay);

      const closeOverlay = () => overlay.classList.add('hidden');
      overlay.addEventListener('click', (e) => { if (e.target === overlay) closeOverlay(); });
      overlay.querySelector('.modal-close').onclick = closeOverlay;
      overlay.querySelector('#mechCancel').onclick = closeOverlay;
      overlay.querySelector('#mechSubmit').onclick = handleMechanicalSubmit;

      const serviceSelect = overlay.querySelector('#mechService');
      const otherField = overlay.querySelector('#mechServiceOtherField');
      const otherInput = overlay.querySelector('#mechServiceOtherInput');
      const toggleOtherField = () => {
        if (serviceSelect.value === 'Ø£Ø®Ø±Ù‰') {
          otherField.classList.remove('hidden');
          otherInput.focus();
        } else {
          otherField.classList.add('hidden');
          otherInput.value = '';
        }
      };
      serviceSelect.onchange = toggleOtherField;
      overlay._toggleMechOther = toggleOtherField;

      prepareDateTimeInput(overlay.querySelector('#mechDatetime'));
      return overlay;
    }

    function buildMechanicalSheetRow(payload) {
      // Build object with exact column names from header row
      // Use the actual header names from the loaded sheet
      const header = window._mechAppointmentsHeader || [];
      
      // If header is available, use it to build the row dynamically
      if (header.length >= 7) {
        const row = {};
        row[header[0]] = payload.date;        // Column A: ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¹Ø¯
        row[header[1]] = payload.time;        // Column B: ÙˆÙ‚Øª Ø§Ù„Ù…ÙˆØ¹Ø¯
        row[header[2]] = payload.qrOrder;     // Column C: Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨
        row[header[3]] = payload.customerName; // Column D: Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„
        row[header[4]] = payload.area;        // Column E: Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
        row[header[5]] = payload.service;     // Column F: Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©
        row[header[6]] = payload.technician;  // Column G: Ø§Ù„ÙÙ†ÙŠÙŠÙ†
        return row;
      }
      
      // Fallback: use expected column names
      // Order: A=ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¹Ø¯, B=ÙˆÙ‚Øª Ø§Ù„Ù…ÙˆØ¹Ø¯, C=Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨, D=Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„, E=Ø§Ù„Ù…Ù†Ø·Ù‚Ø©, F=Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©, G=Ø§Ù„ÙÙ†ÙŠÙŠÙ†
      return {
        'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¹Ø¯': payload.date,
        'ÙˆÙ‚Øª Ø§Ù„Ù…ÙˆØ¹Ø¯': payload.time,
        'Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨': payload.qrOrder,
        'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„': payload.customerName,
        'Ø§Ù„Ù…Ù†Ø·Ù‚Ø©': payload.area,
        'Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©': payload.service,
        'Ø§Ù„ÙÙ†ÙŠÙŠÙ†': payload.technician
      };
    }

    async function openMechanicalModal() {
      // Ensure data is loaded to get header information
      if (!window._mechAppointmentsHeader || window._mechAppointmentsHeader.length === 0) {
        console.log('Loading mechanical appointments data to get header...');
        await loadMechanicalAppointmentsData();
      }
      
      const overlay = ensureMechanicalModal();
      const datetimeInput = overlay.querySelector('#mechDatetime');
      datetimeInput.value = getRoundedNowIso();
      datetimeInput.min = getRoundedNowIso();
      prepareDateTimeInput(datetimeInput);

      const mechServiceLabels = {
        inspection: 'ÙØ­Øµ Ø§Ù„Ø³ÙŠØ§Ø±Ø©',
        brakes: 'Ø³ÙØ§ÙŠÙ ÙˆØ¯ÙŠØ³ÙƒØ§Øª',
        oilfilter: 'Ø²ÙŠØª ÙˆÙÙ„ØªØ±',
        alternator: 'ØªØ¨Ø¯ÙŠÙ„ Ø¯ÙŠÙ†Ù…Ùˆ/Ø³Ù„Ù',
        wipers: 'ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª',
        acgas: 'ØªØ¹Ø¨Ø¦Ù‡ ØºØ§Ø² Ù…ÙƒÙŠÙ',
        coolant: 'Ù…Ø§ÙŠ Ø±Ø§Ø¯ÙŠØªØ±',
        brakefluid: 'Ø²ÙŠØª Ø¨Ø±ÙŠÙƒ',
        transmission: 'Ø²ÙŠØª Ø³ÙƒØ§Ù†'
      };
      const defaultService = mechServiceLabels[formData.mechanicalService] || 'ÙØ­Øµ Ø§Ù„Ø³ÙŠØ§Ø±Ø©';
      const serviceSelect = overlay.querySelector('#mechService');
      serviceSelect.value = defaultService;

      const otherInput = overlay.querySelector('#mechServiceOtherInput');

      overlay.querySelector('#mechOrder').value = '';
      overlay.querySelector('#mechCustomer').value = '';
      overlay.querySelector('#mechArea').value = '';
      overlay.querySelector('#mechTechnician').value = 'ÙŠÙˆØ³Ù Ùˆ Ø±Ø­Ù…Ù‡ Ø§Ù„Ù„Ù‡';
      if (overlay._toggleMechOther) overlay._toggleMechOther();
      if (otherInput) otherInput.value = '';

      setModalMessage(overlay.querySelector('#mechMessage'), '', '');
      overlay.classList.remove('hidden');
    }

    async function handleMechanicalSubmit() {
      const overlay = ensureMechanicalModal();
      const message = overlay.querySelector('#mechMessage');
      const submitBtn = overlay.querySelector('#mechSubmit');
      const cancelBtn = overlay.querySelector('#mechCancel');
      setModalMessage(message, '', '');

      const datetimeVal = overlay.querySelector('#mechDatetime').value;
      const orderVal = (overlay.querySelector('#mechOrder').value || '').trim();
      const customerVal = (overlay.querySelector('#mechCustomer').value || '').trim();
      const areaVal = (overlay.querySelector('#mechArea').value || '').trim();
      const serviceSelect = overlay.querySelector('#mechService');
      const serviceVal = serviceSelect.value;
      const otherServiceVal = (overlay.querySelector('#mechServiceOtherInput')?.value || '').trim();
      const techVal = overlay.querySelector('#mechTechnician').value;

      const finalService = serviceVal === 'Ø£Ø®Ø±Ù‰' ? otherServiceVal : serviceVal;

      if (!datetimeVal || !orderVal || !customerVal || !areaVal || !serviceVal || !techVal) {
        setModalMessage(message, 'error', 'ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.');
        return;
      }

      if (serviceVal === 'Ø£Ø®Ø±Ù‰' && !otherServiceVal) {
        setModalMessage(message, 'error', 'ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø£Ø®Ø±Ù‰.');
        return;
      }

      const dateOnly = normalizeDateStr(datetimeVal);
      const timeOnly = normalizeTimeStr(datetimeVal.split('T')[1] || '');

      const rows = window._mechAppointmentsRaw || await loadMechanicalAppointmentsData();
      const dataRows = (rows || []).slice(1);
      const conflict = dataRows.some(r => normalizeDateStr(r[0]) === dateOnly && normalizeTimeStr(r[1]) === timeOnly);
      if (conflict) {
        setModalMessage(message, 'error', 'Ù‡Ø°Ø§ Ø§Ù„ÙˆÙ‚Øª Ù…Ø­Ø¬ÙˆØ² Ø¨Ø§Ù„ÙØ¹Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆÙ‚Øª Ø¢Ø®Ø±.');
        return;
      }

      const row = buildMechanicalSheetRow({
        date: dateOnly,
        time: timeOnly,
        qrOrder: orderVal,
        customerName: customerVal,
        area: areaVal,
        service: finalService,
        technician: techVal
      });
      
      console.log('=== MECHANICAL APPOINTMENT SUBMISSION ===');
      console.log('Raw Input Values:');
      console.log('  - Date:', dateOnly);
      console.log('  - Time:', timeOnly);
      console.log('  - Order:', orderVal);
      console.log('  - Customer:', customerVal);
      console.log('  - Area:', areaVal);
      console.log('  - Service:', finalService);
      console.log('  - Technician:', techVal);
      console.log('Row Object to Send:', row);
      console.log('Row Object Keys:', Object.keys(row));
      Object.keys(row).forEach(key => {
        console.log(`  "${key}": "${row[key]}"`);
      });
      console.log('Expected Header:', window._mechAppointmentsHeader);
      console.log('========================================');

      // Disable buttons and show loading state
      submitBtn.disabled = true;
      cancelBtn.disabled = true;
      submitBtn.style.opacity = '0.6';
      submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
      
      try {
        const res = await postToSheetDb(row, MECHANICAL_SHEETDB_URL);
        console.log('SheetDB Response:', res.status, res.statusText);
        if (!res.ok) throw new Error('SheetDB request failed');
        
        // Show loading message with spinner
        setModalMessage(message, 'loading', 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...');
        
        // Wait a moment to show the loading state
        await new Promise(resolve => setTimeout(resolve, 800));
        
        // Show success message with checkmark
        setModalMessage(message, 'success', 'âœ“ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨Ù†Ø¬Ø§Ø­!');
        
        await loadMechanicalAppointmentsData();
        await renderMechanicalAppointments();
        
        // Close modal after success
        setTimeout(() => overlay.classList.add('hidden'), 1500);
      } catch (err) {
        console.error(err);
        setModalMessage(message, 'error', 'ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¹Ø¯. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
        // Re-enable buttons on error
        submitBtn.disabled = false;
        cancelBtn.disabled = false;
        submitBtn.style.opacity = '1';
        submitBtn.textContent = 'Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¹Ø¯';
      }
    }

    // Render Insurance Interface
    function renderInsuranceInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section full-width">
          <h3 class="section-title">Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª</h3>
          <div class="form-field">
            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
              <span>Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø© Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</span>
              <span id="insuranceInfoIcon" style="cursor: pointer; background: #3b82f6; color: #fff; width: 20px; height: 20px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; box-shadow: 0 2px 6px rgba(59, 130, 246, 0.4);">i</span>
            </label>
            <input type="text" list="insuranceSuggestions" id="insuranceSearch" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø© Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" style="font-size: 16px; padding: 12px;">
            <datalist id="insuranceSuggestions"></datalist>
          </div>
          
          <div id="insuranceInfoBox" class="hidden" style="background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); border: 2px solid #60a5fa; border-radius: 8px; padding: 16px; margin-top: 12px; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
              <span style="font-size: 24px;">â„¹ï¸</span>
              <h4 style="color: #fff; font-size: 15px; font-weight: 700; margin: 0;">Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†</h4>
            </div>
            <ul style="list-style: none; padding: 0; margin: 0; color: #dbeafe;">
              <li style="padding: 6px 0; padding-right: 20px; position: relative; font-size: 13px; line-height: 1.5;">
                <span style="position: absolute; right: 0; color: #60a5fa;">âœ“</span>
                Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¨Ù†Ø¬Ø± (Ø±Ù‚Ø¹Ø© Ø®Ø§Ø±Ø¬ÙŠØ© â€“ ØªØ±ÙƒÙŠØ¨ Ø³Ø¨ÙŠØ± â€“ ØªØ¹Ø¨Ø¦Ø© Ù‡ÙˆØ§Ø¡)
              </li>
              <li style="padding: 6px 0; padding-right: 20px; position: relative; font-size: 13px; line-height: 1.5;">
                <span style="position: absolute; right: 0; color: #60a5fa;">âœ“</span>
                ÙØªØ­ Ù‚ÙÙ„
              </li>
              <li style="padding: 6px 0; padding-right: 20px; position: relative; font-size: 13px; line-height: 1.5;">
                <span style="position: absolute; right: 0; color: #60a5fa;">âœ“</span>
                Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø·Ø§Ø±ÙŠØ©
              </li>
              <li style="padding: 6px 0; padding-right: 20px; position: relative; font-size: 13px; line-height: 1.5;">
                <span style="position: absolute; right: 0; color: #60a5fa;">âœ“</span>
                ØªØ¹Ø¨Ø¦Ø© Ø¨Ù†Ø²ÙŠÙ† (ÙŠØªÙ… Ø¯ÙØ¹ Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨Ù†Ø²ÙŠÙ† ÙÙ‚Ø·)
              </li>
              <li style="padding: 6px 0; padding-right: 20px; position: relative; font-size: 13px; line-height: 1.5;">
                <span style="position: absolute; right: 0; color: #60a5fa;">âœ“</span>
                ÙˆÙ†Ø´ Ø¹Ø§Ø¯ÙŠ (Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚ ÙÙ‚Ø·ØŒ ÙˆÙÙŠ Ø§Ù„ÙƒØ±Ø§Ø¬/Ø§Ù„Ù…Ù†Ø²Ù„ Ø¨Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)
              </li>
            </ul>
          </div>
        </div>
        
        <div id="insuranceResults" class="hidden">
        </div>
      `;
      
      const infoIcon = document.getElementById('insuranceInfoIcon');
      const infoBox = document.getElementById('insuranceInfoBox');
      
      infoIcon.onclick = () => {
        if (infoBox.classList.contains('hidden')) {
          infoBox.classList.remove('hidden');
          infoIcon.style.background = '#10b981';
        } else {
          infoBox.classList.add('hidden');
          infoIcon.style.background = '#3b82f6';
        }
      };
      
      const searchInput = document.getElementById('insuranceSearch');
      let searchTimeout;
      
      searchInput.oninput = () => {
        clearTimeout(searchTimeout);
        
        const query = searchInput.value.trim();
        
        if (query.length >= 1) {
          updateInsuranceSuggestions(query);
        }
        
        searchTimeout = setTimeout(() => {
          if (query.length >= 2) {
            searchInsurance(query);
          } else {
            document.getElementById('insuranceResults').innerHTML = '';
            document.getElementById('insuranceResults').classList.add('hidden');
          }
        }, 300);
      };
      
    }

    // Render Protection & Coverage Interface (Ø§Ù„Ø­Ù…Ø§ÙŠÙ‡ ÙˆØ§Ù„ØªØºÙŠÙ…)
    function renderProtectionInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section full-width">
          <h3 class="section-title">Ø§Ù„Ø­Ù…Ø§ÙŠÙ‡ ÙˆØ§Ù„ØªØºÙŠÙ…</h3>
          <div style="margin-bottom:8px;">
            <div id="protectionCompanies" class="prot-logos-grid">
              <img class="prot-logo active" data-prot-company="ÙƒØ§Ø±Ø¨Ø§Ø«" src="https://d.top4top.io/p_3666wqicx0.jpg" alt="ÙƒØ§Ø±Ø¨Ø§Ø«">
              <img class="prot-logo" data-prot-company="Ø±ÙŠÙØ§Ù…Ø¨" src="https://e.top4top.io/p_36666j6tz1.jpg" alt="Ø±ÙŠÙØ§Ù…Ø¨">
              <img class="prot-logo" data-prot-company="Ù‡ÙŠØ±ÙˆÙˆØ±ÙƒØ³" src="https://f.top4top.io/p_36669y5gn2.jpg" alt="Ù‡ÙŠØ±ÙˆÙˆØ±ÙƒØ³">
            </div>
          </div>
          <div id="protRegionSection" class="form-section hidden">
            <h3 class="section-title">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
            <div class="form-field">
              <input type="text" list="protRegionOptions" id="protRegionSelect" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
              <datalist id="protRegionOptions"></datalist>
            </div>
          </div>
          <div id="protResult" class="data-table-container hidden">
            <div class="table-header">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</div>
            <div class="table-scroll">
              <table class="data-table">
                <thead><tr><th>Ø§Ù„Ø¨ÙŠØ§Ù†</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr></thead>
                <tbody id="protResultBody"></tbody>
              </table>
            </div>
            <div id="protNote" class="info-box hidden"></div>
          </div>
          <!-- replaced previous separate note with unified in-result important message -->
        </div>
        <div id="protCompaniesCards" class="form-section full-width hidden">
          <h3 class="section-title">Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ© (Ù…Ù† Ø§Ù„Ø´ÙŠØª)</h3>
          <div id="protCardsGrid" class="cards-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;"></div>
        </div>
      `;

      // Company selection (logos)
      document.querySelectorAll('#protectionCompanies .prot-logo').forEach(btn => {
        btn.onclick = () => {
          document.querySelectorAll('#protectionCompanies .prot-logo').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const comp = btn.dataset.protCompany;
          if (comp === 'ÙƒØ§Ø±Ø¨Ø§Ø«') {
            document.getElementById('protRegionSection').classList.remove('hidden');
            document.getElementById('protResult').classList.add('hidden');
            document.getElementById('protRegionSelect').value = '';
            loadProtRegionOptions();
          } else {
            // Hide region section and results for upcoming companies
            document.getElementById('protRegionSection').classList.add('hidden');
            document.getElementById('protResult').classList.add('hidden');
            document.getElementById('protRegionSelect').value = '';
            // Show notification
            renderProtectionComingSoon();
          }
        };
      });

      function renderProtectionComingSoon() {
        // Show a small notification without hiding the options
        const notification = document.createElement('div');
        notification.id = 'protectionNotification';
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          left: 50%;
          transform: translateX(-50%);
          background: #ef4444;
          color: #fff;
          padding: 10px 20px;
          border-radius: 8px;
          font-size: 16px;
          font-weight: 600;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          z-index: 1000;
          opacity: 1;
          transition: opacity 1s;
        `;
        notification.textContent = 'Ù‚Ø±ÙŠØ¨Ø§Ù‹...';
        document.body.appendChild(notification);
        
        // Fade out after 3 seconds
        setTimeout(() => {
          notification.style.opacity = '0';
          setTimeout(() => {
            if (notification.parentNode) notification.parentNode.removeChild(notification);
          }, 1000);
        }, 3000);
      }

      // Region selection handler
      const protRegionSelect = document.getElementById('protRegionSelect');
      protRegionSelect.oninput = () => {
        const area = protRegionSelect.value.trim();
        if (!area) {
          document.getElementById('protResult').classList.add('hidden');
          return;
        }
        // Automatically choose destination to 'Ø´ÙˆÙŠØ®'
        const dest = 'Ø´ÙˆÙŠØ®';
        // compute price using portarage normal tow routes
        const routes = getTowRoutes('portarage towtruk', 'normal');
        const route = routes.find(r => r.from === area && r.to && r.to.includes(dest));
        const tbody = document.getElementById('protResultBody');
        const note = document.getElementById('protNote');
        if (!route) {
          tbody.innerHTML = '<tr><td colspan="2">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¹Ø± Ù…ÙØ³Ø¬Ù„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´ÙŠØª)</td></tr>';
          document.getElementById('protResult').classList.remove('hidden');
          if (note) note.classList.add('hidden');
          return;
        }

        const basePrice = parseFloat(route.price) || 0;
        const routesFlat = getTowRoutes('portarage towtruk', 'flatbed');
        const routeFlat = routesFlat.find(r => r.from === area && r.to && r.to.includes(dest));
        const flatbedPrice = routeFlat ? (parseFloat(routeFlat.price) || 0) : null;

        // Build services cards with detailed prices
        const servicesHtml = `
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px;">
            <div class="data-card">
              <h4 style="margin:0 0 8px 0;">Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø·Ù„Ø§Ø¡ (PPF)</h4>
              <div>ÙƒØ¨ÙˆØª ÙƒØ§Ù…Ù„: <strong>285 Ø¯.Ùƒ</strong></div>
              <div>Ø­Ù…Ø§ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø³ÙŠØ§Ø±Ø©: <strong>620 Ø¯.Ùƒ</strong></div>
              <div>Ø­Ù…Ø§ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù…Ø·ÙÙŠ (Ù…Ø§Øª): <strong>700 Ø¯.Ùƒ</strong></div>
            </div>

            <div class="data-card">
              <h4 style="margin:0 0 8px 0;">Ø§Ù„Ø¨Ø§ÙƒØ¬Ø§Øª (PPF + ØªØ¸Ù„ÙŠÙ„ + Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø²Ø¬Ø§Ø¬ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ)</h4>
              <div>ÙƒØ¨ÙˆØª ÙƒØ§Ù…Ù„: <strong>410 Ø¯.Ùƒ</strong></div>
              <div>Ø­Ù…Ø§ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø³ÙŠØ§Ø±Ø©: <strong>710 Ø¯.Ùƒ</strong></div>
              <div>Ø­Ù…Ø§ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù…Ø·ÙÙŠ (Ù…Ø§Øª): <strong>810 Ø¯.Ùƒ</strong></div>
            </div>

            <div class="data-card">
              <h4 style="margin:0 0 8px 0;">Ø§Ù„ØªØ¸Ù„ÙŠÙ„ ÙˆØ­Ù…Ø§ÙŠØ© Ø§Ù„Ø²Ø¬Ø§Ø¬ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ</h4>
              <div>ØªØ¸Ù„ÙŠÙ„ Ù†Ø§Ù†Ùˆ Ø³ÙŠØ±Ø§Ù…ÙŠÙƒ: <strong>155 Ø¯.Ùƒ</strong></div>
              <div>Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø²Ø¬Ø§Ø¬ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ : <strong>60 Ø¯.Ùƒ</strong></div>
            </div>

            <div class="data-card">
              <h4 style="margin:0 0 8px 0;">ØªØºÙ„ÙŠÙ ÙÙŠÙ†ÙŠÙ„</h4>
              <div>ØªØºÙ„ÙŠÙ ÙƒØ§Ù…Ù„: <strong>920 Ø¯.Ùƒ</strong></div>
              <div>Ø£Ù„ÙˆØ§Ù† ÙˆØ®Ø§Ù…Ø§Øª Ø®Ø§ØµØ© Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨</div>
            </div>

            <div class="data-card">
              <h4 style="margin:0 0 8px 0;">Ø§Ù„ØµØ¨Øº Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥Ø²Ø§Ù„Ø© (Peelable Paint)</h4>
              <div>Ø¨Ù„Ø§Ùƒ Ø¢ÙˆØª ÙƒØ§Ù…Ù„: <strong>320 Ø¯.Ùƒ</strong></div>
              <div>Ø§Ù„Ø±Ù†Ù‚Ø§Øª: <strong>140 Ø¯.Ùƒ</strong></div>
            </div>
          </div>
        `;

        // Unified important red note (single message) with link to garage location
        const flatbedPriceStr = flatbedPrice !== null ? (flatbedPrice * 2).toFixed(2) : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
        const importantHtml = `
          <div class="prot-important">
            Ù…Ù„Ø§Ø­Ø¸Ù‡ Ø±Ø³ÙˆÙ… Ø§Ù„Ù†Ù‚Ù„ Ù„Ø§ ØªØ´Ù…Ù„ Ø±Ø³ÙˆÙ… Ø§Ù„Ø®Ø¯Ù…Ù‡ Ø£Ø¹Ù„Ø§Ù‡,
            <br><br>Ù¡-Ø±Ø³ÙˆÙ… Ø§Ù„Ù†Ù‚Ù„ (Ø§Ù„Ø±ÙˆØ­Ø© ÙˆØ§Ù„Ø±Ø¯Ù‡): 
            <br style="line-height: 0.5;">
            <div style="margin-right: 20px; margin-top: 4px;">
              Ø§Ù„ÙˆÙ†Ø´ Ø§Ù„Ø¹Ø§Ø¯ÙŠ: ${(basePrice * 2).toFixed(2)} ${config.currency}
              <br>Ø§Ù„ÙÙ„ Ø¯Ø§ÙˆÙ†: ${flatbedPriceStr} ${config.currency}
            </div>
            <br>Ù¢-ÙŠÙ…ÙƒÙ† Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¨Ù†ÙØ³Ù‡ Ù„Ù„ÙƒØ±Ø§Ø¬ ÙˆÙ„ÙƒÙ† ÙŠÙØ´ØªØ±Ø· Ø§Ù„Ø¯ÙØ¹ Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹.
            <br><br><a href="https://maps.app.goo.gl/A9WwLj4PjiZcH68N8" target="_blank" style="color:#ffb3b3;text-decoration:underline;">Ù„ÙˆÙƒÙŠØ´Ù† ÙƒØ±Ø§Ø¬ (ÙƒØ§Ø± Ø¨Ø§Ø«)</a>
          </div>
        `;

        const protResult = document.getElementById('protResult');
        protResult.innerHTML = `
          <div class="table-header">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ù„ØªØºÙŠÙ…</div>
          <div style="padding:12px 16px; display:flex; flex-direction:column; gap:14px;">
            <div class="services-wrap">${servicesHtml}</div>
            <div class="note-wrap">${importantHtml}</div>
          </div>
        `;

        // allow protResult to expand so transport box is fully visible and doesn't overlap
        protResult.style.maxHeight = 'none';
        protResult.style.overflow = 'visible';

        protResult.classList.remove('hidden');
      };

      // Load companies cards from sheet 'Ø­Ù…Ø§ÙŠÙ‡ ÙˆØªØºÙŠÙ…' if available
      setTimeout(() => {
        renderProtectionCompaniesCards();
      }, 200);
    }

    function renderRingRepairInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section full-width">
          <h3 class="section-title">ØªØµÙ„ÙŠØ­ Ø§Ù„Ø±Ù†Ù‚Ø§Øª</h3>
          <div class="form-field">
            <input type="text" list="ringRegionOptions" id="ringRegionSelect" class="form-control" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
            <datalist id="ringRegionOptions"></datalist>
          </div>
          <div id="ringResult" class="info-box hidden"></div>
        </div>
      `;

      loadRingRegionOptions();

      const ringRegionSelect = document.getElementById('ringRegionSelect');
      ringRegionSelect.oninput = () => {
        const area = ringRegionSelect.value.trim();
        const result = document.getElementById('ringResult');
        if (!area) {
          result.classList.add('hidden');
          return;
        }
        // Compute price using portarage normal tow routes
        const routes = getTowRoutes('portarage towtruk', 'normal');
        const route = routes.find(r => r.from === area && r.to && r.to.includes('Ø´ÙˆÙŠØ®'));
        if (!route) {
          result.innerHTML = '<div style="color:#ef4444;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¹Ø± Ù…ÙØ³Ø¬Ù„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´ÙŠØª)</div>';
          result.classList.remove('hidden');
          return;
        }
        const basePrice = parseFloat(route.price) || 0;
        const towPrice = basePrice * 2;

        const noteHtml = `
          <div class="ring-note">
            Ù¡-Ø±Ø³ÙˆÙ… Ù†Ù‚Ù„ Ø§Ù„Ø±Ù†Ù‚ (Ø±ÙˆØ­Ù‡ ÙˆØ±Ø¯Ù‡) Ù…Ù† (${area}) Ø¥Ù„Ù‰ Ø´ÙˆÙŠØ® Ø§Ù„ØµÙ†Ø§Ø¹ÙŠÙ‡ (${towPrice.toFixed(2)} Ø¯.Ùƒ)<br>
            Ù¢-Ø±Ø³ÙˆÙ… ØªØµÙ„ÙŠØ­ Ø§Ù„Ø±Ù†Ù‚ ØªØªØ±Ø§ÙˆØ­ Ù…Ø§Ø¨ÙŠÙ† Ù¢Ù  Ø¯.Ùƒ Ø¥Ù„Ù‰ Ù¥Ù  Ø¯.Ùƒ<br>
            Ù£-Ø±Ø³ÙˆÙ… ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø·ÙˆÙ‚ Ø¹Ø§Ø¯Ù‡ Ù…Ø§Ø¨ÙŠÙ† Ù¥Ù  Ø§Ù„ÙŠ Ù¨Ù  Ø¯.Ùƒ ÙˆÙ„ÙƒÙ† ÙŠØ®ØªÙ„Ù Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ù‡ ÙˆØ­Ø¬Ù… Ø§Ù„Ø±Ù†Ù‚<br>
            Ù¤-Ø§Ù„Ø²ÙŠØ§Ø¯Ù‡ Ù„ØªØµÙ„ÙŠØ­ Ø§Ù„Ø±Ù†Ù‚ Ø§Ùˆ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø·ÙˆÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„ Ù¡Ù¥ Ø¯.Ùƒ<br>
            Ù¥-ÙƒØ±Ø§Ø¬ Ø§Ù„Ù…ØªÙˆÙƒÙ„ Ù„ØªØµÙ„ÙŠØ­ Ø§Ù„Ø±Ù†Ù‚Ø§Øª (<a href="https://maps.app.goo.gl/eEct9MapCFQyYwi86" target="_blank" style="color:#007bff;">Ø§Ø¶ØºØ· Ù‡Ù†Ø§</a>)
          </div>
        `;

        result.innerHTML = noteHtml;
        result.classList.remove('hidden');
      };
    }

    function loadRingRegionOptions() {
      const areaDatalist = document.getElementById('ringRegionOptions');
      const areaInput = document.getElementById('ringRegionSelect');
      const sheetName = 'portarage towtruk';
      const cols = [6,4,3, 6,1,0];
      if (!sheetsData[sheetName]) {
        areaDatalist.innerHTML = '<option value="">...Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„</option>';
        setTimeout(loadRingRegionOptions, 300);
        return;
      }
      const rows = sheetsData[sheetName];
      const areas = [];
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        cols.forEach((colIndex, idx) => {
          if (idx % 3 === 0 && row[colIndex]) areas.push(row[colIndex]);
        });
      }
      const unique = [...new Set(areas)].filter(Boolean);
      areaDatalist.innerHTML = unique.map(a => `<option value="${a}"></option>`).join('');
      if (areaInput) areaInput.value = '';
    }

    function loadProtRegionOptions() {
      const areaDatalist = document.getElementById('protRegionOptions');
      const areaInput = document.getElementById('protRegionSelect');
      const sheetName = 'portarage towtruk';
      // Use columns for normal tow: from (index 6), price (4), cancel (3) and alternate (2,1,0)
      const cols = [6,4,3, 6,1,0];
      if (!sheetsData[sheetName]) {
        areaDatalist.innerHTML = '<option value="">...Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„</option>';
        // retry later
        setTimeout(loadProtRegionOptions, 300);
        return;
      }
      const rows = sheetsData[sheetName];
      const areas = [];
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        cols.forEach((colIndex, idx) => {
          if (idx % 3 === 0 && row[colIndex]) areas.push(row[colIndex]);
        });
      }
      const unique = [...new Set(areas)].filter(Boolean);
      areaDatalist.innerHTML = unique.map(a => `<option value="${a}"></option>`).join('');
      // clear value
      if (areaInput) areaInput.value = '';
    }

    function renderProtectionCompaniesCards() {
      const grid = document.getElementById('protCardsGrid');
      const wrapper = document.getElementById('protCompaniesCards');
      const sheetName = 'Ø­Ù…Ø§ÙŠÙ‡ ÙˆØªØºÙŠÙ…';
      if (!sheetsData[sheetName]) {
        wrapper.classList.add('hidden');
        return;
      }
      const rows = sheetsData[sheetName];
      if (!rows || rows.length < 1) return;

      const headers = rows[0];
      const cards = [];
      for (let c = 0; c < headers.length; c += 2) {
        const compName = (headers[c] || headers[c+1] || '').toString().trim();
        if (!compName) continue;
        const features = [];
        for (let r = 1; r < rows.length; r++) {
          const left = rows[r][c] || '';
          const right = rows[r][c+1] || '';
          const txt = (left || right).toString().trim();
          if (txt) features.push(txt);
        }

        const contentHtml = features.map(f => `<div style="margin-bottom:6px;">â€¢ ${escapeHtml(f)}</div>`).join('');
        cards.push({ name: compName, content: contentHtml });
      }

      grid.innerHTML = cards.map(card => `
        <div class="data-card" style="padding:10px;border:1px solid #333;border-radius:8px; background:#0b1220;">
          <h4 style="margin:0 0 8px 0;">${escapeHtml(card.name)}</h4>
          <div style="font-size:13px;line-height:1.4;">${card.content}</div>
        </div>
      `).join('');

      if (cards.length) wrapper.classList.remove('hidden');
      else wrapper.classList.add('hidden');
    }
    
    function updateInsuranceSuggestions(query) {
      const datalist = document.getElementById('insuranceSuggestions');
      const insuranceSheets = [
        { name: 'ØªØ£Ù…ÙŠÙ† ÙˆØ±Ø¨Ù‡' },
        { name: 'ØªØ£Ù…ÙŠÙ† ØµÙÙŠÙ†Ù‡ VIP' },
        { name: 'ØªØ£Ù…ÙŠÙ† Ø¥ÙŠÙ„Ø§Ù' }
      ];
      
      let suggestions = new Set();
      
      insuranceSheets.forEach(sheet => {
        if (!sheetsData[sheet.name]) return;
        
        const rows = sheetsData[sheet.name];
        if (rows.length < 2) return;
        
        const headers = rows[0];
        
        let customerNameCol = -1;
        let plateNumberCol = -1;
        
        for (let i = 0; i < headers.length; i++) {
          const header = (headers[i] || '').toLowerCase().trim();
          if (header.includes('customer') && header.includes('name')) {
            customerNameCol = i;
          }
          if (header.includes('plate') && header.includes('number')) {
            plateNumberCol = i;
          }
        }
        
        for (let i = 1; i < rows.length && suggestions.size < 20; i++) {
          const row = rows[i];
          
          if (customerNameCol !== -1 && row[customerNameCol]) {
            const customerName = (row[customerNameCol] || '').toString();
            if (customerName.toLowerCase().includes(query.toLowerCase())) {
              suggestions.add(customerName);
            }
          }
          
          if (plateNumberCol !== -1 && row[plateNumberCol]) {
            const plateNumber = (row[plateNumberCol] || '').toString();
            if (plateNumber.toLowerCase().includes(query.toLowerCase())) {
              suggestions.add(plateNumber);
            }
          }
        }
      });
      
      datalist.innerHTML = Array.from(suggestions).slice(0, 15).map(s => `<option value="${s}">`).join('');
    }
    
    function searchInsurance(query) {
      const resultsContainer = document.getElementById('insuranceResults');
      const insuranceSheets = [
        { name: 'ØªØ£Ù…ÙŠÙ† ÙˆØ±Ø¨Ù‡', displayName: 'ØªØ£Ù…ÙŠÙ† ÙˆØ±Ø¨Ù‡' },
        { name: 'ØªØ£Ù…ÙŠÙ† ØµÙÙŠÙ†Ù‡ VIP', displayName: 'ØªØ£Ù…ÙŠÙ† ØµÙÙŠÙ†Ù‡ VIP' },
        { name: 'ØªØ£Ù…ÙŠÙ† Ø¥ÙŠÙ„Ø§Ù', displayName: 'ØªØ£Ù…ÙŠÙ† Ø¥ÙŠÙ„Ø§Ù' }
      ];
      
      let foundResults = [];
      
      insuranceSheets.forEach(sheet => {
        if (!sheetsData[sheet.name]) return;
        
        const rows = sheetsData[sheet.name];
        if (rows.length < 2) return;
        
        const headers = rows[0];
        
        let customerNameCol = -1;
        let plateNumberCol = -1;
        
        for (let i = 0; i < headers.length; i++) {
          const header = (headers[i] || '').toLowerCase().trim();
          if (header.includes('customer') && header.includes('name')) {
            customerNameCol = i;
          }
          if (header.includes('plate') && header.includes('number')) {
            plateNumberCol = i;
          }
        }
        
        for (let i = 1; i < rows.length; i++) {
          const row = rows[i];
          let match = false;
          
          if (customerNameCol !== -1 && row[customerNameCol]) {
            const customerName = (row[customerNameCol] || '').toString().toLowerCase();
            if (customerName.includes(query.toLowerCase())) {
              match = true;
            }
          }
          
          if (plateNumberCol !== -1 && row[plateNumberCol]) {
            const plateNumber = (row[plateNumberCol] || '').toString().toLowerCase();
            if (plateNumber.includes(query.toLowerCase())) {
              match = true;
            }
          }
          
          if (match) {
            // Check if row has any non-empty data
            const hasData = row.some(cell => cell && cell.toString().trim() !== '');
            if (hasData) {
              foundResults.push({
                sheetName: sheet.displayName,
                headers: headers,
                rowData: row
              });
            }
          }
        }
      });
      
      if (foundResults.length === 0) {
        resultsContainer.innerHTML = `
          <div class="form-section full-width">
            <div class="warning-box">
              âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø«: "${query}"
            </div>
          </div>
        `;
        resultsContainer.classList.remove('hidden');
        return;
      }
      
      let html = '';
      
      foundResults.forEach((result, index) => {
        html += `
          <div class="data-table-container" style="margin-bottom: 15px; grid-column: 1 / -1;">
            <div class="table-header">${result.sheetName}</div>
            <div style="overflow-x: auto; width: 100%;">
              <table class="data-table" style="width: 100%; table-layout: auto;">
                <thead>
                  <tr>
        `;
        
        // Filter headers to show only those with data
        const columnsWithData = [];
        result.headers.forEach((header, idx) => {
          if (header && result.rowData[idx] && result.rowData[idx].toString().trim() !== '') {
            columnsWithData.push({ header, idx });
          }
        });
        
        columnsWithData.forEach(col => {
          html += `<th style="white-space: nowrap; padding: 11px 16px;">${col.header}</th>`;
        });
        
        html += `
                  </tr>
                </thead>
                <tbody>
                  <tr>
        `;
        
        columnsWithData.forEach(col => {
          const value = result.rowData[col.idx] || '-';
          html += `<td style="white-space: nowrap; padding: 10px 16px;">${value}</td>`;
        });
        
        html += `
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        `;
      });
      
      resultsContainer.innerHTML = html;
      resultsContainer.classList.remove('hidden');
    }

    // Generic Service Interface with Datalist
    function renderServiceWithDatalist(title, sheetName, columns, note = '') {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section full-width">
          <h3 class="section-title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3>
          <div class="form-field">
            <input type="text" list="areaOptions" id="areaSelect" class="form-control" placeholder="Ø§ÙƒÙ†Ø¨ Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
            <datalist id="areaOptions"></datalist>
          </div>
          ${note}
        </div>
        
        <div id="serviceResultSection" class="data-table-container hidden">
          <div class="table-header">${title}</div>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                  <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                </tr>
              </thead>
              <tbody id="serviceResultBody">
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      loadAreaOptionsDatalist(sheetName, columns, () => {
        calculateServicePrice(sheetName, columns);
      });
    }

    function loadAreaOptionsDatalist(sheetName, columns, callback) {
      const areaSelect = document.getElementById('areaSelect');
      const areaDatalist = document.getElementById('areaOptions');
      
      // If the sheet data isn't loaded yet, show a loading option and retry a few times
      if (!sheetsData[sheetName]) {
        areaDatalist.innerHTML = '<option value="">...Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„</option>';

        let attempts = 0;
        const maxAttempts = 20; // ~4 seconds at 200ms interval

        const waiter = setInterval(() => {
          attempts++;
          if (sheetsData[sheetName]) {
            clearInterval(waiter);
            // call again to populate now that data is available
            loadAreaOptionsDatalist(sheetName, columns, callback);
          } else if (attempts >= maxAttempts) {
            clearInterval(waiter);
            areaDatalist.innerHTML = '<option value="">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>';
          }
        }, 200);

        return;
      }
      
      const rows = sheetsData[sheetName];
      const areas = [];
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        columns.forEach((colIndex, idx) => {
          if (idx % 3 === 0 && row[colIndex]) {
            areas.push(row[colIndex]);
          }
        });
      }
      
      const uniqueAreas = [...new Set(areas)].filter(Boolean);
      areaDatalist.innerHTML = uniqueAreas.map(area => `<option value="${area}">${area}</option>`).join('');
      
      const newAreaSelect = areaSelect.cloneNode(true);
      areaSelect.parentNode.replaceChild(newAreaSelect, areaSelect);
      
      newAreaSelect.oninput = () => {
        formData.area = newAreaSelect.value.trim();
        
        const resultSection = document.getElementById('serviceResultSection') || 
                             document.getElementById('tireResultSection') || 
                             document.getElementById('balanceResultSection') ||
                             document.getElementById('mechResultSection') ||
                             document.getElementById('fuelResultSection');
        
        if (!formData.area) {
          if (resultSection) {
            resultSection.classList.add('hidden');
          }
          
          if (currentService === 'fuel') {
            document.querySelectorAll('[data-fuel]').forEach(btn => btn.classList.remove('active'));
            formData.fuelType = null;
          }
          
          if (currentService === 'balance' && formData.tireSource === 'customer') {
            const tireCountInput = document.getElementById('tireCountInput');
            if (tireCountInput) {
              tireCountInput.value = '';
              formData.tireCount = 0;
            }
          }
          
          if (currentService === 'mechanical' && formData.mechanicalService === 'brakes') {
            document.querySelectorAll('[data-disk]').forEach(btn => {
              btn.classList.remove('active');
              if (btn.dataset.disk === 'no') {
                btn.classList.add('active');
              }
            });
            formData.diskTurning = 'no';
          }
          
          return;
        }
        
        if (formData.area && callback) {
          callback();
        }
      };
    }

    function calculateServicePrice(sheetName, columns) {
      const rows = sheetsData[sheetName];
      if (!rows || !formData.area) return;
      
      let price = null;
      let cancellation = null;
      
      for (let i = 2; i < rows.length; i++) {
        const row = rows[i];
        
        if (row[columns[0]] === formData.area) {
          price = row[columns[1]];
          cancellation = row[columns[2]];
          break;
        }
        
        if (columns.length > 3 && row[columns[3]] === formData.area) {
          price = row[columns[4]];
          cancellation = row[columns[5]];
          break;
        }
      }
      
      if (!price) {
        document.getElementById('serviceResultSection').classList.add('hidden');
        return;
      }
      
      const tbody = document.getElementById('serviceResultBody');
      tbody.innerHTML = `
        <tr>
          <td>Ø³Ø¹Ø± Ø§Ù„Ø®Ø¯Ù…Ø©</td>
          <td class="highlight">${parseFloat(price).toFixed(2)} ${config.currency}</td>
        </tr>
        <tr>
          <td>Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</td>
          <td>${cancellation ? parseFloat(cancellation).toFixed(2) + ' ' + config.currency : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
        </tr>
      `;
      
      document.getElementById('serviceResultSection').classList.remove('hidden');
    }

    // Option 1: Google Sheets Webhook (Apps Script) â€” leave empty to disable
    const GOOGLE_SHEETS_WEBHOOK = '';

    // Google Form submission using pre-filled link
    const FORM_ID = 'e/1FAIpQLScQh0wzxb2oVHXTtPx-NZdbBX63IhaNuMLNag-rPeMdwQVKNw'; // Form ID from the sharing URL
    const FORM_ACTION = `https://docs.google.com/forms/d/${FORM_ID}/viewform?usp=pp_url`; // Base URL with pp_url parameter

    // Map payload keys to Google Form entry ids (for pre-filled link parameters)
    const entryMapping = {
      date: 'entry.1589254434', // Date field
      time: 'entry.1405698644', // Time field
      qrOrder: 'entry.1649370181', // QR ORDER field
      customerName: 'entry.1226088444', // Customer Name field
      phone: 'entry.1698262844', // Customer Number field
      location: 'entry.920891999', // Customer Location field
      washType: 'entry.897996772', // Wash Type field
      payment: 'entry.929707556' // Payment yes/no field
    };

    /**
     * Post booking payload to Google Sheets webhook.
     * Expects the webhook to accept JSON and return HTTP 200 on success.
     */
    async function postToGoogleSheet(payload) {
      if (FORM_ACTION) {
        // If FORM_ACTION set, submit to Google Form instead of Apps Script
        return submitToGoogleForm(payload);
      }

      if (!GOOGLE_SHEETS_WEBHOOK) {
        console.warn('No remote configured (GOOGLE_SHEETS_WEBHOOK or FORM_ACTION). Skipping remote push.');
        return { ok: false, reason: 'no-remote' };
      }

      try {
        const res = await fetch(GOOGLE_SHEETS_WEBHOOK, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        return res;
      } catch (err) {
        console.error('postToGoogleSheet error', err);
        throw err;
      }
    }

    // Submit to Google Form by opening a pre-filled link in a new window
    function submitToGoogleForm(payload) {
      return new Promise((resolve) => {
        if (!FORM_ACTION) return resolve({ ok: false, reason: 'no-form' });

        // Build the pre-filled link
        let url = FORM_ACTION;
        Object.keys(entryMapping).forEach(key => {
          const fieldName = entryMapping[key];
          const value = encodeURIComponent(payload[key] || '');
          url += `&${fieldName}=${value}`;
        });

        // Open the form in a new window
        window.open(url, 'googleFormWindow', 'width=800,height=600');
        resolve({ ok: true });
      });
    }

    // Load data on page load
    loadAllSheets();

    // Render Tire Sheet Interface (Ø´ÙŠØª Ø§Ù„ØªÙˆØ§ÙŠØ±)
    function renderTireSheetInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <style>
          .tire-search-container { padding: 0; }
          .tire-loader {
            border: 3px solid #333;
            border-top: 3px solid #F2BC1B;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: tireSpin 1s linear infinite;
          }
          @keyframes tireSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
          .tire-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #F2BC1B 0%, #d4a319 100%);
            color: #000;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(242, 188, 27, 0.3);
            z-index: 1000;
            animation: tireSlideUp 0.3s ease-out;
            font-weight: bold;
            font-size: 14px;
          }
          @keyframes tireSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
          }
          .tire-suggestions {
            position: absolute;
            top: 100%;
            right: 0;
            left: 0;
            background: #1a1a1a;
            border: 2px solid #F2BC1B;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 8px 25px rgba(242, 188, 27, 0.2);
          }
          .tire-suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            color: #F2BC1B;
            border-bottom: 1px solid #333;
            transition: all 0.2s;
            font-size: 14px;
          }
          .tire-suggestion-item:hover {
            background: rgba(242, 188, 27, 0.1);
          }
          .tire-info-btn {
            background: linear-gradient(135deg, #F2BC1B 0%, #d4a319 100%);
            color: #000;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 13px;
            transition: all 0.2s;
            border: 1px solid #F2BC1B;
            margin-right: 8px;
          }
          .tire-info-btn:hover {
            transform: scale(1.1);
          }
          .tire-info-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
          }
          .tire-info-content {
            background: linear-gradient(145deg, #1a1a1a 0%, #262626 100%);
            border: 2px solid #F2BC1B;
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(242, 188, 27, 0.2);
          }
          .tire-info-close {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #F2BC1B;
            color: #000;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 20px;
            border: none;
            transition: all 0.2s;
          }
          .tire-info-section {
            margin-bottom: 16px;
            padding: 12px;
            background: #0f0f0f;
            border-radius: 8px;
            border-right: 4px solid #F2BC1B;
          }
          .tire-info-title {
            color: #F2BC1B;
            font-weight: bold;
            font-size: 15px;
            margin-bottom: 8px;
          }
        </style>
        
        <div class="form-section full-width">
          <h3 class="section-title">ğŸ” Ø¨Ø­Ø« Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª</h3>
        </div>
        
        <div id="tireInitialLoading" class="form-section full-width" style="text-align: center;">
          <div style="padding: 20px;">
            <div class="tire-loader" style="margin: 0 auto 12px;"></div>
            <p style="color: #F2BC1B; font-weight: bold;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
          </div>
        </div>
        
        <div id="tireSearchBox" class="form-section full-width hidden">
          <div style="display: flex; gap: 8px; align-items: flex-start; margin-bottom: 12px;">
            <div style="flex: 1; position: relative;">
              <input type="text" id="tireSearchInput" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù‚Ø§Ø³ Ø§Ù„Ø¥Ø·Ø§Ø± (Ù…Ø«Ø§Ù„: 215/55R17)" 
                class="form-control" style="width: 100%; position: relative; z-index: 10;">
              <div id="tireSuggestionsDropdown" class="tire-suggestions hidden"></div>
            </div>
            <button id="tireSearchButton" class="btn-primary">ğŸ” Ø¨Ø­Ø«</button>
          </div>
        </div>
        
        <div id="tireBrandFilterContainer" class="form-section full-width hidden">
          <div style="cursor: pointer; padding: 10px 0; display: flex; justify-content: space-between; align-items: center;" id="tireFilterToggle">
            <span style="font-weight: 700; color: #F2BC1B;">ğŸ·ï¸ Ø§Ù„Ù…Ø§Ø±ÙƒØ©</span>
            <span style="color: #F2BC1B;">â–¼</span>
          </div>
          <div id="tireFilterContent" class="hidden" style="padding: 12px 0;">
            <label style="display: flex; align-items: center; margin-bottom: 8px; cursor: pointer;">
              <input type="checkbox" id="selectAllBrands" style="margin-right: 8px;">
              <span style="color: #F2BC1B; font-weight: bold;">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„</span>
            </label>
            <div id="tireBrandCheckboxes" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 8px;"></div>
          </div>
        </div>
        
        <div id="tireResultsContainer" class="form-section full-width hidden">
          <div style="background: linear-gradient(135deg, #F2BC1B 0%, #d4a319 100%); padding: 12px; border-radius: 6px 6px 0 0; margin: -10px -10px 0 -10px;">
            <h3 style="color: #000; margin: 0; font-size: 16px; font-weight: 700;">ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
            <p id="tireResultsCount" style="color: #000; margin: 4px 0 0 0; font-size: 13px;"></p>
          </div>
          <div style="overflow-x: auto; margin-top: 0;">
            <table class="data-table" style="width: 100%; font-size: 13px;">
              <thead>
                <tr style="background: #262626;">
                  <th class="px-4 py-2 text-right border-b" style="border-color: #333; color: #F2BC1B;">Ø§Ù„Ù…Ø§Ø±ÙƒØ©</th>
                  <th class="px-4 py-2 text-right border-b" style="border-color: #333; color: #F2BC1B;">Ø§Ù„Ù…Ù‚Ø§Ø³</th>
                  <th class="px-4 py-2 text-right border-b" style="border-color: #333; color: #F2BC1B;">Ø§Ù„Ù†Ù‚Ø´Ø©</th>
                  <th class="px-4 py-2 text-right border-b" style="border-color: #333; color: #F2BC1B;">Ø§Ù„Ø¨Ù„Ø¯</th>
                  <th class="px-4 py-2 text-right border-b" style="border-color: #333; color: #F2BC1B;">Ø§Ù„Ø³Ù†Ø©</th>
                  <th class="px-4 py-2 text-right border-b" style="border-color: #333; color: #F2BC1B;">Ø§Ù„Ø³Ø¹Ø±</th>
                  <th class="px-4 py-2 text-center border-b" style="border-color: #333; color: #F2BC1B;">Ù†Ø³Ø®</th>
                </tr>
              </thead>
              <tbody id="tireResultsBody" style="color: #F2BC1B;"></tbody>
            </table>
          </div>
        </div>
        
        <div id="tireNoResults" class="form-section full-width hidden" style="text-align: center; padding: 20px;">
          <p style="color: #F2BC1B; font-size: 16px;">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø§Ø³</p>
        </div>

        <div id="tireInfoModal" class="tire-info-modal hidden">
          <div class="tire-info-content">
            <button class="tire-info-close" onclick="document.getElementById('tireInfoModal').classList.add('hidden')">Ã—</button>
            <h2 id="tireInfoTitle" style="color: #F2BC1B; margin-bottom: 16px; text-align: center;"></h2>
            <div id="tireInfoBody"></div>
          </div>
        </div>
      `;
      
      // Initialize tire search
      initializeTireSearch();
    }
    
    function initializeTireSearch() {
      let allTireData = [], allTireSizes = new Set(), currentTireResults = [];
      let selectedBrands = new Set();
      
      const TIRE_SHEET_ID = '1_ml2uiVRXrltZ4ef1PKSgNSO_4SMtXKn20JSajVEDu8';
      const TIRE_SHEET_TABS = ['Berlin Tires', 'FTC', 'Babtain Tires', 'YOKOHAMA TIRE', 'Al TERRA TIRE (By YOKOHAMA)', 'MICHELIN , BFGOODRICH', 'AL Ghanim Group China', 'AL Ghanim Group Korea', 'AL Ghanim Group SUMITOMO', 'Pirelli Retail price list', 'Firestone Tires', 'UltraForce Tires', 'ÙØ±Ø¬ Ø­ÙˆÙ„ÙŠ'];
      
      const brandTranslations = {
        'MICHELIN': 'Ù…ÙŠØ´Ù„Ø§Ù†', 'BRIDGESTONE': 'Ø¨Ø±ÙŠØ¯Ø¬Ø³ØªÙˆÙ†', 'GOODYEAR': 'Ø¬ÙˆØ¯ÙŠÙŠØ±', 'CONTINENTAL': 'ÙƒÙˆÙ†ØªÙŠÙ†Ù†ØªØ§Ù„',
        'PIRELLI': 'Ø¨ÙŠØ±ÙŠÙ„Ù„ÙŠ', 'DUNLOP': 'Ø¯Ù†Ù„ÙˆØ¨', 'YOKOHAMA': 'ÙŠÙˆÙƒÙˆÙ‡Ø§Ù…Ø§', 'HANKOOK': 'Ù‡Ø§Ù†ÙƒÙˆÙƒ', 'KUMHO': 'ÙƒÙˆÙ…Ù‡Ùˆ',
        'TOYO': 'ØªÙˆÙŠÙˆ', 'FALKEN': 'ÙØ§Ù„ÙƒÙ†', 'NITTO': 'Ù†ÙŠØªÙˆ', 'BBS': 'Ø¨ÙŠ Ø¨ÙŠ Ø§Ø³', 'MAXXIS': 'Ù…Ø§ÙƒØ³ÙŠØ³', 'NEXEN': 'Ù†ÙŠÙƒØ³Ù†',
        'FIREMAX': 'ÙØ§ÙŠØ± Ù…Ø§ÙƒØ³', 'COOPER': 'ÙƒÙˆØ¨Ø±', 'GENERAL': 'Ø¬Ù†Ø±Ø§Ù„', 'VREDESTEIN': 'ÙØ±ÙŠØ¯Ø´ØªØ§ÙŠÙ†', 'APLUS': 'Ø§ÙŠÙ‡ Ø¨Ù„Ø§Ø³',
        'RUNWAY': 'Ø±Ø§Ù†ÙˆØ§ÙŠ', 'TRIANGLE': 'ØªØ±Ø§ÙŠÙ†Ø¬Ù„', 'ACCELERA': 'Ø£ÙƒØ³ÙŠÙ„ÙŠØ±Ø§', 'SONAR': 'Ø³ÙˆÙ†Ø§Ø±', 'KENDA': 'ÙƒÙŠÙ†Ø¯Ø§'
      };
      
      const countryTranslations = {
        'CHINA': 'ØµÙŠÙ†ÙŠ ğŸ‡¨ğŸ‡³', 'THAILAND': 'ØªØ§ÙŠÙ„Ù†Ø¯ÙŠ ğŸ‡¹ğŸ‡­', 'JAPAN': 'ÙŠØ§Ø¨Ø§Ù†ÙŠ ğŸ‡¯ğŸ‡µ', 'KOREA': 'ÙƒÙˆØ±ÙŠ ğŸ‡°ğŸ‡·',
        'INDONESIA': 'Ø¥Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠ ğŸ‡®ğŸ‡©', 'MALAYSIA': 'Ù…Ø§Ù„ÙŠØ²ÙŠ ğŸ‡²ğŸ‡¾', 'VIETNAM': 'ÙÙŠØªÙ†Ø§Ù…ÙŠ ğŸ‡»ğŸ‡³'
      };
      
      const speedRatings = {
        'S': { speed: '180', description: 'Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©' },
        'T': { speed: '190', description: 'Ø³ÙŠØ§Ø±Ø§Øª Ù…ØªÙˆØ³Ø·Ø©' },
        'H': { speed: '210', description: 'Ø³ÙŠØ§Ø±Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£Ø¯Ø§Ø¡' },
        'V': { speed: '240', description: 'Ø³ÙŠØ§Ø±Ø§Øª Ø£Ø¯Ø§Ø¡ Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹' },
        'W': { speed: '270', description: 'Ø³ÙŠØ§Ø±Ø§Øª ÙÙŠØ±Ø§Ø±ÙŠ ÙˆÙ„Ø§Ù…Ø¨ÙˆØ±Ø¬ÙŠÙ†ÙŠ' },
        'Y': { speed: '300', description: 'Ø³ÙŠØ§Ø±Ø§Øª Ø³Ø¨Ø§Ù‚' }
      };
      
      const carBrandCodes = {
        'BMW': 'Ø¨ÙŠ Ø¥Ù… Ø¯Ø¨Ù„ÙŠÙˆ', 'AUDI': 'Ø£ÙˆØ¯ÙŠ', 'BENZ': 'Ù…Ø±Ø³ÙŠØ¯Ø³ Ø¨Ù†Ø²', 'PORSCHE': 'Ø¨ÙˆØ±Ø´Ù‡', 'VOLKSWAGEN': 'ÙÙˆÙ„ÙƒØ³ ÙˆØ§Ø¬Ù†',
        'SKODA': 'Ø³ÙƒÙˆØ¯Ø§', 'FORD': 'ÙÙˆØ±Ø¯', 'CHEVROLET': 'Ø´ÙŠÙØ±ÙˆÙ„ÙŠÙ‡', 'GMC': 'Ø¬ÙŠ Ø¥Ù… Ø³ÙŠ', 'TOYOTA': 'ØªÙˆÙŠÙˆØªØ§',
        'LEXUS': 'Ù„ÙƒØ²Ø³', 'HONDA': 'Ù‡ÙˆÙ†Ø¯Ø§', 'ACURA': 'Ø£ÙƒÙˆØ±Ø§', 'NISSAN': 'Ù†ÙŠØ³Ø§Ù†', 'INFINITI': 'Ø¥Ù†ÙÙŠÙŠÙ†ØªÙŠ',
        'MAZDA': 'Ù…Ø§Ø²Ø¯Ø§', 'SUZUKI': 'Ø³ÙˆØ²ÙˆÙƒÙŠ', 'MITSUBISHI': 'Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´ÙŠ', 'SUBARU': 'Ø³ÙˆØ¨Ø§Ø±Ùˆ', 'DAIHATSU': 'Ø¯Ø§ÙŠØ§ØªØ³Ùˆ',
        'JAGUAR': 'Ø¬Ø§ØºÙˆØ§Ø±', 'LAND ROVER': 'Ù„Ø§Ù†Ø¯ Ø±ÙˆÙØ±', 'RANGE ROVER': 'Ø±ÙŠÙ†Ø¬ Ø±ÙˆÙØ±', 'VOLVO': 'ÙÙˆÙ„ÙÙˆ', 'POLESTAR': 'Ø¨ÙˆÙ„ Ø³ØªØ§Ø±',
        'BUICK': 'Ø¨ÙˆÙŠÙƒ', 'CADILLAC': 'ÙƒØ§Ø¯ÙŠÙ„Ø§Ùƒ', 'HUMMER': 'Ù‡Ø§Ù…Ø±', 'JEEP': 'Ø¬ÙŠØ¨', 'CHRYSLER': 'ÙƒØ±Ø§ÙŠØ³Ù„Ø±'
      };

      function extractTireSize(sizeText) {
        if (!sizeText) return null;
        let processedText = sizeText.toString().replace(/(\d{3})\/(\d{2})\/(\d{2})/g, '$1/$2R$3');
        const normalMatch = processedText.replace(/\s+/g, '').match(/(LT)?\d{3}\/\d{2}[A-Z\-]*\d{2}/i);
        return normalMatch ? normalMatch[0].toUpperCase() : null;
      }
      
      function isRunFlat(text) {
        if (!text) return false;
        const upperText = text.toString().toUpperCase().replace(/\s+/g, '');
        return upperText.includes('RF') || upperText.includes('RUNFLAT') || upperText.includes('RFT');
      }
      
      function isLightTruck(sizeText) {
        if (!sizeText) return false;
        return sizeText.toString().toUpperCase().startsWith('LT');
      }
      
      function extractPattern(sizeText, patternColumn) {
        let pattern = '';
        if (patternColumn && patternColumn.toString().trim()) {
          pattern = patternColumn.toString().trim();
        }
        if (isRunFlat(sizeText) || isRunFlat(patternColumn)) {
          pattern = pattern ? `${pattern} (Ø±Ù† ÙÙ„Ø§Øª)` : '(Ø±Ù† ÙÙ„Ø§Øª)';
        }
        return pattern;
      }
      
      function extractSpeedAndLoadIndex(sizeText) {
        if (!sizeText) return { speed: '', loadIndex: '' };
        const match = sizeText.toString().match(/([A-Z])(\d{2,3})$/i);
        return {
          speed: match ? match[1].toUpperCase() : '',
          loadIndex: match ? match[2] : ''
        };
      }

      function showTireToast(message) {
        const toast = document.createElement('div');
        toast.className = 'tire-toast';
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 2000);
      }

      function showTireInfo(tireSize, brand, pattern) {
        const modal = document.getElementById('tireInfoModal');
        const speedLoad = extractSpeedAndLoadIndex(tireSize);
        const speedInfo = speedRatings[speedLoad.speed];
        
        document.getElementById('tireInfoTitle').textContent = tireSize;
        
        let infoHtml = `
          <div class="tire-info-section">
            <div class="tire-info-title">Ø§Ù„Ù…Ø§Ø±ÙƒØ©</div>
            <div style="color: #F2BC1B;">${brand}</div>
          </div>
          <div class="tire-info-section">
            <div class="tire-info-title">Ø§Ù„Ù†Ù‚Ø´Ø©</div>
            <div style="color: #F2BC1B;">${pattern || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
          </div>
        `;
        
        if (speedLoad.speed && speedInfo) {
          infoHtml += `
            <div class="tire-info-section">
              <div class="tire-info-title">ØªØµÙ†ÙŠÙ Ø§Ù„Ø³Ø±Ø¹Ø©: ${speedLoad.speed}</div>
              <div style="color: #bbb;">Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰: ${speedInfo.speed} ÙƒÙ…/Ø³</div>
              <div style="color: #bbb;">${speedInfo.description}</div>
            </div>
          `;
        }
        
        if (speedLoad.loadIndex) {
          infoHtml += `
            <div class="tire-info-section">
              <div class="tire-info-title">Ø±Ù‚Ù… Ø§Ù„Ø­Ù…ÙˆÙ„Ø©</div>
              <div style="color: #F2BC1B;">${speedLoad.loadIndex}</div>
            </div>
          `;
        }
        
        if (isRunFlat(tireSize) || isRunFlat(pattern)) {
          infoHtml += `
            <div class="tire-info-section" style="border-right-color: #10b981;">
              <div class="tire-info-title" style="color: #10b981;">ğŸ›¡ï¸ Ø±Ù† ÙÙ„Ø§Øª (Run Flat)</div>
              <div style="color: #bbb;">ÙŠÙ…ÙƒÙ† Ù„Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø¹Ø¯ Ø§Ù†Ø«Ù‚Ø§Ø¨Ù‡</div>
            </div>
          `;
        }
        
        if (isLightTruck(tireSize)) {
          infoHtml += `
            <div class="tire-info-section" style="border-right-color: #f59e0b;">
              <div class="tire-info-title" style="color: #f59e0b;">ğŸš™ Ø¥Ø·Ø§Ø± Ø¬Ø¯ÙŠØ¯</div>
              <div style="color: #bbb;">Ù…Ø®ØµØµ Ù„Ù„Ø´Ø§Ø­Ù†Ø§Øª Ø§Ù„Ø®ÙÙŠÙØ©</div>
            </div>
          `;
        }
        
        document.getElementById('tireInfoBody').innerHTML = infoHtml;
        modal.classList.remove('hidden');
      }
      
      async function loadTireSheetTab(sheetId, tabName) {
        try {
          const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?sheet=${encodeURIComponent(tabName)}&tqx=out:json`;
          const response = await fetch(url);
          const text = await response.text();
          const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);/);
          if (!jsonMatch) return [];
          
          const data = JSON.parse(jsonMatch[1]);
          const sheetData = [];
          if (data.table && data.table.rows) {
            for (let i = 0; i < data.table.rows.length; i++) {
              const row = data.table.rows[i];
              if (row.c && row.c.length >= 2) {
                const brand = row.c[0]?.v || row.c[0]?.f || '';
                const tireSize = row.c[1]?.v || row.c[1]?.f || '';
                const pattern = row.c[2]?.v || row.c[2]?.f || '';
                const year = row.c[3]?.v || row.c[3]?.f || '';
                const price = row.c[5]?.v || row.c[5]?.f || row.c[4]?.v || row.c[4]?.f || '';
                const origin = row.c[6]?.v || row.c[6]?.f || '';
                
                if (brand && brand.toString().toUpperCase() === 'BRAND') continue;
                const normalizedSize = extractTireSize(tireSize);
                if (normalizedSize && price && price.toString().trim()) {
                  allTireSizes.add(normalizedSize);
                  sheetData.push({
                    brand: brand ? brand.toString().trim() : '',
                    tireSize: normalizedSize,
                    originalSize: tireSize,
                    pattern: extractPattern(tireSize, pattern),
                    year: year ? year.toString().trim() : '',
                    price: price.toString().trim(),
                    origin: origin ? origin.toString().trim() : '',
                    sheetTab: tabName
                  });
                }
              }
            }
          }
          return sheetData;
        } catch (error) {
          return [];
        }
      }
      
      async function loadAllTireData() {
        try {
          allTireData = [];
          allTireSizes.clear();
          const loadPromises = TIRE_SHEET_TABS.map(tabName => loadTireSheetTab(TIRE_SHEET_ID, tabName));
          const results = await Promise.all(loadPromises);
          results.forEach(tabData => {
            if (tabData.length > 0) allTireData = allTireData.concat(tabData);
          });
          
          // Populate brand filters
          const brands = [...new Set(allTireData.map(item => item.brand))].filter(b => b);
          const checkboxContainer = document.getElementById('tireBrandCheckboxes');
          checkboxContainer.innerHTML = brands.map(brand => `
            <label style="display: flex; align-items: center; cursor: pointer;">
              <input type="checkbox" class="tire-brand-filter" value="${brand}" style="margin-right: 8px;">
              <span style="color: #F2BC1B;">${brandTranslations[brand?.toUpperCase()] || brand}</span>
            </label>
          `).join('');
          
          // Handle select all
          document.getElementById('selectAllBrands').addEventListener('change', (e) => {
            document.querySelectorAll('.tire-brand-filter').forEach(cb => {
              cb.checked = e.target.checked;
              if (e.target.checked) {
                selectedBrands.add(cb.value);
              } else {
                selectedBrands.delete(cb.value);
              }
            });
          });
          
          document.querySelectorAll('.tire-brand-filter').forEach(cb => {
            cb.addEventListener('change', (e) => {
              if (e.target.checked) {
                selectedBrands.add(e.target.value);
              } else {
                selectedBrands.delete(e.target.value);
              }
              updateSelectAllState();
            });
          });
          
          document.getElementById('tireInitialLoading').classList.add('hidden');
          document.getElementById('tireSearchBox').classList.remove('hidden');
          document.getElementById('tireBrandFilterContainer').classList.remove('hidden');
        } catch (error) {
          console.error('Error loading tire data:', error);
        }
      }
      
      function updateSelectAllState() {
        const allCheckboxes = document.querySelectorAll('.tire-brand-filter');
        const checkedCount = document.querySelectorAll('.tire-brand-filter:checked').length;
        document.getElementById('selectAllBrands').checked = checkedCount === allCheckboxes.length && allCheckboxes.length > 0;
      }
      
      function searchTires(searchSize) {
        const normalizedSearch = extractTireSize(searchSize);
        if (!normalizedSearch) return [];
        let results = allTireData.filter(item => item.tireSize === normalizedSearch);
        
        // Apply brand filter if any brands are selected
        if (selectedBrands.size > 0) {
          results = results.filter(item => selectedBrands.has(item.brand));
        }
        
        const uniqueResults = [];
        const seen = new Set();
        for (const result of results) {
          const key = `${result.brand}|${result.tireSize}|${result.pattern}|${result.year}|${result.price}`;
          if (!seen.has(key)) {
            seen.add(key);
            uniqueResults.push(result);
          }
        }
        return uniqueResults;
      }
      
      function displayTireResults(results) {
        const tbody = document.getElementById('tireResultsBody');
        tbody.innerHTML = '';
        
        const sortedResults = [...results].sort((a, b) => (parseFloat(a.price) || 0) - (parseFloat(b.price) || 0));
        
        sortedResults.forEach((result, index) => {
          const row = document.createElement('tr');
          row.style.background = index % 2 === 0 ? '#1a1a1a' : '#0f0f0f';
          
          const brandArabic = brandTranslations[result.brand?.toUpperCase()] || result.brand;
          const isLT = result.tireSize.startsWith('LT');
          const displaySize = isLT ? `${result.tireSize} (Ø±Ø¨Ø¹)` : result.tireSize;
          
          row.innerHTML = `
            <td class="px-4 py-2 border-b" style="border-color: #333;">${result.brand ? brandArabic : '<span style="color: #999;">-</span>'}</td>
            <td class="px-4 py-2 border-b font-bold" style="border-color: #333;"><button class="tire-info-btn">i</button> ${displaySize}</td>
            <td class="px-4 py-2 border-b" style="border-color: #333; font-size: 12px;">${result.pattern}</td>
            <td class="px-4 py-2 border-b" style="border-color: #333;"><select class="tire-country-select form-control" style="font-size: 12px; padding: 4px 6px;"><option>Ø§Ø®ØªØ±</option><option>ØµÙŠÙ†ÙŠ ğŸ‡¨ğŸ‡³</option><option>ØªØ§ÙŠÙ„Ù†Ø¯ÙŠ ğŸ‡¹ğŸ‡­</option><option>ÙŠØ§Ø¨Ø§Ù†ÙŠ ğŸ‡¯ğŸ‡µ</option></select></td>
            <td class="px-4 py-2 border-b" style="border-color: #333;"><select class="tire-year-select form-control" style="font-size: 12px; padding: 4px 6px;"><option>Ø§Ø®ØªØ±</option><option ${result.year === '2024' ? 'selected' : ''}>2024</option><option ${result.year === '2025' ? 'selected' : ''}>2025</option><option ${result.year === '2026' ? 'selected' : ''}>2026</option></select></td>
            <td class="px-4 py-2 border-b font-bold" style="border-color: #333;">${result.price}</td>
            <td class="px-4 py-2 border-b text-center" style="border-color: #333;">
              <button class="tire-copy-btn btn-option" style="padding: 4px 8px; font-size: 12px;">Ù†Ø³Ø®</button>
            </td>
          `;
          
          const infoBtn = row.querySelector('.tire-info-btn');
          infoBtn.addEventListener('click', () => showTireInfo(displaySize, brandArabic, result.pattern));
          
          const copyBtn = row.querySelector('.tire-copy-btn');
          copyBtn.addEventListener('click', () => {
            const countrySelect = row.querySelector('.tire-country-select');
            const yearSelect = row.querySelector('.tire-year-select');
            const country = countrySelect.value;
            const year = yearSelect.value;
            
            if (country === 'Ø§Ø®ØªØ±' || year === 'Ø§Ø®ØªØ±') {
              showTireToast('âš ï¸ Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ ÙˆØ§Ù„Ø³Ù†Ø©');
              return;
            }
            
            const copyText = `${brandArabic} ${displaySize} ${country} Ø³Ù†Ø© ${year}. Ø³Ø¹Ø± ${result.price} Ø¯.Ùƒ`;
            const textArea = document.createElement('textarea');
            textArea.value = copyText;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showTireToast('âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®!');
          });
          
          tbody.appendChild(row);
        });
        
        document.getElementById('tireResultsCount').textContent = `âœ… ${results.length} Ù†ØªÙŠØ¬Ø©`;
        document.getElementById('tireResultsContainer').classList.remove('hidden');
        document.getElementById('tireNoResults').classList.add('hidden');
      }
      
      function updateSuggestions(searchText) {
        const dropdown = document.getElementById('tireSuggestionsDropdown');
        if (!searchText.trim()) {
          dropdown.classList.add('hidden');
          return;
        }
        
        const suggestions = Array.from(allTireSizes)
          .filter(size => size.includes(searchText.toUpperCase()))
          .sort()
          .slice(0, 10);
        
        if (suggestions.length > 0) {
          dropdown.innerHTML = suggestions.map(size => `
            <div class="tire-suggestion-item">${size}</div>
          `).join('');
          
          dropdown.querySelectorAll('.tire-suggestion-item').forEach(item => {
            item.addEventListener('click', () => {
              document.getElementById('tireSearchInput').value = item.textContent;
              dropdown.classList.add('hidden');
              performTireSearch();
            });
          });
          
          dropdown.classList.remove('hidden');
        } else {
          dropdown.classList.add('hidden');
        }
      }
      
      async function performTireSearch() {
        const searchInput = document.getElementById('tireSearchInput').value.trim();
        if (!searchInput) {
          document.getElementById('tireResultsContainer').classList.add('hidden');
          document.getElementById('tireNoResults').classList.add('hidden');
          return;
        }
        
        currentTireResults = searchTires(searchInput);
        if (currentTireResults.length > 0) {
          displayTireResults(currentTireResults);
        } else {
          document.getElementById('tireResultsContainer').classList.add('hidden');
          document.getElementById('tireNoResults').classList.remove('hidden');
        }
      }
      
      // Event listeners
      document.getElementById('tireSearchButton').addEventListener('click', performTireSearch);
      document.getElementById('tireSearchInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') performTireSearch();
      });
      
      document.getElementById('tireSearchInput').addEventListener('input', (e) => {
        updateSuggestions(e.target.value);
      });
      
      document.getElementById('tireFilterToggle').addEventListener('click', () => {
        const filterContent = document.getElementById('tireFilterContent');
        filterContent.classList.toggle('hidden');
      });
      
      // Close modal
      document.getElementById('tireInfoModal').addEventListener('click', (e) => {
        if (e.target.id === 'tireInfoModal') {
          e.target.classList.add('hidden');
        }
      });
      
      // Load data
      loadAllTireData();
    }

    // Render Imsakia (Ramadan Schedule)
    function renderImsakia() {
      const contentArea = document.getElementById('contentArea');
      
      // Ramadan 2026 schedule (Saudi Arabia times)
      const ramadanSchedule = [
        {day: 1, date: '28 Ø¯ÙŠØ³Ù…Ø¨Ø±', fajr: '05:23', dhuhr: '12:04', asr: '15:07', isha: '18:31'},
        {day: 2, date: '29 Ø¯ÙŠØ³Ù…Ø¨Ø±', fajr: '05:24', dhuhr: '12:04', asr: '15:08', isha: '18:32'},
        {day: 3, date: '30 Ø¯ÙŠØ³Ù…Ø¨Ø±', fajr: '05:25', dhuhr: '12:05', asr: '15:09', isha: '18:33'},
        {day: 4, date: '31 Ø¯ÙŠØ³Ù…Ø¨Ø±', fajr: '05:26', dhuhr: '12:05', asr: '15:10', isha: '18:34'},
        {day: 5, date: '1 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:27', dhuhr: '12:06', asr: '15:11', isha: '18:35'},
        {day: 6, date: '2 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:28', dhuhr: '12:07', asr: '15:12', isha: '18:36'},
        {day: 7, date: '3 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:29', dhuhr: '12:08', asr: '15:13', isha: '18:37'},
        {day: 8, date: '4 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:30', dhuhr: '12:09', asr: '15:14', isha: '18:38'},
        {day: 9, date: '5 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:31', dhuhr: '12:10', asr: '15:15', isha: '18:39'},
        {day: 10, date: '6 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:32', dhuhr: '12:11', asr: '15:16', isha: '18:40'},
        {day: 11, date: '7 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:33', dhuhr: '12:12', asr: '15:17', isha: '18:41'},
        {day: 12, date: '8 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:34', dhuhr: '12:13', asr: '15:18', isha: '18:42'},
        {day: 13, date: '9 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:35', dhuhr: '12:14', asr: '15:19', isha: '18:43'},
        {day: 14, date: '10 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:36', dhuhr: '12:15', asr: '15:20', isha: '18:44'},
        {day: 15, date: '11 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:37', dhuhr: '12:16', asr: '15:21', isha: '18:45'},
        {day: 16, date: '12 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:38', dhuhr: '12:17', asr: '15:22', isha: '18:46'},
        {day: 17, date: '13 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:39', dhuhr: '12:18', asr: '15:23', isha: '18:47'},
        {day: 18, date: '14 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:40', dhuhr: '12:19', asr: '15:24', isha: '18:48'},
        {day: 19, date: '15 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:41', dhuhr: '12:20', asr: '15:25', isha: '18:49'},
        {day: 20, date: '16 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:42', dhuhr: '12:21', asr: '15:26', isha: '18:50'},
        {day: 21, date: '17 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:43', dhuhr: '12:22', asr: '15:27', isha: '18:51'},
        {day: 22, date: '18 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:44', dhuhr: '12:23', asr: '15:28', isha: '18:52'},
        {day: 23, date: '19 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:45', dhuhr: '12:24', asr: '15:29', isha: '18:53'},
        {day: 24, date: '20 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:46', dhuhr: '12:25', asr: '15:30', isha: '18:54'},
        {day: 25, date: '21 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:47', dhuhr: '12:26', asr: '15:31', isha: '18:55'},
        {day: 26, date: '22 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:48', dhuhr: '12:27', asr: '15:32', isha: '18:56'},
        {day: 27, date: '23 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:49', dhuhr: '12:28', asr: '15:33', isha: '18:57'},
        {day: 28, date: '24 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:50', dhuhr: '12:29', asr: '15:34', isha: '18:58'},
        {day: 29, date: '25 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:51', dhuhr: '12:30', asr: '15:35', isha: '18:59'},
        {day: 30, date: '26 ÙŠÙ†Ø§ÙŠØ±', fajr: '05:52', dhuhr: '12:31', asr: '15:36', isha: '19:00'}
      ];
      
      const today = new Date();
      const currentDay = today.getDate();
      const currentMonth = today.getMonth() + 1;
      
      // Determine current Ramadan day (approximate based on current date)
      let currentRamadanDay = null;
      if (currentMonth === 2 && currentDay <= 26) {
        currentRamadanDay = currentDay - 1; // For February 2026
      }
      
      let html = `<div class="imsakia-container">
        <div class="imsakia-header">
          ğŸ® Ø§Ù…Ø³Ø§ÙƒÙŠÙ‡ Ø±Ù…Ø¶Ø§Ù† 1447 Ù‡Ù€ ğŸ®
        </div>
        <select id="imsakia-day-filter" class="imsakia-filter">
          <option value="">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ù…</option>`;
      
      ramadanSchedule.forEach(entry => {
        html += `<option value="${entry.day}">Ø§Ù„ÙŠÙˆÙ… ${entry.day}: ${entry.date}</option>`;
      });
      
      html += `</select>
        <table class="imsakia-table" id="imsakia-table">
          <thead>
            <tr>
              <th>Ø§Ù„ÙŠÙˆÙ…</th>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th>Ø§Ù„ÙØ¬Ø±</th>
              <th>Ø§Ù„Ø¸Ù‡Ø±</th>
              <th>Ø§Ù„Ø¹ØµØ±</th>
              <th>Ø§Ù„Ø¹Ø´Ø§Ø¡</th>
            </tr>
          </thead>
          <tbody id="imsakia-tbody">`;
      
      ramadanSchedule.forEach(entry => {
        const isCurrentDay = entry.day === currentRamadanDay;
        html += `<tr class="${isCurrentDay ? 'current-day' : ''}">
          <td>${entry.day}</td>
          <td>${entry.date}</td>
          <td><div class="prayer-time ${isCurrentDay ? 'current' : ''}">ğŸŒ… ${entry.fajr}</div></td>
          <td><div class="prayer-time ${isCurrentDay ? 'current' : ''}">â˜€ï¸ ${entry.dhuhr}</div></td>
          <td><div class="prayer-time ${isCurrentDay ? 'current' : ''}">ğŸŒ¤ï¸ ${entry.asr}</div></td>
          <td><div class="prayer-time ${isCurrentDay ? 'current' : ''}">ğŸŒ™ ${entry.isha}</div></td>
        </tr>`;
      });
      
      html += `</tbody></table>`;
      
      // Add next prayer info
      if (currentRamadanDay) {
        const currentEntry = ramadanSchedule[currentRamadanDay - 1];
        html += `<div class="next-prayer-info">
          â° Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: ğŸŒ™ Ø§Ù„Ù…ØºØ±Ø¨ (Ø§Ù„Ø¥ÙØ·Ø§Ø±) Ø§Ù„Ø³Ø§Ø¹Ø© ${currentEntry.isha}
          <div style="margin-top: 8px; font-size: 13px; color: #4ade80; font-weight: 700;">
            ğŸ½ï¸ ÙˆÙ‚Øª Ø§Ù„Ø¥ÙØ·Ø§Ø±: ${currentEntry.isha}
          </div>
        </div>`;
        
        html += `<div class="iftar-countdown" id="countdown-box">
          â³ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ø¥ÙØ·Ø§Ø±: <span class="countdown-number" id="countdown">00:00:00</span>
        </div>`;
      }
      
      html += `</div>`;
      
      contentArea.innerHTML = html;
      
      // Add filter functionality
      const filterSelect = document.getElementById('imsakia-day-filter');
      const tbody = document.getElementById('imsakia-tbody');
      
      filterSelect.addEventListener('change', (e) => {
        const selectedDay = e.target.value;
        const rows = tbody.querySelectorAll('tr');
        
        if (!selectedDay) {
          rows.forEach(row => row.style.display = '');
        } else {
          rows.forEach(row => {
            const dayCell = row.querySelector('td:first-child');
            row.style.display = dayCell.textContent == selectedDay ? '' : 'none';
          });
        }
      });
      
      // Start countdown if on Ramadan
      if (currentRamadanDay) {
        startIftarCountdown(currentRamadanDay, ramadanSchedule);
      }
    }
    
    function startIftarCountdown(ramadanDay, schedule) {
      const currentEntry = schedule[ramadanDay - 1];
      const [iftarHour, iftarMin] = currentEntry.isha.split(':').map(Number);
      
      function updateCountdown() {
        const now = new Date();
        const iftarTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), iftarHour, iftarMin, 0);
        
        if (now > iftarTime) {
          iftarTime.setDate(iftarTime.getDate() + 1);
        }
        
        const diff = iftarTime - now;
        const hours = Math.floor(diff / 3600000);
        const minutes = Math.floor((diff % 3600000) / 60000);
        const seconds = Math.floor((diff % 60000) / 1000);
        
        const countdownEl = document.getElementById('countdown');
        if (countdownEl) {
          countdownEl.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
      }
      
      updateCountdown();
      setInterval(updateCountdown, 1000);
    }

    // Render Annual Subscription Interface (Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ)
    function renderAnnualSubscriptionInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section full-width">
          <h3 class="section-title">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ</h3>
          
          <div class="btn-grid" style="grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 16px;">
            <button class="btn-option" data-subscription="individual" style="padding: 16px; text-align: center; line-height: 1.5;">
              <div style="font-size: 16px; font-weight: 700; margin-bottom: 4px;">ğŸš—</div>
              <div style="font-size: 14px; font-weight: 700;">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„ÙØ±Ø¯ÙŠ</div>
              <div style="font-size: 12px; color: #999; margin-top: 6px;">Ø³ÙŠØ§Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</div>
            </button>
            <button class="btn-option" data-subscription="family" style="padding: 16px; text-align: center; line-height: 1.5;">
              <div style="font-size: 16px; font-weight: 700; margin-bottom: 4px;">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
              <div style="font-size: 14px; font-weight: 700;">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠ</div>
              <div style="font-size: 12px; color: #999; margin-top: 6px;">3 Ø³ÙŠØ§Ø±Ø§Øª</div>
            </button>
          </div>
          
          <div style="display: flex; gap: 8px; margin-bottom: 16px;">
            <button class="btn-option" id="termsButton" style="flex: 1; padding: 10px; display: flex; align-items: center; justify-content: center; gap: 8px;">
              <span>â„¹ï¸</span>
              <span>Ø´Ø±ÙˆØ· ÙˆØ£Ø­ÙƒØ§Ù…</span>
            </button>
            <button class="btn-option" id="detailsButton" style="flex: 1; padding: 10px; display: flex; align-items: center; justify-content: center; gap: 8px;">
              <span>â„¹ï¸</span>
              <span>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</span>
            </button>
          </div>
        </div>
        
        <div id="termsModal" class="modal-overlay hidden">
          <div class="modal" style="max-height: 80vh; overflow-y: auto;">
            <button type="button" class="modal-close" aria-label="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
            <h3 style="color: #F2BC1B; text-align: center; margin-bottom: 16px;">Ø´Ø±ÙˆØ· ÙˆØ£Ø­ÙƒØ§Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ</h3>
            <div id="termsContent" style="color: #ddd; font-size: 13px; line-height: 1.6;">
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">1. Ù…Ø¯Ø© Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</strong> - Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">2. ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</strong> - ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø¹Ø¯ Ø«Ù„Ø§Ø« Ø£ÙŠØ§Ù… Ø¹Ù…Ù„ Ù…Ù† Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">3. ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</strong> - ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ØµØ§Ù„Ø­ Ø¹Ù†Ø¯ Ø·Ù„Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø©.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">4. Ø¯ÙØªØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø©</strong> - ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¯ÙØªØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø© ØµØ§Ù„Ø­.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">5. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</strong> - Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡Ø§ ÙÙ‚Ø·.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">6. Ø§Ù„Ø£Ù…Ù† ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø©</strong> - Ø£ÙˆÙ„ÙˆÙŠØªÙ†Ø§ Ø£Ù…Ù† ÙˆØ³Ù„Ø§Ù…Ø© Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ø´Ø±ÙƒØ©ØŒ Ø¨Ø­ÙŠØ« Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø£Ù…Ø§ÙƒÙ† Ù…Ø¬Ù‡ÙˆÙ„Ø© ÙˆØ®Ø·Ø±Ø©.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">7. Ø®Ø¯Ù…Ø© Ù†Ù‚Ù„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</strong> - ØºÙŠØ± Ù…ØªØ§Ø­Ø© / Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø­Ø§Ù„ ÙˆÙ‚ÙˆÙ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù…Ø§Ù… Ù…Ù†Ø²Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">8. Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</strong> - ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø´ØªØ±Ùƒ Ø§Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø¢ØªÙŠØ©:
                <ul style="margin: 8px 0 0 0; padding-right: 20px;">
                  <li>Ø®Ø¯Ù…Ø§Øª Ù†Ù‚Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</li>
                  <li>Ø®Ø¯Ù…Ø§Øª Ø´Ø­Ù† Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©</li>
                  <li>Ø®Ø¯Ù…Ø§Øª ØªØµÙ„ÙŠØ­ Ø§Ù„Ø¥Ø·Ø§Ø±</li>
                  <li>Ø®Ø¯Ù…Ø§Øª ØªØ²ÙˆÙŠØ¯ Ø§Ù„ÙˆÙ‚ÙˆØ¯</li>
                  <li>Ø®Ø¯Ù…Ø§Øª ÙØªØ­ Ù‚ÙÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</li>
                </ul>
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">9. Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</strong> - ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø´ØªØ±Ùƒ Ø§Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù…Ø´Ù…ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙÙ‚Ø·.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">10. Ø¹Ù…Ø± Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</strong> - ÙŠØ¬Ø¨ Ø£Ù„Ø§ ÙŠÙƒÙˆÙ† Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø£Ù‚Ø¯Ù… Ù…Ù† 15 Ø³Ù†Ø©.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">11. Ø§Ù„Ù†Ù‚Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø·Ø­Ø§Øª</strong> - Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ø§ ÙŠØ´Ù…Ù„ Ù†Ù‚Ù„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø·Ø­Ø§Øª Ø§Ù„ÙÙ„ Ø¯Ø§ÙˆÙ†.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">12. Ø®Ø¯Ù…Ø§Øª Ù†Ù‚Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</strong> - ØªØ´Ù…Ù„ Ù†Ù‚Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø·Ù„ Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ Ø£Ùˆ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ ÙˆÙ„Ø¬Ù‡Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ø­Ø¯Ø¯Ø©ØŒ ÙˆÙ„Ø§ ÙŠØ´Ù…Ù„ Ù†Ù‚Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ù† ÙˆØ§Ù„Ù‰ Ù…Ø­Ù„Ø§Øª Ø§Ù„Ø¨ÙŠØ¹ Ø£Ùˆ Ø§Ù„Ù…Ø²Ø§Ø¯ Ø£Ùˆ Ø§Ù„Ù…Ù‡Ø±Ø¬Ø§Ù†Ø§Øª Ø£Ùˆ Ø§Ù„Ø³ÙƒØ±Ø§Ø¨.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">13. Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù…</strong> - Ø®Ø¯Ù…Ø§Øª Ù†Ù‚Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ø§ ÙŠØ´Ù…Ù„Ù‡Ø§ Ù†Ù‚Ù„Ù‡Ø§ Ù…Ù† Ø­Ø§Ø¯Ø«.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">14. Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</strong> - ØªÙ‚ØªØµØ± Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø¹Ù„Ù‰ Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ø³ÙŠØ¯Ø§Ù† ÙˆØ§Ù„Ø¯ÙØ¹ Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ. ÙˆÙ„Ø§ ØªØ´Ù…Ù„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ø´Ø§Ø­Ù†Ø§Øª.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">15. Ø®Ø¯Ù…Ø§Øª Ø§Ù„ÙˆÙ‚ÙˆØ¯</strong> - ØªØ³ØªØ®Ø¯Ù… ÙÙ‚Ø· Ø¹Ù†Ø¯ ØªÙˆÙ‚Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚ØŒ ÙˆÙŠØªÙ… Ø¯ÙØ¹ Ù‚ÙŠÙ…Ø© Ø§Ù„ÙˆÙ‚ÙˆØ¯ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø´ØªØ±Ùƒ.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">16. ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª</strong> - Ø®Ø¯Ù…Ø§Øª ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª ÙÙŠ Ø­Ø§Ù„ ØªÙˆÙØ± Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙÙ‚Ø·.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">17. Ø§Ù„ÙƒÙˆØ§Ø±Ø« Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©</strong> - Ù„Ø§ ÙŠØªÙ… ØªÙˆÙÙŠØ± Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙƒÙˆØ§Ø±Ø« Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© ÙˆØ§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù…Ø±ÙˆØ±ÙŠØ© ÙˆØ§Ù†ØºÙ…Ø§Ø³ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª ÙÙŠ Ø§Ù„Ù…Ø§Ø¡ Ø£Ùˆ Ø§Ù„Ø±Ù…Ø§Ù„.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">18. Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©</strong> - ÙŠØªÙ… ØªÙˆÙÙŠØ± Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ Ø­Ø¯ÙˆØ¯ Ø¯ÙˆÙ„Ø© Ø§Ù„ÙƒÙˆÙŠØª.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">19. Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</strong> - Ù„Ù„Ù…Ø´ØªØ±Ùƒ Ø§Ù„Ø­Ù‚ Ø¨Ø·Ù„Ø¨ Ø®Ø¯Ù…Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ§Ø­Ø¯.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">20. ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø®ØµØ©</strong> - Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø®ØµØ© ØªØ´Ù…Ù„ ÙÙ‚Ø· Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø®Ø§ØµØ© ÙˆÙ„Ø§ ØªØ´Ù…Ù„ Ù†Ù‚Ù„ Ø®Ø§Øµ (Ø§Ù„ÙˆØ§Ù†ÙŠØª) ÙˆÙ„Ø§ Ù†Ù‚Ù„ Ø®Ø§Øµ (Ø¨Ø§Øµ Ø®Ø§Øµ).
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">21. ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ</strong> - ØªØ¬Ø¯ÙŠØ¯ ØªØ±Ø®ÙŠØµ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© ÙŠØ´Ù…Ù„ ÙÙ‚Ø· Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ù…Ù† ØªØ§Ø±ÙŠØ® 12/3/2020 Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ® 16/8/2020.
              </div>
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">22. Ø³ÙˆØ¡ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</strong> - Ù„Ù„Ù…Ø´ØªØ±Ùƒ Ø§Ù„Ø­Ù‚ ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© ÙˆÙÙŠ Ø­Ø§Ù„Ø© Ø«Ø¨ÙˆØª Ø³ÙˆØ¡ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ØµÙˆØ±Ø© ØªØªÙ†Ø§ÙÙ‰ Ù…Ø¹ Ø´Ø±ÙˆØ· ÙˆØ£Ø­ÙƒØ§Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ØŒ ÙŠØ­Ù‚ Ù„Ø´Ø±ÙƒØ© Ø¨ÙˆØ±ØªØ±Ø§Ø¬ Ù„Ù„Ø¬Ø± ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.
              </div>
              <div style="margin-bottom: 12px;">
                <strong style="color: #F2BC1B;">23. Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ø´Ø±ÙˆØ·</strong> - ÙƒÙ…Ø³ØªØ®Ø¯Ù… Ù„Ø®Ø¯Ù…Ø§Øª Ø´Ø±ÙƒØ© Ø¨ÙˆØ±ØªØ±Ø§Ø¬ Ù„Ù„Ø¬Ø± ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚ ÙˆØ¨Ù‚Ø¨ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ØŒ ÙŠÙˆØ§ÙÙ‚ Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ø´Ø±ÙˆØ· ÙˆØ£Ø­ÙƒØ§Ù… Ø´Ø±ÙƒØ© Ø¨ÙˆØ±ØªØ±Ø§Ø¬ Ù„Ù„Ø¬Ø± ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚.
              </div>
            </div>
            <button id="termsCloseBtn" class="btn-primary" style="width: 100%; margin-top: 16px;">Ø¥ØºÙ„Ø§Ù‚</button>
          </div>
        </div>
        
        <div id="detailsModal" class="modal-overlay hidden">
          <div class="modal" style="max-height: 80vh; overflow-y: auto;">
            <button type="button" class="modal-close" aria-label="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
            <h3 style="color: #F2BC1B; text-align: center; margin-bottom: 16px;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ</h3>
            <div id="detailsContent" style="color: #ddd; font-size: 13px; line-height: 1.6;">
              <div style="margin-bottom: 16px; padding: 12px; border-bottom: 2px solid #F2BC1B;">
                <strong style="color: #F2BC1B; font-size: 14px;">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ - Ø´Ø±ÙƒØ© Ø¨ÙˆØ±ØªØ±Ø§Ø¬</strong>
              </div>
              
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">1. Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„ÙØ±Ø¯ÙŠ</strong> - Ù„Ø³ÙŠØ§Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¨Ù‚ÙŠÙ…Ø© <strong>15 Ø¯.Ùƒ</strong> Ù„Ù…Ø¯Ø© Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©
              </div>
              <div style="margin-bottom: 16px; padding: 0 0 12px 0; border-bottom: 2px solid #F2BC1B;">
                <strong style="color: #F2BC1B;">2. Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠ</strong> - Ù„ 3 Ø³ÙŠØ§Ø±Ø§Øª Ø¨Ù‚ÙŠÙ…Ø© <strong>40 Ø¯.Ùƒ</strong> Ù„Ù…Ø¯Ø© Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©
              </div>
              
              <div style="margin-bottom: 16px; padding: 12px; border-bottom: 2px solid #F2BC1B;">
                <strong style="color: #F2BC1B; font-size: 14px;">Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø´Ù…ÙˆÙ„Ø© (5 Ø®Ø¯Ù…Ø§Øª Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± Ø§Ù„Ø³Ù†Ø©)</strong>
              </div>
              
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">Ù†Ù‚Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© (ÙˆÙ†Ø´/Ø³Ø·Ø­Ø©)</strong>
                <div style="color: #bbb; margin-top: 4px;">Ù…Ù† Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø¹Ø§Ù… ÙÙ‚Ø·. Ù„Ø§ ÙŠØ´Ù…Ù„ Ø§Ù„Ù†Ù‚Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¨ÙŠØª Ø£Ùˆ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙØ±ÙŠØ¬ Ø£Ùˆ Ø¹Ù†Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø¬ Ø£Ùˆ Ø¹Ù†Ø¯ Ø§Ù„Ø´Ø§Ù„ÙŠÙ‡ (Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø¹Ù„ÙŠÙ‡Ø§ ØªÙƒÙ„ÙØ© Ø¥Ø¶Ø§ÙÙŠØ©)</div>
              </div>
              
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">Ø§Ù„Ø¨Ù†Ø´Ø± (Ø§Ù„Ø§Ø·Ø§Ø±)</strong>
                <div style="color: #bbb; margin-top: 4px;">ÙŠØ´Ù…Ù„ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¨ÙŠØ±ØŒ Ø§Ù„Ø±Ù‚Ø¹Ø© Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠØ© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©ØŒ Ø£Ùˆ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¥Ø·Ø§Ø± Ø¨Ø§Ù„Ù‡ÙˆØ§Ø¡</div>
              </div>
              
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">Ø´Ø­Ù† Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©</strong>
                <div style="color: #bbb; margin-top: 4px;">Ø®Ø¯Ù…Ø© Ø´Ø­Ù† Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©</div>
              </div>
              
              <div style="margin-bottom: 12px; padding: 0 0 12px 0; border-bottom: 1px solid #333;">
                <strong style="color: #F2BC1B;">Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†</strong>
                <div style="color: #bbb; margin-top: 4px;">Ù†Ø²ÙˆØ¯Ùƒ Ø¨Ù†Ø²ÙŠÙ† Ø¨Ù‚ÙŠÙ…Ø© 1.5 Ø¯.Ùƒ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø±Ùƒ. Ù…Ø§ ØªØ¯ÙØ¹ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ - ÙÙ‚Ø· Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨Ù†Ø²ÙŠÙ† (1.5 Ø¯.Ùƒ)</div>
              </div>
              
              <div style="margin-bottom: 16px; padding: 0 0 12px 0; border-bottom: 2px solid #F2BC1B;">
                <strong style="color: #F2BC1B;">ÙØªØ­ Ù‚ÙÙ„ Ø§Ù„Ø¨Ø§Ø¨</strong>
                <div style="color: #bbb; margin-top: 4px;">Ø¥Ø°Ø§ Ù„Ø§ Ø³Ù…Ø­ Ø§Ù„Ù„Ù‡ Ø§Ù†Ù‚ÙÙ„Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙˆØ§Ù„Ù…ÙØªØ§Ø­ Ø¯Ø§Ø®Ù„Ù‡Ø§ØŒ Ù†ÙØªØ­Ù‡Ø§ Ù„Ùƒ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø±Ø³ÙˆÙ…</div>
              </div>
              
              <div style="margin-bottom: 12px; padding: 12px; background: #2a1a0f; border: 1px solid #f59e0b; border-radius: 6px;">
                <strong style="color: #fbbf24;">â° Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©:</strong>
                <div style="font-size: 12px; color: #fde68a; margin-top: 6px;">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙŠØªÙØ¹Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹ Ø¨ 3 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„. ÙƒÙ„ 24 Ø³Ø§Ø¹Ø© Ù„Ùƒ Ø®Ø¯Ù…Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·.</div>
              </div>
            </div>
            <button id="detailsCloseBtn" class="btn-primary" style="width: 100%; margin-top: 16px;">Ø¥ØºÙ„Ø§Ù‚</button>
          </div>
        </div>
      `;

      // Set up modal handlers
      const termsModal = document.getElementById('termsModal');
      const detailsModal = document.getElementById('detailsModal');
      const termsBtn = document.getElementById('termsButton');
      const detailsBtn = document.getElementById('detailsButton');
      const termsCloseBtn = document.getElementById('termsCloseBtn');
      const detailsCloseBtn = document.getElementById('detailsCloseBtn');
      
      termsBtn.onclick = () => termsModal.classList.remove('hidden');
      detailsBtn.onclick = () => detailsModal.classList.remove('hidden');
      termsCloseBtn.onclick = () => termsModal.classList.add('hidden');
      detailsCloseBtn.onclick = () => detailsModal.classList.add('hidden');
      
      termsModal.onclick = (e) => { if (e.target === termsModal) termsModal.classList.add('hidden'); };
      detailsModal.onclick = (e) => { if (e.target === detailsModal) detailsModal.classList.add('hidden'); };
      
      termsModal.querySelector('.modal-close').onclick = () => termsModal.classList.add('hidden');
      detailsModal.querySelector('.modal-close').onclick = () => detailsModal.classList.add('hidden');

      // Handle subscription selection
      document.querySelectorAll('[data-subscription]').forEach(btn => {
        btn.onclick = () => {
          const subType = btn.dataset.subscription;
          let url = '';
          
          if (subType === 'individual') {
            url = 'https://subs-portarage.com/product/yamVB9PmR4';
          } else if (subType === 'family') {
            url = 'https://subs-portarage.com/product/oYvREz8MJE';
          }
          
          if (url) {
            // Open in new window
            window.open(url, '_blank');
          }
        };
      });
    }

    // Ensure and open the Groups Modal without replacing existing UI
    function openGroupsModal() {
      // If modal already exists, just show it
      let modal = document.getElementById('groupsModal');
      if (!modal) {
        const wrapper = document.createElement('div');
        wrapper.innerHTML = `
          <div id="groupsModal" class="modal-overlay hidden">
            <div class="modal" style="max-height: 80vh; overflow-y: auto;">
              <button type="button" class="modal-close" aria-label="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
              <h3 style="color: #F2BC1B; text-align: center; margin-bottom: 16px;">Ø£ÙŠ Ù‚Ø±ÙˆØ¨ ØªØ¨ÙŠØŸ</h3>
              <div style="color:#ddd; font-size:13px;">
                <div style="display:flex; gap:8px; align-items:center; margin-bottom:12px;">
                  <label for="groupCategorySelect" style="color:#fff;">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                  <select id="groupCategorySelect" class="form-control" style="min-width: 220px;">
                    <option value="Ø£Ù…Ø±ÙŠÙƒÙŠ">Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
                    <option value="Ø£Ù„Ù…Ø§Ù†ÙŠ">Ø£Ù„Ù…Ø§Ù†ÙŠ</option>
                    <option value="ÙŠØ§Ø¨Ø§Ù†ÙŠ">ÙŠØ§Ø¨Ø§Ù†ÙŠ</option>
                  </select>
                </div>
                <div id="groupsHeader" style="color:#bbb; font-size:12px; margin: 6px 0 10px 0;">Ø§Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚Ø±ÙˆØ¨Ø§Øª</div>
                <div id="groupsList" style="display:flex; flex-direction:column; gap:8px;"></div>
                <button id="groupsCloseBtn" class="btn-primary" style="width: 100%; margin-top: 16px;">Ø¥ØºÙ„Ø§Ù‚</button>
                <div id="groupsToast" style="display:none; text-align:center; color:#10b981; font-weight:700; margin-top:8px;">ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¨Ù†Ø¬Ø§Ø­</div>
              </div>
            </div>
          </div>`;
        document.body.appendChild(wrapper.firstElementChild);
        modal = document.getElementById('groupsModal');

        // Bind close handlers
        const closeBtn = document.getElementById('groupsCloseBtn');
        const categorySelect = document.getElementById('groupCategorySelect');
        const listEl = document.getElementById('groupsList');

        const GROUPS = {
          'Ø£Ù…Ø±ÙŠÙƒÙŠ': [
            'Port + Al Radwan Parts German & American',
            'Port + American Parts',
            'Port + Ø§Ù„Ø§Ù‡Ù„ÙŠØ©',
            'AUTO LAB (Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ Ø§Ù„Ù…ÙŠÙ„Ù…)',
            'Auto Spare Parts'
          ],
          'Ø£Ù„Ù…Ø§Ù†ÙŠ': [
            'Port + Dar German Parts',
            'Ø¹Ù„Ù… Ø§Ù„Ø¯Ø§Ø± Ø£Ù„Ù…Ø§Ù†ÙŠØ© + Port',
            'Ø§Ø¨Ùˆ Ø§Ù„Ø¹ÙŠÙˆÙ† Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø§Ù†ÙŠ â€“ Abdullah',
            'Port + Car Brak German Parts & Garage',
            'Port + AL Jarah German',
            'Port + Al Radwan Parts German & American',
            'Auto Spare Parts'
          ],
          'ÙŠØ§Ø¨Ø§Ù†ÙŠ': [
            'Port + FK Parts',
            'AUTO LAB (Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ Ø§Ù„Ù…ÙŠÙ„Ù…)',
            'Auto Spare Parts',
            'Port + Al mish3al Parts Japan',
            'Ø¨Ø±Ù†Ø³ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ù†ÙŠØ³Ø§Ù† ÙˆØªÙˆÙŠÙˆØªØ§ Ø£ØµÙ„ÙŠ',
            'Port + Ø­ÙƒÙŠÙ…ÙŠ ÙŠØ§Ø¨Ø§Ù†ÙŠ'
          ]
        };

        function renderGroupItems(category) {
          const header = document.getElementById('groupsHeader');
          if (header) header.textContent = 'Ø§Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚Ø±ÙˆØ¨Ø§Øª';
          const items = GROUPS[category] || [];
          listEl.innerHTML = items.map((name, idx) => `
            <button class="btn-option" style="text-align:right;" data-group-name="${name}">${idx + 1}- ${name}</button>
          `).join('');
          const toastEl = document.getElementById('groupsToast');
          listEl.querySelectorAll('[data-group-name]').forEach(btn => {
            btn.onclick = async () => {
              await copyToClipboard(btn.dataset.groupName);
              if (toastEl) {
                toastEl.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¨Ù†Ø¬Ø§Ø­';
                toastEl.style.display = 'block';
                toastEl.style.opacity = '1';
                setTimeout(() => {
                  toastEl.style.opacity = '0';
                  setTimeout(() => { toastEl.style.display = 'none'; }, 200);
                }, 1500);
              }
            };
          });
        }

        categorySelect.onchange = () => renderGroupItems(categorySelect.value);
        renderGroupItems(categorySelect.value);

        closeBtn.onclick = () => modal.classList.add('hidden');
        modal.querySelector('.modal-close').onclick = () => modal.classList.add('hidden');
        modal.onclick = (e) => { if (e.target === modal) modal.classList.add('hidden'); };
      }

      modal.classList.remove('hidden');
    }

    // Render Groups Interface with category dropdown and auto-copy
    function renderGroupsInterface() {
      const contentArea = document.getElementById('contentArea');
      contentArea.innerHTML = `
        <div class="form-section full-width">
          <h3 class="section-title">Ø§Ù„Ù‚Ø±ÙˆØ¨Ø§Øª</h3>
          <div style="display:flex; gap:8px; align-items:center; justify-content:flex-end; margin-bottom:8px;">
            <button id="openGroupsModalBtn" class="btn-option" style="padding:8px 12px;">Ø§Ø®ØªØ± Ù‚Ø±ÙˆØ¨</button>
          </div>
        </div>

        <div id="groupsModal" class="modal-overlay hidden">
          <div class="modal" style="max-height: 80vh; overflow-y: auto;">
            <button type="button" class="modal-close" aria-label="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
            <h3 style="color: #F2BC1B; text-align: center; margin-bottom: 16px;">Ø£ÙŠ Ù‚Ø±ÙˆØ¨ ØªØ¨ÙŠØŸ</h3>
            <div style="color:#ddd; font-size:13px;">
              <div style="display:flex; gap:8px; align-items:center; margin-bottom:12px;">
                <label for="groupCategorySelect" style="color:#fff;">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                <select id="groupCategorySelect" class="form-control" style="min-width: 220px;">
                  <option value="Ø£Ù…Ø±ÙŠÙƒÙŠ">Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
                  <option value="Ø£Ù„Ù…Ø§Ù†ÙŠ">Ø£Ù„Ù…Ø§Ù†ÙŠ</option>
                  <option value="ÙŠØ§Ø¨Ø§Ù†ÙŠ">ÙŠØ§Ø¨Ø§Ù†ÙŠ</option>
                </select>
              </div>
              <div id="groupsHeader" style="color:#bbb; font-size:12px; margin: 6px 0 10px 0;">Ø§Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚Ø±ÙˆØ¨Ø§Øª</div>
              <div id="groupsList" style="display:flex; flex-direction:column; gap:8px;"></div>
              <button id="groupsCloseBtn" class="btn-primary" style="width: 100%; margin-top: 16px;">Ø¥ØºÙ„Ø§Ù‚</button>
              <div id="groupsToast" style="display:none; text-align:center; color:#10b981; font-weight:700; margin-top:8px;">ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¨Ù†Ø¬Ø§Ø­</div>
            </div>
          </div>
        </div>
      `;

      // Show modal immediately for quicker UX
      const modal = document.getElementById('groupsModal');
      const openBtn = document.getElementById('openGroupsModalBtn');
      const closeBtn = document.getElementById('groupsCloseBtn');
      const categorySelect = document.getElementById('groupCategorySelect');
      const listEl = document.getElementById('groupsList');

      const GROUPS = {
        'Ø£Ù…Ø±ÙŠÙƒÙŠ': [
          'Port + Al Radwan Parts German & American',
          'Port + American Parts',
          'Port + Ø§Ù„Ø§Ù‡Ù„ÙŠØ©',
          'AUTO LAB (Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ Ø§Ù„Ù…ÙŠÙ„Ù…)',
          'Auto Spare Parts'
        ],
        'Ø£Ù„Ù…Ø§Ù†ÙŠ': [
          'Port + Dar German Parts',
          'Ø¹Ù„Ù… Ø§Ù„Ø¯Ø§Ø± Ø£Ù„Ù…Ø§Ù†ÙŠØ© + Port',
          'Ø§Ø¨Ùˆ Ø§Ù„Ø¹ÙŠÙˆÙ† Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø§Ù†ÙŠ â€“ Abdullah',
          'Port + Car Brak German Parts & Garage',
          'Port + AL Jarah German',
          'Port + Al Radwan Parts German & American',
          'Auto Spare Parts'
        ],
        'ÙŠØ§Ø¨Ø§Ù†ÙŠ': [
          'Port + FK Parts',
          'AUTO LAB (Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ Ø§Ù„Ù…ÙŠÙ„Ù…)',
          'Auto Spare Parts',
          'Port + Al mish3al Parts Japan',
          'Ø¨Ø±Ù†Ø³ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ù†ÙŠØ³Ø§Ù† ÙˆØªÙˆÙŠÙˆØªØ§ Ø£ØµÙ„ÙŠ',
          'Port + Ø­ÙƒÙŠÙ…ÙŠ ÙŠØ§Ø¨Ø§Ù†ÙŠ'
        ]
      };

      function renderGroupItems(category) {
        const header = document.getElementById('groupsHeader');
        if (header) header.textContent = 'Ø§Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚Ø±ÙˆØ¨Ø§Øª';
        const items = GROUPS[category] || [];
        listEl.innerHTML = items.map((name, idx) => `
          <button class="btn-option" style="text-align:right;" data-group-name="${name}">${idx + 1}- ${name}</button>
        `).join('');
        const toastEl = document.getElementById('groupsToast');
        listEl.querySelectorAll('[data-group-name]').forEach(btn => {
          btn.onclick = async () => {
            await copyToClipboard(btn.dataset.groupName);
            if (toastEl) {
              toastEl.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¨Ù†Ø¬Ø§Ø­';
              toastEl.style.display = 'block';
              toastEl.style.opacity = '1';
              setTimeout(() => {
                toastEl.style.opacity = '0';
                setTimeout(() => { toastEl.style.display = 'none'; }, 200);
              }, 1500);
            }
          };
        });
      }

      categorySelect.onchange = () => renderGroupItems(categorySelect.value);
      renderGroupItems(categorySelect.value);

      openBtn.onclick = () => modal.classList.remove('hidden');
      closeBtn.onclick = () => modal.classList.add('hidden');
      modal.querySelector('.modal-close').onclick = () => modal.classList.add('hidden');
      modal.onclick = (e) => { if (e.target === modal) modal.classList.add('hidden'); };

      // open immediately
      modal.classList.remove('hidden');
    }

    function showToast(message) {
      let el = document.getElementById('globalToast');
      if (!el) {
        el = document.createElement('div');
        el.id = 'globalToast';
        el.className = 'prot-toast';
        document.body.appendChild(el);
      }
      el.textContent = message;
      el.style.display = 'block';
      el.style.opacity = '1';
      setTimeout(() => {
        el.style.opacity = '0';
        setTimeout(() => { el.style.display = 'none'; }, 200);
      }, 1800);
    }

    async function copyToClipboard(text) {
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(text);
        } else {
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.style.position = 'fixed';
          ta.style.left = '-9999px';
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          document.body.removeChild(ta);
        }
      } catch (e) {
        console.warn('Clipboard copy failed', e);
      }
    }
  </script>
  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b5a74feb5de51ca',t:'MTc2NzAyMzQ2Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
